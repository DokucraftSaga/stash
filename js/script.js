function E(e){return $(document.createElement(e))}function loadPage(){stash.page.closeModal($("#content-wrapper>.modal")),"function"==typeof stash.page.onRemove&&(stash.page.onRemove(),stash.page.onRemove=null,stash.page.onSidebarToggle=null),removeAllTooltips();let e=getURLParams();if(null!=e){for(let t=0;t<pages.length;t++)if(e.hasOwnProperty(pages[t]))return void $("#content").load(`pages/${pages[t]}.html`,stash.page.loaded);$("#content").empty().append('<div class="hint">This page does not exist.</div>'),stash.workError()}else $("#content").load("pages/categories.html",stash.page.loaded)}function initSelectric(){$("select").selectric({expandToItemText:!0})}function removeAllTooltips(){$(".tippy-popper").remove()}function setSearchFormVals(e,t,a,s,o){$("#category-input").val(e),$("#contributor-input").val(t),$("#id-input").val(a),$("#size-input").val(s),$("#color-picker-toggle").prop("checked",null!=o).change(),null!=o&&$.farbtastic("#color-picker").setColor(o)}function goToPage(e,t){if(null!=t&&t.preventDefault(),null==getURLParams()||!getURLParams().hasOwnProperty(e))if(stash.workIndeterminate(),stash.animations.forEach(e=>e.stop()),stash.animations=[],stash.page.closeModal($("#content-wrapper>.modal")),"function"==typeof stash.page.onRemove&&(stash.page.onRemove(),stash.page.onRemove=null,stash.page.onSidebarToggle=null),"root"==e)history.pushState(null,"","/stash/"),$("#content").empty().append('<div class="hint">Loading...</div>').load("pages/categories.html",()=>{removeAllTooltips(),setSearchFormVals(),stash.page.loaded()});else if(e.match(/^\?/)){let t=getURLParams(e),a=null;for(let e=0;e<pages.length;e++)if(t.hasOwnProperty(pages[e])){a=pages[e];break}history.pushState(null,"",e),$("#content").empty().append('<div class="hint">Loading...</div>').load(`pages/${a}.html`,()=>{removeAllTooltips(),t.search||setSearchFormVals(),stash.page.loaded()})}else{let t={};t[e]=!0,history.pushState(null,"",toURLParams(t)),$("#content").empty().append('<div class="hint">Loading...</div>').load(`pages/${e}.html`,()=>{removeAllTooltips(),setSearchFormVals(),stash.page.loaded()})}}function getURLParams(e=location.search){if(e.length<2)return null;let t,a=/(?:^\?|&)([A-z0-9]+)(?:=([^&]+)|(?=&)|$)/g,s={};for(;t=a.exec(e);)s[t[1]]=!t[2]||decodeURIComponent(t[2].replace(/\+/g,"%20"));return s}function toURLParams(e){let t=[];for(let a in e)if(e.hasOwnProperty(a)&&null!=e[a])if(!0===e[a])t.push(`${0==t.length?"?":"&"}${a}`);else{let s=encodeURIComponent(e[a]).replace(/%3A/g,":").replace(/%3B/g,";").replace(/%20/g,"+").replace(/%2C/g,",").replace(/%2F/g,"/");t.push(`${0==t.length?"?":"&"}${a}=${s}`)}return t.join("")}function decodeQuery(){let e=getURLParams().search;if(null==e)return;let t=e.split(";"),a={};for(let e=0;e<t.length;e++){let s=t[e].split(":");a[longform[s[0]]]=s[1]}return a}function toSearchURLParams(e){let t=[];for(let a in e)e.hasOwnProperty(a)&&null!=e[a]&&e[a].length>0&&t.push(`${abbr[a]}:${e[a]}`);return toURLParams({search:t.join(";")})}function formatNum(e,t){let a=e;if("undefined"!=typeof Intl&&void 0!==Intl.NumberFormat&&(a=(new Intl.NumberFormat).format(e)),!t)return a;let s=e%10,o=e%100;return 1==s&&11!=o?a+"st":2==s&&12!=o?a+"nd":3==s&&13!=o?a+"rd":a+"th"}function formatBytes(e){if(0==e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB","TB"][t]}function naturalSorter(e,t){let a,s,o,n,i,r,l=0,c=/(\.\d+)|(\d+(\.\d+)?)|([^\d.]+)|(\.\D+)|(\.$)/g;if(e===t)return 0;for(a=e.toLowerCase().match(c),s=t.toLowerCase().match(c),r=a.length;l<r;){if(!s[l])return 1;if(o=a[l],n=s[l++],o!==n)return i=o-n,isNaN(i)?o>n?1:-1:i}return s[l]?-1:0}function bestMatchSort(e,t){return t?(a,s)=>{const o=e.val().split(t),n=o[o.length-1].toLowerCase(),i=a.toLowerCase().indexOf(n)-s.toLowerCase().indexOf(n);if(0!=i)return i;const r=new RegExp(n,"gi");return s.match(r).length-a.match(r).length}:(t,a)=>{const s=e.val().toLowerCase(),o=t.toLowerCase().indexOf(s)-a.toLowerCase().indexOf(s);if(0!=o)return o;const n=new RegExp(s,"gi");return a.match(n).length-t.match(n).length}}function idSort(e,t){return getID(e)-getID(t)}function lerp(e,t,a){return t*a+e*(1-a)}function getApproxTime(e){if(e>legacyTimeData[legacyTimeData.length-1].id)return-1;for(let t=0;t<legacyTimeData.length;t++)if(e>legacyTimeData[t].id&&e<=legacyTimeData[t+1].id)return lerp(legacyTimeData[t].time,legacyTimeData[t+1].time,(e-legacyTimeData[t].id)/(legacyTimeData[t+1].id-legacyTimeData[t].id));return-1}function formatDate(e){let t=new Date(1e3*e);return months[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear()}function getExt(e){return rgxExt.exec(e)[1].toLowerCase()}function getCategory(e){return rgxCategory.exec(e)[1]}function getContributor(e){return rgxContributor.exec(e)[1]}function getID(e){return parseInt(rgxID.exec(e)[1])}function getTimestamp(e){return stash.data[e].T||getApproxTime(getID(e))}function categoryFilter(e){let t=new RegExp(`^${e}/`);return e=>e.match(t)}function contributorFilter(e){let t=new RegExp(`/(${e.join("|")})_[0-9]+.(png|zip)$`);return e=>e.match(t)}function stringToIDList(e){if(null==e)return null;if(0==e.length)return null;let t=[],a=e.split(",");for(let e=0;e<a.length;e++){let s=a[e];if(~s.indexOf("-")){let e=s.split("-");t.push({min:parseInt(e[0]),max:e[1].length>0?parseInt(e[1]):1/0})}else t.push({min:parseInt(s),max:parseInt(s)})}return t}function idMatches(e,t){for(let a=0;a<t.length;a++)if(e>=t[a].min&&e<=t[a].max)return!0;return!1}function idFilter(e){return t=>idMatches(getID(t),e)}function timeFilter(e,t){return a=>{const s=getTimestamp(a);return s>e&&s<t}}function stringToSize(e){if(null==e)return null;if(!(e=e.trim()).match(rgxSize))return null;let t=rgxSize.exec(e);return{o:t[1],v:[parseInt(t[2]),parseInt(t[4]||t[2])]}}function sizeFilter(e){return"="==e.o||null==e.o?t=>t.match(/\.png$/)&&stash.data[t].S[0]==e.v[0]&&stash.data[t].S[1]==e.v[1]:"<"==e.o?t=>t.match(/\.png$/)&&stash.data[t].S[0]<e.v[0]&&stash.data[t].S[1]<e.v[1]:">"==e.o?t=>t.match(/\.png$/)&&stash.data[t].S[0]>e.v[0]&&stash.data[t].S[1]>e.v[1]:"<="==e.o?t=>t.match(/\.png$/)&&stash.data[t].S[0]<=e.v[0]&&stash.data[t].S[1]<=e.v[1]:">="==e.o?t=>t.match(/\.png$/)&&stash.data[t].S[0]>=e.v[0]&&stash.data[t].S[1]>=e.v[1]:void 0}function hexToRgb(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(e,t,a,s)=>t+t+a+a+s+s);let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function rgbToLab(e){let t,a,s,o=e[0]/255,n=e[1]/255,i=e[2]/255;return o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,t=(.4124*o+.3576*n+.1805*i)/.95047,a=(.2126*o+.7152*n+.0722*i)/1,s=(.0193*o+.1192*n+.9505*i)/1.08883,t=t>.008856?Math.pow(t,1/3):7.787*t+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,[116*a-16,500*(t-a),200*(a-s)]}function deltaE(e,t){let a=e[0]-t[0],s=e[1]-t[1],o=e[2]-t[2],n=Math.sqrt(e[1]*e[1]+e[2]*e[2]),i=n-Math.sqrt(t[1]*t[1]+t[2]*t[2]),r=s*s+o*o-i*i,l=a/1,c=i/(1+.045*n),d=(r=r<0?0:Math.sqrt(r))/(1+.015*n),p=l*l+c*c+d*d;return p<0?0:Math.sqrt(p)}function filterResultsByColor(){let e=$("#content .result");if(0==e.length)return;let t=$.farbtastic("#color-picker"),a=rgbToLab(hexToRgb(t.color)),s=0,o=0,n=$("#results-count").text("Results: 0");e.each((i,r)=>{let l=stash.data[$(r).attr("data-file")].P;for(let i in l)if(l.hasOwnProperty(i)&&l[i]){if(t.hsl[1]<.5&&~i.indexOf("V"))continue;if(t.hsl[1]>=.5&&~i.indexOf("M"))continue;if(deltaE(a,rgbToLab(l[i]))<=16)return $(r).removeClass("hidden"),s++,o++,n.text(`Results: ${s}`),void(o==e.length&&updateResultGroupVisibility())}$(r).addClass("hidden"),++o==e.length&&updateResultGroupVisibility()})}function createFilePreview(e,t){let a=stash.data[e].S;if(t.attr("data-file",e).addClass("file"),stash.data[e].M&&t.addClass("mcmeta").attr("data-filetype","Animation"),stash.data[e].Z&&t.addClass(stash.data[e].Z+" zip").attr("data-filetype",stash.typeNames[stash.data[e].Z]),e.match(/\.png$/)){let s=stashURL+e;t.addClass("png"),stash.data[e].M||a[1]/a[0]>=6&&a[1]%a[0]==0?t.append(E("img").addClass("animated b-lazy").attr("src","/stash/resources/transparent.png").attr("data-src",s),E("div").addClass(`img b-lazy thumbnail${a[0]<128?" pixelated":""}`).attr("data-src",thumbnails+e)):a[0]>128||a[1]>128?t.append(E("div").addClass("img b-lazy thumbnail").attr("data-src",thumbnails+e),E("div").addClass("img b-lazy original").attr("data-src",s)):t.append(E("div").addClass(`img b-lazy${a[0]<128&&a[1]<128?" pixelated":""}`).attr("data-src",s))}else{let s=thumbnails+e.replace(/\.zip$/,".png");stash.data[e].M||a[1]/a[0]>6&&a[1]%a[0]==0?t.addClass("no-thumbnail").append(E("img").addClass("animated b-lazy").attr("src","/stash/resources/transparent.png").attr("data-src",s)):t.append(E("div").addClass(`img b-lazy${a[0]<128&&a[1]<128?" pixelated":""}`).attr("data-src",s))}let s=E("div").addClass("overlay").appendTo(t);return s.append(E("a").addClass("action-button download-image-button").attr("download",e.split("/")[1]).attr("title","Download").attr("href",stashURL+e).on("click",e=>{e.stopPropagation()}).on("contextmenu",e=>{e.stopPropagation()})),e.match(/\.png$/)&&s.append(E("div").addClass("action-button fullscreen-button").attr("title","Fullscreen").on("click",t=>{stash.fullscreenImage(stashURL+e),t.stopPropagation()})),tippy(s.find(".action-button").toArray(),{arrow:!0,animation:"perspective",performance:!0}),t}function updateResultGroupVisibility(){$("#content>.group").removeClass("hidden").each((e,t)=>{0==$(t).children(".result:visible").length&&$(t).addClass("hidden")})}function searchWithForm(){$(":focus").blur();let e=$("#category-input").val(),t=$("#contributor-input").val(),a=$("#id-input").val(),s=$("#size-input").val();if(e+t+a+s=="")return;goToPage(toSearchURLParams({category:e,contributor:t,id:a,size:s,color:$("#color-picker-toggle").is(":checked")?$("#color-picker-input").val().substr(1):null}))}function removeNotification(e){let t=e.outerHeight();e.prevAll(".notification").animate({bottom:`-=${t+20}px`},250),e.animate({right:"-800px"},250,()=>e.remove())}function fileSelectionChanged(){let e=stash.selection.files.length;if(e>0){$("#content .file").each((e,t)=>{let a=$(t).attr("data-file");stash.selection.contains(a)?$(t).addClass("selected"):$(t).removeClass("selected")});let t=stash.selection.toString(),a=t.length,s=t.substring(0,50);if(a>s.length&&(s+="..."),stash.cache.selectionPanelTimer&&(clearTimeout(stash.cache.selectionPanelTimer),$("#selection-panel").remove(),stash.cache.selectionPanelTimer=null),0==$("#selection-panel").length){const a=E("div").attr("id","selection-panel").appendTo($("body"));stash.diamond.create(80,"open horizontal banner").appendTo(a).find(".content").append(E("div").addClass("button").text("Deselect").on("click",stash.deselectAllFiles)).append(E("div").addClass("button").text("Download").on("click",stash.selection.download)).append(E("input").attr("type","text").val("https://dokucraft.co.uk/stash/"+toSearchURLParams({id:t}))).append(E("div").addClass("button").text("Copy link").on("click",function(){$(this).prev().select(),document.execCommand("Copy")}));const o=stash.diamond.create(200,"open").appendTo(a);o.find(".content").replaceWith(E("a").addClass("content").text(`${e} file${1===e?"":"s"}`).attr("title","<h3>Selected Files</h3><i>IDs: "+s+"</i>").attr("href",toSearchURLParams({id:t})).on("click",e=>goToPage(toSearchURLParams({id:t}),e))),tippy(o.find(".content")[0],{placement:"left",arrow:!0,animation:"perspective",dynamicTitle:!0})}else $("#selection-panel input").val("https://dokucraft.co.uk/stash/"+toSearchURLParams({id:t})),$("#selection-panel a").text(`${e} file${1===e?"":"s"}`).attr("title","Click to view<br>IDs: "+s).attr("href",toSearchURLParams({id:t})).off("click").on("click",e=>goToPage(toSearchURLParams({id:t}),e));$("body").addClass("selection-panel-visible")}else $("#content .selected").removeClass("selected"),$("#selection-panel .diamond").removeClass("open").addClass("close"),$("body").removeClass("selection-panel-visible"),stash.cache.selectionPanelTimer=setTimeout(()=>{$("#selection-panel").remove(),stash.cache.selectionPanelTimer=null},1200)}const stashURL="https://dokucraft.co.uk/stash-files/",thumbnails="/stash/resources/thumbnails/",contentData="/stash/resources/content-data/",cors="https://cors-anywhere.herokuapp.com/",pages=["search","about","contributors","profile","details","submit","login","status"],abbr={category:"ca",contributor:"co",id:"id",size:"si",color:"cl"},longform={ca:"category",co:"contributor",id:"id",si:"size",cl:"color"},months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],opTime=1312035589,legacyTimeData=[{time:1312051806,id:0},{time:1314221974,id:1e3},{time:1317388666,id:2e3},{time:1319090950,id:3e3},{time:1323408627,id:4e3},{time:1327695347,id:5e3},{time:1332070004,id:6e3},{time:1335737826,id:7e3},{time:1339451376,id:8e3},{time:1346105014,id:9e3},{time:1354211287,id:1e4},{time:1361130865,id:11e3},{time:1366174956,id:12e3},{time:1368929856,id:13e3},{time:1372727962,id:14e3},{time:1378402172,id:15e3},{time:1389405209,id:16e3},{time:1402541195,id:17e3},{time:1414832158,id:18e3},{time:1451429522,id:19e3},{time:1460483638,id:19160},{time:1460536130,id:19348},{time:1463713609,id:19398},{time:1464735265,id:19404},{time:1465704958,id:19415},{time:1469905303,id:19433},{time:1470202364,id:19444},{time:1478645533,id:19693},{time:1500235159,id:20122},{time:1512422195,id:20145}],rgxSize=/^\s*([<>]?=|[<>])?\s*(\d+)(\s*x\s*(\d+))?\s*$/,rgxCategory=/^(.+)\/.+_\d+/,rgxContributor=/\/(.+)_\d+/,rgxID=/\/.+_(\d+)/,rgxExt=/\.([^.]*)$/,bLazy=new Blazy({success:e=>{if($(e).is("img.animated")&&!$(e).parent().attr("data-animation-done"))if($(e).parent().attr("data-animation-done",!0),$(e).parent().is(".mcmeta"))$.ajax({url:e.src+".mcmeta",success:t=>{let a=new MCAnimation(e.src,JSON.parse(t));stash.animations.push(a),$(e).parent().removeClass("no-thumbnail"),$(e).hide().after(a.canvas),$(e).siblings(".thumbnail").remove()}});else{let t=new MCAnimation(e.src);stash.animations.push(t),$(e).parent().removeClass("no-thumbnail"),$(e).hide().after(t.canvas),$(e).siblings(".thumbnail").remove()}}});var stash={categories:[],contributors:[],page:{},cache:{},displayOptions:{grouping:"none",sorting:"id",order:"des",scale:1},animations:[],files:{all:[],category:{}},selection:{files:[]},typeNames:{model:"Model",ctm:"CTM",cit:"CIT",set:"Texture set"}};$(window).on("popstate",loadPage),stash.getZIPContent=((e,t=(e=>e.match(/\.png$/)?"base64":"text"))=>stash.cache.zipContent&&stash.cache.zipContent.file==e?Promise.resolve(stash.cache.zipContent.content):$.ajax(stashURL+e,{xhrFields:{responseType:"blob"}}).then(e=>JSZip.loadAsync(e)).then(e=>Promise.all(Object.keys(e.files).filter(t=>!e.files[t].dir).map(a=>e.file(a).async(t(a)).then(t=>({path:a.split("/").slice(0,-1).join("/"),name:a.split("/").pop(),content:t,size:e.files[a]._data.uncompressedSize}))))).then(t=>(stash.cache.zipContent={file:e,content:t},t)).catch(t=>(stash.notify(`Failed to load file: ${e}<br>(${t.status} ${t.statusText})`,null,"error"),Promise.reject(t)))),stash.getImage=(e=>new Promise((t,a)=>{const s=new Image;s.onload=(()=>t(s)),s.onerror=(()=>a(s)),s.src=e})),stash.toggleSidebar=(()=>{$("#sidebar-wrapper").toggleClass("closed"),"function"==typeof stash.page.onSidebarToggle&&stash.page.onSidebarToggle($("#sidebar-wrapper").is(".closed"))}),stash.blockInput=((e,t=!0)=>{removeAllTooltips();const a=E("div").addClass("fullscreen-blocker "+(e||"")).appendTo($("body")).animate({opacity:1},500);return t&&a.attr("tabindex",1).focus().on("keyup",e=>{27===e.which&&stash.removeInputBlocker(a)}),a}),stash.removeInputBlocker=(e=>new Promise(t=>{e.addClass("fading").stop().animate({opacity:0},250,()=>{e.remove(),t()})})),stash.fullscreenImage=(e=>stash.blockInput().append(E("div").addClass("fs-img-container").append(E("div").addClass("img b-lazy").attr("data-src",e))).on("click",function(){stash.removeInputBlocker($(this))})),stash.page.modal=(()=>(removeAllTooltips(),E("div").addClass("modal").appendTo("#content-wrapper").append(E("div").addClass("content")).on("click",e=>{e.target==e.currentTarget&&stash.page.closeModal($(e.target))}))),stash.page.closeModal=(e=>new Promise(t=>{e.addClass("fading"),setTimeout(()=>{e.remove(),t(e)},250)})),stash.diamond={},stash.diamond.create=((e,t)=>E("div").addClass("diamond "+(t||"")).css("font-size",e+"px").append(E("div").addClass("fill"),E("div").addClass("cover"),E("div").addClass("content-wrapper").append(E("div").addClass("content")))),stash.diamond.setProgress=((e,t)=>{if(1==t)e.removeClass("indeterminate").children(".fill").css("clip-path","none");else{const a=Math.floor(100*(1-t));e.removeClass("indeterminate").children(".fill").css("clip-path",`inset(0 ${a}% -1px 0)`)}}),stash.search=(e=>{const t=stringToIDList(e.id),a=stringToSize(e.size);let s=stash.files.all;return null!=e.category&&e.category.length>0&&(s=~e.category.indexOf(",")?e.category.split(",").map(e=>stash.files.category[e]).reduce((e,t)=>e.concat(t),[]):stash.files.category[e.category]),null!=e.contributor&&e.contributor.length>0&&(s=s.filter(contributorFilter(e.contributor.split(",")))),null!=t&&t.length>0&&(s=s.filter(idFilter(t))),null!=e.time&&e.time.length>0&&(s=s.filter(timeFilter(e.time[0],e.time[1]))),null!=a&&(s=s.filter(sizeFilter(a))),s}),stash.notify=((e,t,a)=>{let s=E("div").addClass("notification").html(e),o=E("div").addClass("button-row");"string"==typeof a&&s.addClass(a),t&&t.forEach(e=>{o.append(E("div").addClass("button inline").text(e.text).on("click",()=>{"function"==typeof e.func&&e.func(),removeNotification(s)}))}),o.append(E("div").addClass("button inline").text("Dismiss").on("click",e=>{removeNotification(s)})),s.append(o).appendTo($("body"));let n=s.outerHeight();$(".notification").not(s).animate({bottom:`+=${n+20}px`},250)}),stash.chart={},$(()=>{stash.chart.timeline=(()=>{const e={maintainAspectRatio:!1,legend:{display:!1},tooltips:{bodyFontSize:16,footerFontSize:0,callbacks:{label:e=>"    "+e.yLabel,title:()=>"",footer:()=>" "},custom:e=>{e&&(e.displayColors=!1)}}},t=$("#title").css("color").replace(/rgb\(([^)]+)\)/,(e,t)=>`rgba(${t},0.2)`),a=$("#header-bar .menu-group").css("color"),s=$("#header-bar").css("border-bottom-color"),o=$("#title").css("color");return(n,...i)=>{let r=1/0,l=-1/0;const c={};for(let e=0;e<n.length;e++){const t=n[e],a=getTimestamp(t);r=Math.min(r,a),l=Math.max(l,a);const s=new Date(1e3*a),o=s.getFullYear()+" Q"+Math.floor((s.getMonth()+3)/3);(c[o]=c[o]||[]).push(t)}const d=new Date(1e3*r),p=new Date(1e3*l),h=d.getFullYear(),u=p.getFullYear();for(let e=d.getFullYear();e<=u;e++){const t=e!=h?1:Math.floor((d.getMonth()+3)/3),a=e!=u?4:Math.floor((p.getMonth()+3)/3);for(let s=t;s<=a;s++)c[e+" Q"+s]=c[e+" Q"+s]||[]}const g=Object.keys(c);g.sort(naturalSorter);const m=n=>{const i=E("canvas");return setTimeout(()=>new Chart(i,{type:"line",options:$.extend({},e,{title:{display:!0,fontColor:a,text:n.title},scales:{xAxes:[{id:"xAxis1",gridLines:{display:!1},ticks:{fontColor:a,callback:e=>e.split(" ")[1]}},{id:"xAxis2",gridLines:{display:!1},ticks:{fontColor:a,callback:e=>~e.indexOf("Q1")||0==g.indexOf(e)?e.split(" ")[0]:""}}],yAxes:[{gridLines:{color:s},ticks:{fontColor:a,beginAtZero:!0,suggestedMax:n.maxValue}}]}}),data:{labels:g,datasets:[{data:n.dataHandler(g,c),xAxisID:"xAxis1",backgroundColor:t,borderColor:o,pointHoverBorderColor:"#fff",borderWidth:2,pointRadius:5,lineTension:0}]}}),100),E("div").addClass("chart").append(i)};return"string"==typeof i[0]?m({title:i[0],dataHandler:i[2],maxValue:i[3]}):i.map(m)}})()}),stash.selection.contains=(e=>~stash.selection.files.indexOf(e)),stash.selection.toString=(()=>stash.selection.files.map(e=>parseInt(getID(e))).sort().reduce((e,t)=>{if(0==e.length)return e.push([t]),e;let a=e[e.length-1];return a[a.length-1]==t-1?(a.push(t),e[e.length-1]=a.filter((e,t)=>0==t||t==a.length-1)):e.push([t]),e},[]).reduce((e,t,a)=>{let s=a>0?",":"";return 1==t.length?e+=s+t[0]:e+=`${s}${t[0]}-${t[1]}`,e},"")),stash.selection.download=(()=>{const e=stash.diamond.create(300,"indeterminate");e.find(".content").append("Working...");const t=stash.blockInput("flex no-scroll",!1).append(e),a=new JSZip,s=[];let o=stash.selection.files.slice();o=o.concat(o.filter(e=>stash.data[e].M&&e.match(/\.png$/)).map(e=>e+".mcmeta"));let n=0,i=!1;for(let r=0;r<o.length&&!i;r++)s.push($.ajax(stashURL+o[r],{xhrFields:{responseType:"blob"}}).done(t=>{a.file(o[r],t,{createFolders:!0}),stash.diamond.setProgress(e,++n/o.length)}).fail(e=>{i=!0,s.forEach(e=>e.abort()),stash.notify(`Failed to load file: ${o[r]}<br>(${e.status} ${e.statusText})`,null,"error"),stash.removeInputBlocker(t)}));Promise.all(s).then(()=>{a.generateAsync({type:"blob"}).then(e=>{saveAs(e,"dokustash.zip"),stash.removeInputBlocker(t)})})}),stash.selectFile=(e=>{stash.selection.contains(e)||(stash.selection.files.push(e),fileSelectionChanged())}),stash.selectFiles=(e=>{e.forEach(e=>{stash.selection.contains(e)||stash.selection.files.push(e)}),fileSelectionChanged()}),stash.deselectFile=(e=>{let t=stash.selection.files.indexOf(e);t>-1&&(stash.selection.files.splice(t,1),fileSelectionChanged())}),stash.deselectAllFiles=(()=>{stash.selection.files=[],fileSelectionChanged()}),stash.setWorkProgress=(e=>{e=e||stash.cache.workProgress,stash.cache.workProgress=e,$("#work-progress-bar").removeClass("indeterminate").stop().animate({width:e+"%"},250)}),stash.workIndeterminate=(()=>{$("#work-progress-bar").addClass("indeterminate").stop()}),stash.workError=(e=>{stash.cache.workProgress;$("#work-progress-bar").css("background-color","#f58"),$("#work-progress-bar").is(".indeterminate")&&$("#work-progress-bar").removeClass("indeterminate").css("width","100%"),setTimeout(()=>{$("#work-progress-bar").stop().animate({width:0},500,()=>$("#work-progress-bar").css("background-color","#58f")),"function"==typeof e&&e()},3500)}),stash.workComplete=(()=>{stash.page.hasWork=!1,stash.cache.workProgress=0,$("#work-progress-bar").is(".indeterminate")?$("#work-progress-bar").stop().removeClass("indeterminate").css("width","100%").animate({height:0},500,()=>$("#work-progress-bar").css("width",0).css("height","4px")):$("#work-progress-bar").stop().animate({height:0,width:"100%"},500,()=>$("#work-progress-bar").css("width",0).css("height","4px"))}),stash.page.loaded=(()=>{$("#content-wrapper").css("opacity",0).animate({opacity:1},500),initSelectric(),stash.page.hasWork||stash.workComplete()}),$(()=>{$.getJSON("/stash/data.json",e=>{stash.data=e,stash.files.all=Object.keys(stash.data);const t=["V","LV","DV","M","LM","DM"],a=new Set,s=new Set;let o=0;stash.files.all.forEach(e=>{const n={};stash.data[e].P.forEach((e,a)=>{0!==e&&(n[t[a]]=hexToRgb(e))}),stash.data[e].P=n,a.add(getCategory(e)),s.add(getContributor(e));const i=parseInt(getID(e));o=Math.max(o,i)}),stash.categories=Array.from(a).sort(naturalSorter),stash.contributors=Array.from(s).sort(naturalSorter);for(var n=0;n<stash.categories.length;n++)stash.files.category[stash.categories[n]]=stash.files.all.filter(categoryFilter(stash.categories[n]));if(null!=localStorage.getItem("stash-max-id")){let e=parseInt(localStorage.getItem("stash-max-id"));if(o>e){let t={id:e+1+"-"+o},a=stash.search(t);stash.notify(`${a.length} new file${a.length>1?"s":""} has been added to the stash.`,[{text:"View",func:()=>{goToPage(toSearchURLParams(t))}}]),localStorage.setItem("stash-max-id",o)}}else localStorage.setItem("stash-max-id",o);new Awesomplete($("#category-input")[0],{list:stash.categories,autoFirst:!0,minChars:1,sort:bestMatchSort($("#category-input"),","),filter:(e,t)=>{const a=t.split(",");return a[a.length-1].length>=1&&~e.toLowerCase().indexOf(a[a.length-1].toLowerCase())},replace:e=>{const t=$("#category-input").val().split(",").slice(0,-1).join(",");$("#category-input").val((t.length>0?t+",":"")+e)}}),new Awesomplete($("#contributor-input")[0],{list:stash.contributors,autoFirst:!0,sort:bestMatchSort($("#contributor-input"),","),filter:(e,t)=>{const a=t.split(",");return a[a.length-1].length>=2&&~e.toLowerCase().indexOf(a[a.length-1].toLowerCase())},replace:e=>{const t=$("#contributor-input").val().split(",").slice(0,-1).join(",");$("#contributor-input").val((t.length>0?t+",":"")+e)}}),$(".awesomplete>.search-on-enter").on("awesomplete-open",function(){$(this).addClass("awesomplete-open")}),$(".awesomplete>.search-on-enter").on("blur",function(){$(this).removeClass("awesomplete-open")}),loadPage()}),$(".menu-title").on("mouseenter",e=>{let t=$(e.currentTarget),a=t.find(".menu").addClass("title-hover").css("left",t[0].getBoundingClientRect().left),s=a[0].getBoundingClientRect(),o=document.documentElement.clientWidth;s.right>o&&a.css({left:"auto",right:0})}),$(".menu-title").on("mouseleave",e=>{$(e.currentTarget).find(".menu").removeClass("title-hover")}),$("#color-picker").farbtastic({callback:"#color-picker-input",width:200,onStop:filterResultsByColor}),$("#color-picker-toggle").on("change",e=>{$("#color-picker-toggle").is(":checked")?filterResultsByColor():($("#content").find(".result,.group").removeClass("hidden"),0==$("#content>.result,#content>.group>.result").length?$("#results-count").text(""):$("#results-count").text("Results: "+$("#content .result").length))}),$("#color-picker-input").on("change",e=>{$("#content .result").length<500&&filterResultsByColor()}),$('#search-form>.checkbox>input[type="checkbox"]').each((e,t)=>{$(t).on("change",e=>{$(t).is(":checked")?$(t).parent().next(".container").addClass("open"):$(t).parent().next(".container").removeClass("open")})}),$(".search-on-enter").on("keyup",function(e){13==e.which&&($(this).is(".awesomplete-open")?$(this).removeClass("awesomplete-open"):searchWithForm())}),$(window).on("scroll",()=>{for(const e of document.querySelectorAll(".tippy-popper")){const t=e._tippy;t.state.visible&&(t.popperInstance.disableEventListeners(),t.hide())}}),tippy(".tt",{placement:"right-start",arrow:!0,hideOnClick:!1,animation:"perspective",delay:200,updateDuration:0,popperOptions:{modifiers:{preventOverflow:{enabled:!1}}}});let e=()=>{setTimeout(()=>{bLazy.revalidate(),e()},$("#results-count").attr("data-val")<1e3?500:2e3)};e()});