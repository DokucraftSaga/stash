function loadPage(){removeAllTooltips(),selectionChange(),$("#results-count").text("");let t=getURLParams();null!=t?null!=t.page&&~pages.indexOf(t.page)?$("#content").load(`pages/${t.page}.html`):null==t.profile?null==t.details?null==t.category&&null==t.contributor&&null==t.id&&null==t.size||(setUserInput(t.category,t.contributor,t.id,t.size,t.color?"#"+t.color:null),search(t.category,t.contributor,stringToIDList(t.id),stringToSize(t.size),t.color?"#"+t.color:null)):showDetails(stash.files.all.filter(idFilter(stringToIDList(t.details)))[0]):showProfile(t.profile):showCategories()}function removeAllTooltips(){$(".tippy-popper").remove()}function setUserInput(t,e,a,n,r){$("#category-input").val(t),$("#contributor-input").val(e),$("#id-input").val(a),$("#size-input").val(n),$("#color-picker-toggle").prop("checked",null!=r).change(),null!=r&&$.farbtastic("#color-picker").setColor(r)}function showCategories(){"function"==typeof pageCleanup&&(pageCleanup(),pageCleanup=null),$("#content").empty(),removeAllTooltips(),selectionChange(),setUserInput(),$("#results-count").text(""),$("#sorting-options").addClass("hidden");for(let t=0;t<stash.categories.length;t++){let e=stash.categories[t],a=toURLParams({category:e}),n=$("<a>",{class:"category button",href:a});n.on("click",t=>{setUserInput(e),search(e),history.pushState(null,"",a),t.preventDefault()}),n.append($("<div>",{class:"img b-lazy"}).attr("data-src",`/stash/resources/category-icons/${e}.png`).append($("<div>",{class:"spinner-container"}).append($("<div>",{class:"spinner"})))),n.append($("<p>",{text:e})),n.attr("title",`<h3>${e}</h3><br>${stash.files.category[e].length} files`),tippy(n[0],{position:"right",arrow:!0,animation:"perspective"}),$("#content").append(n)}$(".spinner-container").css("display","none").slice(0,10).css("display","flex"),window.scrollTo(0,0)}function showDetails(t,e){"function"==typeof pageCleanup&&(pageCleanup(),pageCleanup=null),$("#content").empty().append('<div class="hint">Loading...</div>').load("pages/details.html",()=>{removeAllTooltips(),selectionChange(),setUserInput(),$("#results-count").text(""),$("#sorting-options").addClass("hidden");let a=`${stashURL}${t}.png`,n=stash.data[t].S,r=null;n[1]/n[0]>6&&n[1]%n[0]==0?r=$("#texture-preview").append($("<img>",{class:"animated b-lazy",src:"/stash/resources/transparent.png"}).attr("data-src",a).attr("data-width",128).attr("data-height",128)).append($("<div>",{class:`img b-lazy thumbnail${n[0]<128?" pixelated":""}`}).attr("data-src",`${thumbnails}${t}.png`).append($("<div>",{class:"spinner-container"}).append($("<div>",{class:"spinner"})))):((n[0]>128||n[1]>128)&&(a=`${thumbnails}${t}.png`),r=$("#texture-preview").append($("<div>",{class:`img b-lazy${n[0]<128&&n[1]<128?" pixelated":""}`}).attr("data-src",a).append($("<div>",{class:"spinner-container"}).append($("<div>",{class:"spinner"}))))),r.append($("<a>",{class:"download-image-button",download:t.split("/")[1],title:"Download",href:stashURL+t+".png"})),tippy(r.find(".download-image-button")[0],{arrow:!0,animation:"perspective"}),r.append($("<div>",{class:"fullscreen-button",title:"Fullscreen"}).on("click",e=>{$("#fullscreen-cover").removeClass("hidden"),$("#fullscreen-cover>.img").removeClass("b-loaded b-error").attr("style","").attr("data-src",`${stashURL}${t}.png`).append($("<div>",{class:"spinner-container"}).append($("<div>",{class:"spinner"})))})),tippy(r.find(".fullscreen-button")[0],{arrow:!0,animation:"perspective"});let o=getID(t),s=stash.data[t].T||getApproxTime(o),i=getContributor(t),l=getCategory(t);$(".contributor-name").text(i).attr("title",`Click to see all textures by ${i}`).attr("href",toURLParams({contributor:i})).on("click",t=>{setUserInput(null,i),search(null,i),history.pushState(null,"",toURLParams({contributor:i})),t.preventDefault()}),$(".file-id").text(o),$(".file-category").text(l).attr("title",`Click to see all textures in ${l}`).attr("href",toURLParams({category:l})).on("click",t=>{setUserInput(l),search(l),history.pushState(null,"",toURLParams({category:l})),t.preventDefault()}),$(".image-size").text(n.join("x")),$(".file-date").text(formatDate(s)),tippy("#content .info a",{position:"right",arrow:!0,animation:"perspective"});let p=stash.files.all.filter(contributorFilter(i)).sort(idSort),c=p.indexOf(t)+1,d=p.filter(categoryFilter(l)).indexOf(t)+1,u=stash.files.all.sort(idSort),h=u.indexOf(t)+1,g=u.filter(categoryFilter(l)).indexOf(t)+1;var f=s-opTime,m=Math.floor(f/86400);$("#misc-stats").append($("<p>",{text:`This is the ${formatNum(c,!0)} texture ${i} posted and the ${formatNum(d,!0)} texture by them in ${l}.`})).append($("<p>",{text:`It is the ${formatNum(h,!0)} texture added to DokuStash and the ${formatNum(g,!0)} texture added to ${l}.`})).append($("<p>",{text:`It was posted approximately ${formatNum(m)} days after the continuation project started.`})),window.scrollTo(0,0),"function"==typeof e&&e()})}function showProfile(t,e){"function"==typeof pageCleanup&&(pageCleanup(),pageCleanup=null),$("#content").empty().append('<div class="hint">Loading...</div>').load("pages/profile.html",()=>{removeAllTooltips(),selectionChange(),setUserInput(),$("#results-count").text(""),$("#sorting-options").addClass("hidden");let a=stash.files.all.filter(contributorFilter(t)),n={},r=1/0,o=-1/0,s={};for(let t=0;t<a.length;t++){let e=a[t],i=getCategory(e),l=getID(e),p=stash.data[e].T||getApproxTime(l);n[i]=(n[i]||0)+1,r=Math.min(r,p),o=Math.max(o,p);let c=new Date(1e3*p),d=c.getFullYear()+" Q"+Math.floor((c.getMonth()+3)/3);s[d]=(s[d]||0)+1}let i=stash.categories.filter(t=>null!=n[t]);i.sort((t,e)=>n[e]-n[t]),i=i.slice(0,5);let l=new Date(1e3*r),p=new Date(1e3*o),c=l.getFullYear(),d=p.getFullYear();for(let t=l.getFullYear();t<=d;t++){let e=t!=c?1:Math.floor((l.getMonth()+3)/3),a=t!=d?4:Math.floor((p.getMonth()+3)/3);for(let n=e;n<=a;n++)s[t+" Q"+n]=s[t+" Q"+n]||0}let u=[];for(quarter in s)s.hasOwnProperty(quarter)&&u.push(quarter);u.sort(naturalSorter),$(".contributor-name").text(t),$(".contributor-stats").append($("<p>",{text:`Number of contributions: ${a.length}`})).append($("<p>",{text:`First contribution: ${formatDate(r)}`,title:"This date is only an estimate based on IDs"}));for(let t=0;t<i.length;t++)i[t],$(".top-categories>tbody").append($("<tr>").append($("<td>",{text:i[t]})).append($("<td>",{text:n[i[t]]})).append($("<td>",{text:Math.floor(n[i[t]]/stash.files.category[i[t]].length*100+.5)+"%"})));let h={maintainAspectRatio:!1,legend:{display:!1},scales:{xAxes:[{id:"xAxis1",gridLines:{display:!1},ticks:{callback:t=>t.split(" ")[1]}},{id:"xAxis2",gridLines:{display:!1},ticks:{callback:t=>~t.indexOf("Q1")||0==u.indexOf(t)?t.split(" ")[0]:""}}],yAxes:[{gridLines:{color:"#333"},ticks:{beginAtZero:!0}}]},tooltips:{bodyFontSize:16,footerFontSize:0,callbacks:{label:t=>"    "+t.yLabel,title:()=>"",footer:()=>" "},custom:t=>{t&&(t.displayColors=!1)}}};new Chart("activity-total-contributions",{type:"line",options:$.extend({},h,{title:{display:!0,text:"Total number of contributions"}}),data:{labels:u,datasets:[{data:u.map(t=>s[t]).reduce((t,e)=>(t.push((t.length&&t[t.length-1]||0)+e),t),[]),xAxisID:"xAxis1",backgroundColor:"rgba(85, 136, 255, 0.2)",borderColor:"#58f",pointHoverBorderColor:"#fff",borderWidth:2,pointRadius:5,lineTension:0}]}}),new Chart("activity-per-year-contributions",{type:"line",options:$.extend({},h,{title:{display:!0,text:"Number of contributions per quarter"}}),data:{labels:u,datasets:[{data:u.map(t=>s[t]),xAxisID:"xAxis1",backgroundColor:"rgba(85, 136, 255, 0.2)",borderColor:"#58f",pointHoverBorderColor:"#fff",borderWidth:2,pointRadius:5,lineTension:0}]}}),tippy(".top-categories th",{arrow:!0,animation:"perspective"}),tippy(".contributor-stats>*",{position:"right",arrow:!0,animation:"perspective"}),window.scrollTo(0,0),"function"==typeof e&&e()})}function goToPage(t,e){"function"==typeof pageCleanup&&(pageCleanup(),pageCleanup=null),"root"==t?(removeAllTooltips(),$("#results-count").text(""),setUserInput(),$("#sorting-options").addClass("hidden"),showCategories(),history.pushState(null,"","/stash/")):$("#content").empty().append('<div class="hint">Loading...</div>').load(`pages/${t}.html`,()=>{removeAllTooltips(),$("#results-count").text(""),setUserInput(),$("#sorting-options").addClass("hidden"),history.pushState(null,"",toURLParams({page:t})),window.scrollTo(0,0)}),null!=e&&e.preventDefault()}function getURLParams(){if(location.search.length<4)return null;let t,e=/[?&]([A-z0-9]+)=([^&]+)/g,a={};for(;t=e.exec(location.search);)a[t[1]]=decodeURIComponent(t[2].replace(/\+/g,"%20"));return a}function toURLParams(t){let e=[];for(let a in t)t.hasOwnProperty(a)&&null!=t[a]&&t[a].length>0&&e.push(`${0==e.length?"?":"&"}${a}=${encodeURIComponent(t[a]).replace(/%20/g,"+")}`);return e.join("")}function formatNum(t,e){let a=t;if("undefined"!=typeof Intl&&void 0!==Intl.NumberFormat&&(a=(new Intl.NumberFormat).format(t)),!e)return a;let n=t%10,r=t%100;return 1==n&&11!=r?a+"st":2==n&&12!=r?a+"nd":3==n&&13!=r?a+"rd":a+"th"}function naturalSorter(t,e){var a,n,r,o,s,i,l=0,p=/(\.\d+)|(\d+(\.\d+)?)|([^\d.]+)|(\.\D+)|(\.$)/g;if(t===e)return 0;for(a=t.toLowerCase().match(p),n=e.toLowerCase().match(p),i=a.length;l<i;){if(!n[l])return 1;if(r=a[l],o=n[l++],r!==o)return s=r-o,isNaN(s)?r>o?1:-1:s}return n[l]?-1:0}function bestMatchSort(t){return(e,a)=>{let n=t.val().toLowerCase(),r=e.toLowerCase().indexOf(n)-a.toLowerCase().indexOf(n);if(0!=r)return r;let o=new RegExp(n,"gi");return a.match(o).length-e.match(o).length}}function idSort(t,e){return getID(t)-getID(e)}function lerp(t,e,a){return e*a+t*(1-a)}function getApproxTime(t){if(t>legacyTimeData[legacyTimeData.length-1].id)return-1;for(let e=0;e<legacyTimeData.length;e++)if(t>legacyTimeData[e].id&&t<=legacyTimeData[e+1].id)return lerp(legacyTimeData[e].time,legacyTimeData[e+1].time,(t-legacyTimeData[e].id)/(legacyTimeData[e+1].id-legacyTimeData[e].id));return-1}function formatDate(t){let e=new Date(1e3*t);return months[e.getMonth()]+" "+e.getDate()+", "+e.getFullYear()}function getCategory(t){return rgxCategory.exec(t)[1]}function getContributor(t){return rgxContributor.exec(t)[1]}function getID(t){return rgxID.exec(t)[1]}function categoryFilter(t){let e=new RegExp(`^${t}/`);return t=>t.match(e)}function contributorFilter(t){let e=new RegExp(`/${t}_[0-9]+$`);return t=>t.match(e)}function stringToIDList(t){if(null==t)return null;if(0==t.length)return null;let e=[],a=t.split(",");for(let t=0;t<a.length;t++){let n=a[t];if(~n.indexOf("-")){let t=n.split("-");e.push({min:parseInt(t[0]),max:parseInt(t[1])})}else e.push({min:parseInt(n),max:parseInt(n)})}return e}function idMatches(t,e){for(let a=0;a<e.length;a++)if(t>=e[a].min&&t<=e[a].max)return!0;return!1}function idFilter(t){return e=>{let a=e.split("_");return idMatches(a[a.length-1],t)}}function stringToSize(t){if(null==t)return null;if(!(t=t.trim()).match(rgxSize))return null;let e=rgxSize.exec(t);return{o:e[1],v:[parseInt(e[2]),parseInt(e[4]||e[2])]}}function sizeFilter(t){return"="==t.o||null==t.o?e=>stash.data[e].S[0]==t.v[0]&&stash.data[e].S[1]==t.v[1]:"<"==t.o?e=>stash.data[e].S[0]<t.v[0]&&stash.data[e].S[1]<t.v[1]:">"==t.o?e=>stash.data[e].S[0]>t.v[0]&&stash.data[e].S[1]>t.v[1]:"<="==t.o?e=>stash.data[e].S[0]<=t.v[0]&&stash.data[e].S[1]<=t.v[1]:">="==t.o?e=>stash.data[e].S[0]>=t.v[0]&&stash.data[e].S[1]>=t.v[1]:void 0}function hexToRgb(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(t,e,a,n)=>e+e+a+a+n+n);var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:null}function rgbToLab(t){var e,a,n,r=t[0]/255,o=t[1]/255,s=t[2]/255;return r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92,s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92,e=(.4124*r+.3576*o+.1805*s)/.95047,a=(.2126*r+.7152*o+.0722*s)/1,n=(.0193*r+.1192*o+.9505*s)/1.08883,e=e>.008856?Math.pow(e,1/3):7.787*e+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,n=n>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*a-16,500*(e-a),200*(a-n)]}function deltaE(t,e){var a=t[0]-e[0],n=t[1]-e[1],r=t[2]-e[2],o=Math.sqrt(t[1]*t[1]+t[2]*t[2]),s=o-Math.sqrt(e[1]*e[1]+e[2]*e[2]),i=n*n+r*r-s*s,l=a/1,p=s/(1+.045*o),c=(i=i<0?0:Math.sqrt(i))/(1+.015*o),d=l*l+p*p+c*c;return d<0?0:Math.sqrt(d)}function filterResultsByColor(){if(0==$("#content>.result,#content>.group>.result").length)return;let t=$.farbtastic("#color-picker"),e=rgbToLab(hexToRgb(t.color)),a=0,n=0,r=$("#results-count").text("Results: 0"),o=$("#content").find(".result");o.each((s,i)=>{let l=stash.data[$(i).attr("data-file")].P;for(let s in l)if(l.hasOwnProperty(s)&&l[s]){if(t.hsl[1]<.5&&~s.indexOf("V"))continue;if(t.hsl[1]>=.5&&~s.indexOf("M"))continue;if(deltaE(e,rgbToLab(l[s]))<=16)return $(i).show(),a++,n++,r.text(`Results: ${a}`),void(n==o.length&&updateResultGroupVisibility())}$(i).hide(),++n==o.length&&updateResultGroupVisibility()})}function showResults(t){if($("#content").empty(),0==t.length)return $("#content").append($("<div>",{class:"hint",text:"No results"})),void $("#results-count").text("");if(t.length>2500)return $("#content").append($("<div>",{class:"hint",text:"Too many results (2500+), try narrowing your search"})),void $("#results-count").text("");$("#results-count").text(`Results: ${t.length}`);for(let e=0;e<t.length;e++){let a=t[e],n=`${stashURL}${a}.png`,r=stash.data[a].S,o=null;r[1]/r[0]>6&&r[1]%r[0]==0?o=$("<div>",{class:"result"}).append($("<img>",{class:"animated b-lazy",src:"/stash/resources/transparent.png"}).attr("data-src",n).attr("data-width",128).attr("data-height",128)).append($("<div>",{class:`img b-lazy thumbnail${r[0]<128?" pixelated":""}`}).attr("data-src",`${thumbnails}${a}.png`).append($("<div>",{class:"spinner-container"}).append($("<div>",{class:"spinner"})))):((r[0]>128||r[1]>128)&&(n=`${thumbnails}${a}.png`),o=$("<div>",{class:"result"}).append($("<div>",{class:`img b-lazy${r[0]<128&&r[1]<128?" pixelated":""}`}).attr("data-src",n).append($("<div>",{class:"spinner-container"}).append($("<div>",{class:"spinner"}))))),o.attr("data-file",a),o.on("click",t=>{showDetails(a,()=>{history.pushState(null,"",toURLParams({details:getID(a)}))})}),o.on("contextmenu",t=>{o.is(".selected")?o.removeClass("selected"):o.addClass("selected"),selectionChange(),t.preventDefault(),t.stopPropagation()}),o.append($("<a>",{class:"download-image-button",download:a.split("/")[1],title:"Download",href:stashURL+a+".png"}).on("click",t=>{t.stopPropagation()}).on("contextmenu",t=>{t.stopPropagation()})),tippy(o.find(".download-image-button")[0],{arrow:!0,animation:"perspective"}),o.append($("<div>",{class:"fullscreen-button",title:"Fullscreen"}).on("click",t=>{$("#fullscreen-cover").removeClass("hidden"),$("#fullscreen-cover>.img").removeClass("b-loaded b-error").attr("style","").attr("data-src",`${stashURL}${a}.png`).append($("<div>",{class:"spinner-container"}).append($("<div>",{class:"spinner"}))),t.stopPropagation()})),tippy(o.find(".fullscreen-button")[0],{arrow:!0,animation:"perspective"});let s=getID(a);o.attr("title",`<h3>${getContributor(a)} #${s}</h3><br>Size: ${r[0]}x${r[1]}<br>Date: ${formatDate(stash.data[a].T||getApproxTime(s))}<br><br><i>${getCategory(a)}</i>`),tippy(o[0],{position:"right",arrow:!0,animation:"perspective"}),$("#content").append(o)}$("#sorting-options").removeClass("hidden"),updateResultGroups(),$(".spinner-container").css("display","none").slice(0,10).css("display","flex")}function updateResultGroupVisibility(){$("#content>.group").each((t,e)=>{$(e).show(),0==$(e).children(".result:visible").length&&$(e).hide()})}function updateResultGroups(){let t=$("#sorting-options .group").val(),e=$("#sorting-options .sort-prop").val(),a=$("#sorting-options .sort-order").val();$("#content").find(".group>.result").detach().appendTo($("#content")),$("#content>.group").remove(),"none"!=t&&$("#content").children(".result").each((e,a)=>{let n=$(a).attr("data-file");if("category"==t){let t=getCategory(n),e=$(`#content .group[data-group="${t}"]`);0==e.length&&((e=$("<div>",{class:"group"}).append($("<h3>",{text:t}))).attr("data-group",t),$("#content").append(e)),$(a).detach().appendTo(e)}else if("contributor"==t){let t=getContributor(n),e=$(`#content .group[data-group="${t}"]`);0==e.length&&((e=$("<div>",{class:"group"}).append($("<h3>",{text:t}))).attr("data-group",t),$("#content").append(e)),$(a).detach().appendTo(e)}else if("year"==t){let t=new Date(1e3*(stash.data[n].T||getApproxTime(getID(n)))).getFullYear(),e=$(`#content .group[data-group="${t}"]`);0==e.length&&((e=$("<div>",{class:"group"}).append($("<h3>",{text:t}))).attr("data-group",t),$("#content").append(e)),$(a).detach().appendTo(e)}else if("size"==t){let t=stash.data[n].S,e=t[1]>6*t[0]?"Animation Strips":t.join("x"),r=$(`#content .group[data-group="${e}"]`);0==r.length&&((r=$("<div>",{class:"group"}).append($("<h3>",{text:e}))).attr("data-group",e),$("#content").append(r)),$(a).detach().appendTo(r)}});let n=t=>{let n=t.children(".result").toArray().sort((t,a)=>{let n=$(t).attr("data-file"),r=$(a).attr("data-file");if("category"==e){let t=naturalSorter(getCategory(n),getCategory(r));return 0!=t?t:naturalSorter(n,r)}if("contributor"==e){let t=naturalSorter(getContributor(n),getContributor(r));return 0!=t?t:naturalSorter(n,r)}if("id"==e)return idSort(n,r);if("size"==e){let t=stash.data[n].S,e=stash.data[r].S,a=t[0]*t[1]-e[0]*e[1];return 0!=a?a:naturalSorter(n,r)}});"des"==a&&n.reverse(),t.append(n)};if("none"!=t){let e=$("#content").children(".group").toArray().sort((e,a)=>{let n=$(e).children("h3").text(),r=$(a).children("h3").text();if("size"==t){if("Animation Strips"==n)return-1;if("Animation Strips"==r)return 1;let t=n.split("x").map(t=>parseInt(t)),e=r.split("x").map(t=>parseInt(t));return t[0]*t[1]-e[0]*e[1]}return naturalSorter(n,r)});"des"==a&&e.reverse(),$("#content").append(e),$("#content").children(".group").each((t,e)=>{n($(e))})}else n($("#content"));updateResultGroupVisibility()}function selectionChange(){$("#content .selected").length>0?($("#selection-options").css("display","flex"),$("#link-to-selected").val($("#content .selected").toArray().map(t=>parseInt(getID($(t).attr("data-file")))).sort().reduce((t,e)=>{if(0==t.length)return t.push([e]),t;let a=t[t.length-1];return a[a.length-1]==e-1?(a.push(e),t[t.length-1]=a.filter((t,e)=>0==e||e==a.length-1)):t.push([e]),t},[]).reduce((t,e,a)=>{let n=a>0?",":"";return 1==e.length?t+=n+e[0]:t+=`${n}${e[0]}-${e[1]}`,t},"https://dokucraft.co.uk/stash/?id="))):$("#selection-options").css("display","none")}function search(t,e,a,n,r){$("#content").empty().append('<div class="hint">Searching...</div>');let o=stash.files.all;null!=t&&t.length>0&&(o=stash.files.category[t]),null!=e&&e.length>0&&(o=o.filter(contributorFilter(e))),null!=a&&a.length>0&&(o=o.filter(idFilter(a))),null!=n&&(o=o.filter(sizeFilter(n))),showResults(o.sort(naturalSorter)),r&&filterResultsByColor(),window.scrollTo(0,0)}function searchWithForm(){$(":focus").blur();let t=$("#category-input").val(),e=$("#contributor-input").val(),a=$("#id-input").val(),n=$("#size-input").val();if(t+e+a+n=="")return;let r=$("#color-picker-toggle").is(":checked");search(t,e,stringToIDList(a),stringToSize(n),r),history.pushState(null,"",toURLParams({category:t,contributor:e,id:a,size:n,color:r?$("#color-picker-input").val().substr(1):null}))}const stashURL="https://api.bitbucket.org/2.0/repositories/CCCode/dokustash/src/master/",thumbnails="/stash/resources/thumbnails/",cors="https://cors-anywhere.herokuapp.com/",pages=["about","contributors","submit","login"],months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],opTime=1312035589,legacyTimeData=[{time:1312051806,id:0},{time:1314221974,id:1e3},{time:1317388666,id:2e3},{time:1319090950,id:3e3},{time:1323408627,id:4e3},{time:1327695347,id:5e3},{time:1332070004,id:6e3},{time:1335737826,id:7e3},{time:1339451376,id:8e3},{time:1346105014,id:9e3},{time:1354211287,id:1e4},{time:1361130865,id:11e3},{time:1366174956,id:12e3},{time:1368929856,id:13e3},{time:1372727962,id:14e3},{time:1378402172,id:15e3},{time:1389405209,id:16e3},{time:1402541195,id:17e3},{time:1414832158,id:18e3},{time:1451429522,id:19e3},{time:1460483638,id:19160},{time:1460536130,id:19348},{time:1463713609,id:19398},{time:1464735265,id:19404},{time:1465704958,id:19415},{time:1469905303,id:19433},{time:1470202364,id:19444},{time:1478645533,id:19693},{time:1500235159,id:20122},{time:1512422195,id:20145}],rgxSize=/^\s*([<>]?=|[<>])?\s*(\d+)(\s*x\s*(\d+))?\s*$/,rgxCategory=/^(.+)\/.+_\d+/,rgxContributor=/\/(.+)_\d+/,rgxID=/\/.+_(\d+)/,bLazy=new Blazy({success:t=>{if($(t).is("img.animated")&&0==$(t).siblings(".mc-animation").length){let e=new MCAnimation(t.src);e.canvas.width=$(t).attr("data-width"),e.canvas.height=$(t).attr("data-height"),$(t).hide().after(e.canvas),$(t).siblings(".thumbnail").remove()}else setTimeout(()=>{$(t).find(".spinner-container").remove(),$(".spinner-container").css("display","none").slice(0,10).css("display","flex")},100)}});var stash={},pageCleanup=null;window.addEventListener("popstate",loadPage),$(()=>{$.getJSON("/stash/data.json",t=>{stash.data=t,stash.categories=[],stash.contributors=[],stash.cache={},stash.files={all:[],category:{}};for(let t in stash.data)if(stash.data.hasOwnProperty(t)&&stash.data[t]){~stash.files.all.indexOf(t)||stash.files.all.push(t);let e=t.split("/")[0];~stash.categories.indexOf(e)||stash.categories.push(e);let a=t.split("/")[1].split("_").slice(0,-1).join("_");~stash.contributors.indexOf(a)||stash.contributors.push(a)}for(var e=0;e<stash.categories.length;e++)stash.files.category[stash.categories[e]]=stash.files.all.filter(categoryFilter(stash.categories[e]));stash.categories.sort(naturalSorter),stash.contributors.sort(naturalSorter),new Awesomplete($("#category-input")[0],{list:stash.categories,autoFirst:!0,minChars:1,sort:bestMatchSort($("#category-input"))}),new Awesomplete($("#contributor-input")[0],{list:stash.contributors,autoFirst:!0,sort:bestMatchSort($("#contributor-input"))}),$("body").removeClass("preload"),loadPage()}),$("#color-picker").farbtastic({callback:"#color-picker-input",width:200,onStop:filterResultsByColor}),$("#color-picker-toggle").on("change",t=>{$("#color-picker-toggle").is(":checked")?filterResultsByColor():($("#content").find(".result,.group").show(),0==$("#content>.result,#content>.group>.result").length?$("#results-count").text(""):$("#results-count").text("Results: "+$("#content").find(".result").length))}),$("#color-picker-input").on("change",t=>{$("#content").children(".result").length<500&&filterResultsByColor()}),$('#search-form>.checkbox>input[type="checkbox"]').each((t,e)=>{$(e).on("change",t=>{$(e).is(":checked")?$(e).parent().next(".container").addClass("open"):$(e).parent().next(".container").removeClass("open")})}),$(".search-on-enter").on("keyup",t=>{13==t.which&&searchWithForm()}),$("#deselect-selected-button").on("click",t=>{$("#content .selected").removeClass("selected"),selectionChange()});let t=e=>{$("#download-selected-button").text("Working...").off("click",t);let a=new JSZip,n=$("#content .selected").toArray().map(t=>$(t).attr("data-file")),r=0;for(let e=0;e<n.length;e++){let o=new XMLHttpRequest;o.responseType="blob",o.onreadystatechange=function(){if(o.readyState==XMLHttpRequest.DONE&&200==o.status){a.file(n[e]+".png",o.response,{createFolders:!0}),r++;let s=Math.floor(100*r/n.length);$("#download-selected-button").css("background-image",`linear-gradient(to right, #58f ${s}%, #202020 ${s}%)`),r==n.length&&a.generateAsync({type:"blob"}).then(e=>{saveAs(e,"dokustash.zip"),$("#download-selected-button").text("Download").on("click",t).css("background-image","")})}},o.open("GET",cors+stashURL+n[e]+".png",!0),o.send()}};$("#download-selected-button").on("click",t),$("#copy-link-button").on("click",t=>{$("#link-to-selected").select(),document.execCommand("Copy")}),$("#fullscreen-cover").on("click",t=>{$("#fullscreen-cover").addClass("hidden")}),$(window).scroll(function(){$("body").addClass("scrolling"),clearTimeout(stash.cache.scrollingTimer),stash.cache.scrollingTimer=setTimeout(()=>{$("body").removeClass("scrolling")},400)}),tippy(".tt",{position:"right",arrow:!0,hideOnClick:!1,animation:"perspective"});let e=()=>{setTimeout(()=>{bLazy.revalidate(),e()},500)};e()});