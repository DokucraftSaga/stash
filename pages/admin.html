<link rel="stylesheet" href="/stash/pages/css/admin.css"/><div class="sp-admin-wrapper"><div class="sidebar"><h2>Control Panel</h2><h3>Files</h3><div class="sidebar-button" data-tab="review">Review Submissions</div><h3>Features</h3><div class="sidebar-button" data-tab="status">Status Page Manager</div><div class="sidebar-button" data-tab="implicit-tags">Implicit Tags Editor</div><div class="sidebar-button" data-tab="shortcuts">Shortcut Editor</div><h3>Documentation</h3><div class="sidebar-button" data-tab="file-list-docs">Status Page File Lists</div></div><div class="sp-admin-editor filler"><div class="blank-page"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><circle cx="256" cy="256" r="48" class="st0"/><path d="M96 160l-48 48v96l48 48zM416 160v192l48-48v-96zM304 48h-96l-48 48h192z" class="st0"/><g><path d="M416 400v-48c0-5.6-.9-10.9-2.3-16-7.1-27.6-31.9-48-61.7-48-35.3 0-64 28.7-64 64 0 29.8 20.4 54.6 48 61.7 5.1 1.3 10.4 2.3 16 2.3h48c0 8.8 7.2 16 16 16s16-7.2 16-16-7.2-16-16-16zm-32-16h-64v-8c0-30.9 25.1-56 56-56h8v64zM80 416c0 8.8 7.2 16 16 16s16-7.2 16-16h48c5.6 0 10.9-.9 16-2.3 27.6-7.1 48-31.9 48-61.7 0-35.3-28.7-64-64-64-29.8 0-54.6 20.4-61.7 48-1.3 5.1-2.3 10.4-2.3 16v48c-8.8 0-16 7.2-16 16zm48-96h8c30.9 0 56 25.1 56 56v8h-64v-64zM96 112v48c0 5.6.9 10.9 2.3 16 7.1 27.6 31.9 48 61.7 48 35.3 0 64-28.7 64-64 0-29.8-20.4-54.6-48-61.7-5.1-1.3-10.4-2.3-16-2.3h-48c0-8.8-7.2-16-16-16s-16 7.2-16 16 7.2 16 16 16zm32 16h64v8c0 30.9-25.1 56-56 56h-8v-64zM432 96c0-8.8-7.2-16-16-16s-16 7.2-16 16h-48c-5.6 0-10.9.9-16 2.3-27.6 7.1-48 31.9-48 61.7 0 35.3 28.7 64 64 64 29.8 0 54.6-20.4 61.7-48 1.3-5.1 2.3-10.4 2.3-16v-48c8.8 0 16-7.2 16-16zm-48 96h-8c-30.9 0-56-25.1-56-56v-8h64v64z" class="st0"/></g><g><path d="M208 464h96l48-48H160z" class="st0"/></g></svg></div></div></div><script>stash.page.identifier().then(stash.page.requireLogin(["admin"])).then(e=>{const t=/(^|[!@\(\) |])([A-z0-9_-]+|"[A-z0-9_ -]+"?)$/,s={status:()=>stash.firebase.db.collection("stash").doc("status").get().then(t=>{CCInput(e.find(".sp-admin-status-default-list"),{placeholder:"File list name",default:t.get("default"),lists:[{name:"File Lists",list:()=>e.find(".sp-admin-status-file-lists .list-name").toArray().map(e=>e.val())}]});const s=(t="",s="")=>{e.find(".sp-admin-status-file-lists").append(E("div").addClass("row file-list").append(CCInput(E("div").addClass("list-name"),{placeholder:"Name",default:t}),CCInput(E("div").addClass("list-id filler"),{placeholder:"List ID",default:s}),E("div").addClass("inline button").text("View").on("click",e=>{window.open(`https://docs.google.com/spreadsheets/u/0/d/${$(e.currentTarget).siblings(".list-id")[0].val()}/view`),e.preventDefault()}),E("div").addClass("inline button warning").text("X").on("click",e=>$(e.currentTarget).parent().remove())))},a=t.get("lists");Object.keys(a).forEach(e=>s(e,a[e])),e.find(".sp-admin-status-add-file-list-button").on("click",e=>s());let i=-1/0;e.find(".sp-admin-status-save-button").on("click",t=>{if(Date.now()-i>1e4){const t=stash.blockInput(null,!1),s=stash.notify("Working...","working"),a={default:e.find(".sp-admin-status-default-list")[0].val(),lists:{}};e.find(".sp-admin-status-file-lists .file-list").each((e,t)=>a.lists[$(t).children(".list-name")[0].val()]=$(t).children(".list-id")[0].val()),stash.firebase.db.collection("stash").doc("status").set(a).then(()=>{i=Date.now(),stash.removeInputBlocker(t),stash.dismissNotification(s),stash.notify("Changes saved.")}).catch(e=>{stash.removeInputBlocker(t),stash.dismissNotification(s),stash.notify("Failed to save changes.",null,"error"),console.error(e)})}else stash.notify("Please wait a few seconds before saving again.",null,"error")})}),"implicit-tags":()=>new Promise((s,a)=>{$.getJSON(stash.url.data+"implicit-tags.json").done(a=>{const i=(e="",s="")=>E("div").addClass("row").append(CCInput(E("div").addClass("tag-name"),{placeholder:"Name",default:e}),CCInput(E("div").addClass("tag-definition filler"),{placeholder:"Definition",default:s,lists:[{name:"Tags",list:()=>stash.tags.names.all},{name:"Contributors",list:stash.contributors}],value:e=>{const s=e.match(t);return s?s[2]:""},replace:(e,s,a)=>e.replace(t,(t,i,n,l)=>("@"!==i&&"Contributors"===a&&"@"!==e.substring(l-1,l)?(i.length?i:"")+"@":i)+(~s.indexOf(" ")?'"'+s+'"':s)),enter:(e,t)=>{e.length&&(stash.page.load(toURLParams({search:e})),$(t.currentTarget).blur())}}),E("div").addClass("inline button").text("Test").on("click",e=>{const t=stash.search($(e.currentTarget).siblings(".tag-definition")[0].val()).length;stash.notify(`This query matches ${t} file${1==t?"":"s"}.`),e.preventDefault()}),E("div").addClass("inline button warning").text("X").on("click",e=>$(e.currentTarget).parent().remove()));e.find(".sp-admin-it-list").append(Object.keys(a).map(e=>i(e,a[e]))),e.find(".sp-admin-it-add-tag-button").on("click",t=>e.find(".sp-admin-it-list").append(i()));let n=-1/0;e.find(".sp-admin-it-save-button").on("click",t=>{if(Date.now()-n>1e4){const t=stash.blockInput(null,!1),s=stash.notify("Working...","working"),a={};e.find(".sp-admin-it-list .row").each((e,t)=>a[$(t).children(".tag-name")[0].val()]=$(t).children(".tag-definition")[0].val()),stash.firebase.post("/tags/implicit",a).then(()=>{n=Date.now(),stash.removeInputBlocker(t),stash.dismissNotification(s),stash.notify("Changes saved. Refresh the page in a minute to get the update on your end.")}).catch(e=>{stash.removeInputBlocker(t),stash.dismissNotification(s),stash.notify("Failed to save changes.",null,"error"),console.error(e)})}else stash.notify("Please wait a few seconds before saving again.",null,"error")}),s()}).fail(e=>a(e))}),shortcuts:()=>new Promise((s,a)=>{$.getJSON(stash.url.data+"shortcuts.json").done(a=>{e.find(".sp-admin-sc-list").append(Object.keys(a).map(e=>((e="",s="")=>E("div").addClass("row").append(CCInput(E("div").addClass("shortcut-name"),{readonly:!0,default:e}),CCInput(E("div").addClass("shortcut-definition filler"),{placeholder:"Definition",default:s,lists:[{name:"Tags",list:()=>stash.tags.names.all},{name:"Contributors",list:stash.contributors}],value:e=>{const s=e.match(t);return s?s[2]:""},replace:(e,s,a)=>e.replace(t,(t,i,n,l)=>("@"!==i&&"Contributors"===a&&"@"!==e.substring(l-1,l)?(i.length?i:"")+"@":i)+(~s.indexOf(" ")?'"'+s+'"':s)),enter:(e,t)=>{e.length&&(stash.page.load(toURLParams({search:e})),$(t.currentTarget).blur())}}),E("div").addClass("inline button").text("Test").on("click",e=>{const t=stash.search($(e.currentTarget).siblings(".shortcut-definition")[0].val()).length;stash.notify(`This query matches ${t} file${1==t?"":"s"}.`),e.preventDefault()})))(e,a[e])));let i=-1/0;e.find(".sp-admin-sc-save-button").on("click",t=>{if(Date.now()-i>1e4){const t=stash.blockInput(null,!1),s=stash.notify("Working...","working"),a={};e.find(".sp-admin-sc-list .row").each((e,t)=>a[$(t).children(".shortcut-name")[0].val()]=$(t).children(".shortcut-definition")[0].val()),stash.firebase.post("/shortcuts",a).then(()=>{i=Date.now(),stash.removeInputBlocker(t),stash.dismissNotification(s),stash.notify("Changes saved. Refresh the page in a minute to get the update on your end.")}).catch(e=>{stash.removeInputBlocker(t),stash.dismissNotification(s),stash.notify("Failed to save changes.",null,"error"),console.error(e)})}else stash.notify("Please wait a few seconds before saving again.",null,"error")}),s()}).fail(e=>a(e))}),review:()=>new Promise((t,s)=>{stash.firebase.db.collection("pending-submissions").where("type","==","file").orderBy("time").get().then(s=>{s.docs.forEach(t=>{const s=t.data(),a=s.data,i=E("div").addClass("img");stash.firebase.storage.ref(`/users/${s.user}/${"png"===a.type?a.hash:a.thumbnail}.png`).getDownloadURL().then(e=>{i.attr("data-src",e),stash.lazy.imageObserver.observe(i[0])});const n=E("div").addClass("sp-admin-review-file").append(E("div").addClass("sp-admin-review-file-preview "+a.type+("zip"===a.type?" tt":"")).append(i).attr("title","zip"===a.type?"Click to view thumbnail mcmeta":"").on("click",e=>{if("zip"===a.type){stash.page.modal().find(".content").css("width","800px").append(E("h2").text("Thumbnail MCMETA"),E("textarea").addClass("sp-submit-thumbnail-mcmeta-field").attr("spellcheck",!1).val(a.mcmeta?JSON.stringify(a.mcmeta,null,2):""))}}),E("div").addClass("sp-admin-review-file-info").append(E("div").addClass("row").append(E("h3").text(`${a.type.toUpperCase()} File`),E("div").addClass("filler"),E("div").addClass("inline button warning sp-admin-review-cancel-file-button").text("Toggle").on("click",()=>{n.toggleClass("sp-admin-review-denied")})),E("div").addClass("filler"),E("div").addClass("row").append(CCInput(E("div").addClass("sp-admin-review-file-parents"),{default:(a.parents||[]).join(","),placeholder:"No sources"}),"png"===a.type&&a.mcmeta?E("div").addClass("inline button sp-admin-review-mcmeta-button").text("View MCMETA").on("click",e=>{stash.page.modal().find(".content").css("width","800px").append(E("h2").text("Texture MCMETA"),E("textarea").addClass("sp-admin-review-mcmeta-field").attr("spellcheck",!1).val(JSON.stringify(a.mcmeta,null,2)))}):"","zip"===a.type?CCInput(E("div").addClass("inline sp-admin-review-package-type"),{default:stash.typeNames[a.packageType]}):"","zip"===a.type&&"model"==a.packageType?CCInput(E("div").addClass("inline filler"),{default:a.sketchfab,placeholder:"No Sketchfab ID"}):"",a.sketchfab?E("div").addClass("inline button").text("View").on("click",e=>stash.sketchfabPreview(a.sketchfab)):""),E("div").addClass("row").append(CCInput(E("div").addClass("sp-admin-review-file-contributor"),{default:a.contributor}),CCInput(E("div").addClass("sp-admin-review-file-tags filler"),{default:(a.tags||[]).join(" "),placeholder:"No tags"}))),E("div").addClass("sp-admin-review-file-meta row").append(E("span").addClass("filler").text(s.time.toDate().toString()),E("span").text("ID: "+t.id))).appendTo(e.find(".sp-admin-review-submissions"));n[0].submissionID=t.id,n[0].submissionData=s}),tippy(e.find(".sp-admin-review-submissions>.sp-admin-review-file").find(".tt").toArray()),e.find(".sp-admin-review-done-button").on("click",t=>{if(0==e.find(".sp-admin-review-file").length)return void stash.notify("No files to process.",null,"error");const s=stash.blockInput(null,!1),a=stash.notify("Processing reviewed files...","working"),i=[];e.find(".sp-admin-review-file").toArray().forEach(e=>{const t=e.submissionData;t.id=e.submissionID,t.accepted=!$(e).is(".sp-admin-review-denied"),t.data.contributor=$(e).find(".sp-admin-review-file-contributor input").val(),t.data.tags=$(e).find(".sp-admin-review-file-tags input").val().split(/\s+/).filter(e=>e.length);const s=$(e).find(".sp-admin-review-file-parents input").val();s&&s.length?t.data.parents=s.split(",").map(e=>e.trim()).filter(e=>e.length):t.data.hasOwnProperty("parents")&&delete t.data.parents,i.push(t)}),stash.firebase.post("/admin/review",i).then(()=>{e.find(".sp-admin-review-submissions").empty(),stash.removeInputBlocker(s),stash.dismissNotification(a),stash.notify("Reviewed files processed. Refresh the page in a minute to get the update on your end."),$("#admin-notification-count").text(""),$("#admin-panel-button").attr("title","<h4>Admin Control Panel</h4>")}).catch(e=>{stash.removeInputBlocker(s),stash.dismissNotification(a),console.error("Failed to process review!",e),stash.notify("Failed to process review!",null,"error")})}),t()})})};let a=!1;e.find(".sidebar-button").on("click",t=>{a||(t=>new Promise(s=>{a=!0,stash.workIndeterminate(),stash.page.closeModal(e.closest(".stash-page-wrapper").find(".modal")),e.find(".sp-admin-editor").empty().append(stash.loadingHint).load(`pages/admin/${t}.html`,s)}).then(()=>(s[t]?s[t]():Promise.resolve()).catch(e=>{stash.notify("Something that really shouldn't go wrong went wrong... Whoops.",null,"error"),console.error(e)})).then(()=>{stash.workComplete(),a=!1}))($(t.currentTarget).attr("data-tab"))})}).catch(e=>{stash.notify(e||"Access denied.",null,"error"),stash.page.load("root")});</script><img onload="stash.page.identifierLoaded(this);void(0);" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="/>