<link rel="stylesheet" href="/pages/css/admin.css"/><div class="sp-admin-wrapper"><div class="sidebar"><h2>Control Panel</h2><h3>Files</h3><div class="sidebar-button" data-tab="review">Review Submissions</div><h3>Features</h3><div class="sidebar-button" data-tab="status">Status Page Manager</div><div class="sidebar-button" data-tab="implicit-tags">Implicit Tags Editor</div><div class="sidebar-button" data-tab="shortcuts">Shortcut Editor</div><h3>Documentation</h3><div class="sidebar-button" data-tab="file-list-docs">Status Page File Lists</div></div><div class="sp-admin-editor filler"><div class="blank-page"><svg xmlns="http://www.w3.org/2000/svg" version="1.0" viewBox="0 0 512 512"><defs/><path d="M193.5 57.5c-12.3 3.3-22.8 8-33.8 15.2l-6.9 4.4.7 7.2c.7 7.1 2.9 19.5 3.6 20.1.2.2 4.5-.7 9.4-2 10.7-2.7 20.4-3 29.4-.8 37.7 9.4 59.8 52.8 52.6 103.3-1.7 12.2-7 33-8.8 34.8-1.8 1.8-22.6 7.1-34.8 8.8-43.8 6.2-83.2-9.6-98.3-39.5-6.9-13.5-8.2-26.9-4.2-42.5 1.3-5 2.2-9.2 2-9.4-.6-.7-13-2.9-20.1-3.6l-7.2-.7-4.4 6.9c-8.6 13.3-15.6 30.8-16 39.7l-.2 5 6.5 4.8c3.6 2.7 12.9 9.9 20.7 16.1l14.1 11.2-.6 5c-.9 6.4-.9 23.6 0 30l.6 5-14.1 11.2c-7.8 6.2-17.1 13.4-20.7 16.1l-6.5 4.8.2 5c.4 8.9 7.4 26.4 16 39.7l4.4 6.9 7.2-.7c7.1-.7 19.5-2.9 20.1-3.6.2-.2-.7-4.5-2-9.4-2.7-10.7-3-20.4-.8-29.4 9.4-37.7 52.8-59.8 103.3-52.6 12.2 1.7 33 7 34.8 8.8 1.8 1.8 7.1 22.6 8.8 34.8 6.2 43.8-9.6 83.2-39.5 98.3-13.5 6.9-26.9 8.2-42.5 4.2-4.9-1.3-9.2-2.2-9.4-2-.7.6-2.9 13-3.6 20.1l-.7 7.2 6.9 4.4c13.3 8.6 30.8 15.6 39.7 16l5 .2 4.8-6.5c2.7-3.6 9.9-12.9 16.1-20.7l11.2-14.1 5 .6c6.4.9 23.6.9 30 0l5-.6 11.2 14.1c6.2 7.8 13.4 17.1 16.1 20.7l4.8 6.5 5-.2c8.9-.4 26.4-7.4 39.7-16l6.9-4.4-.7-7.2c-.7-7.1-2.9-19.5-3.6-20.1-.2-.2-4.4.7-9.4 2-10.7 2.7-20.4 3-29.4.8-37.7-9.4-59.8-52.8-52.6-103.3 1.7-12.2 7-33 8.8-34.8 1.8-1.8 22.6-7.1 34.8-8.8 43.8-6.2 83.2 9.6 98.3 39.5 6.9 13.5 8.2 26.9 4.2 42.5-1.3 4.9-2.2 9.2-2 9.4.6.7 13 2.9 20.1 3.6l7.2.7 4.4-6.9c8.6-13.3 15.6-30.8 16-39.7l.2-5-6.5-4.8c-3.6-2.7-12.9-9.9-20.7-16.1l-14.1-11.2.6-5c.9-6.4.9-23.6 0-30l-.6-5 14.1-11.2c7.8-6.2 17.1-13.4 20.7-16.1l6.5-4.8-.2-5c-.4-8.9-7.4-26.4-16-39.7l-4.4-6.9-7.2.7c-7.1.7-19.5 2.9-20.1 3.6-.2.2.7 4.4 2 9.4 2.7 10.7 3 20.4.8 29.4-9.4 37.7-52.8 59.8-103.3 52.6-12.2-1.7-33-7-34.8-8.8-1.8-1.8-7.1-22.6-8.8-34.8-6.2-43.8 9.6-83.2 39.5-98.3 13.5-6.9 26.9-8.2 42.5-4.2 5 1.3 9.2 2.2 9.4 2 .7-.6 2.9-13 3.6-20.1l.7-7.2-6.9-4.4c-13.3-8.6-30.8-15.6-39.7-16l-5-.2-4.8 6.5c-2.7 3.6-9.9 12.9-16.1 20.7l-11.2 14.1-5-.6c-6.4-.9-23.6-.9-30 0l-5 .6-11.2-14.1c-6.2-7.8-13.4-17.1-16-20.7-5.4-7.3-7.1-7.9-15.8-5.5z"/><path d="M171.3 146.4c-10.4 3.4-18.5 10.6-23.2 20.5-2.2 4.8-2.6 6.9-2.6 15.1 0 10.2 1.7 15.4 7.1 21.1l2.5 2.6 4.4-2.3c9.6-4.8 25.6-5.5 38.3-1.6l5.9 1.9-1.9-5.9c-3.9-12.7-3.2-28.7 1.6-38.3l2.3-4.4-2.6-2.5c-5.1-4.8-10.9-7-19.5-7.3-5-.2-9.7.2-12.3 1.1zM321.1 146.1c-4 1.2-7.6 3.4-11.2 6.6l-2.6 2.4 2.3 4.4c4.8 9.6 5.5 25.6 1.6 38.3l-1.9 5.9 5.9-1.9c12.7-3.9 28.7-3.2 38.3 1.6l4.4 2.3 2.5-2.6c5.4-5.7 7.1-10.9 7.1-21.1 0-8.7-.3-10.1-3.2-16.1-6.3-12.8-17.6-20.1-31.8-20.6-4.4-.1-9.5.2-11.4.8zM152.6 309.9c-5.4 5.7-7.1 10.9-7.1 21.1 0 8.7.3 10.1 3.2 16.1 3.9 7.9 10.2 14 18.1 17.7 4.9 2.3 7 2.7 15.2 2.7 10.2 0 15.4-1.7 21.1-7.1l2.6-2.5-2.3-4.4c-4.8-9.6-5.5-25.6-1.6-38.3l1.9-5.9-5.9 1.9c-12.7 3.9-28.7 3.2-38.3-1.6l-4.4-2.3-2.5 2.6zM354.4 309.2c-8.4 5-26.4 5.9-39 2l-6.1-1.9 1.9 5.9c3.9 12.7 3.2 28.7-1.6 38.3l-2.3 4.4 2.6 2.5c5.7 5.4 10.9 7.1 21.1 7.1 8.2 0 10.3-.4 15.2-2.7 7.9-3.7 14.2-9.8 18.1-17.7 2.9-6 3.2-7.4 3.2-16.1 0-8.1-.4-10.2-2.4-14.2-1.3-2.6-3.6-5.8-5-7.1-2.6-2.4-2.6-2.4-5.7-.5z"/></svg></div></div></div><script>stash.page.identifier().then(stash.page.requireLogin(["admin","admin@stash"])).then(t=>{const e=/(^|[!@\(\) |])([A-z0-9_-]+|"[A-z0-9_ -]+"?)$/,a={status:()=>stash.api.get("/stash/status").then(async e=>{CCInput(t.find(".sp-admin-status-default-list"),{placeholder:"File list name",default:await stash.api.get("/prop?key=stash-default-status-list"),lists:[{name:"File Lists",list:()=>t.find(".sp-admin-status-file-lists .list-name").toArray().map(t=>t.val())}]});const a=(e="",a="")=>{t.find(".sp-admin-status-file-lists").append(E("div").addClass("row file-list").append(CCInput(E("div").addClass("list-name"),{placeholder:"Name",default:e}),CCInput(E("div").addClass("list-id filler"),{placeholder:"List ID",default:a}),E("div").addClass("inline button").text("View").on("click",t=>{window.open(`https://docs.google.com/spreadsheets/u/0/d/${$(t.currentTarget).siblings(".list-id")[0].val()}/view`),t.preventDefault()}),E("div").addClass("inline button warning").text("X").on("click",t=>$(t.currentTarget).parent().remove())))};Object.keys(e).forEach(t=>a(t,e[t])),t.find(".sp-admin-status-add-file-list-button").on("click",t=>a());let s=-1/0;t.find(".sp-admin-status-save-button").on("click",async e=>{if(Date.now()-s>1e4){const e=stash.blockInput(null,!1),a=stash.notify("Working...","working"),i={};t.find(".sp-admin-status-file-lists .file-list").each((t,e)=>i[$(e).children(".list-name")[0].val()]=$(e).children(".list-id")[0].val());try{await stash.api.post("/prop?key=stash-default-status-list",t.find(".sp-admin-status-default-list")[0].val(),"text/plain"),await stash.api.post("/stash/status",JSON.stringify(i)),s=Date.now(),stash.removeInputBlocker(e),stash.dismissNotification(a),stash.notify("Changes saved.")}catch(t){stash.removeInputBlocker(e),stash.dismissNotification(a),stash.notify("Failed to save changes.",null,"error"),console.error(t)}}else stash.notify("Please wait a few seconds before saving again.",null,"error")})}),"implicit-tags":()=>new Promise((a,s)=>{$.getJSON(stash.url.data+"implicit-tags.json").done(s=>{const i=(t="",a="")=>E("div").addClass("row").append(CCInput(E("div").addClass("tag-name"),{placeholder:"Name",default:t}),CCInput(E("div").addClass("tag-definition filler"),{placeholder:"Definition",default:a,lists:[{name:"Tags",list:()=>stash.tags.names.all},{name:"Contributors",list:stash.contributors}],value:t=>{const a=t.match(e);return a?a[2]:""},replace:(t,a,s)=>t.replace(e,(e,i,n,l)=>("@"!==i&&"Contributors"===s&&"@"!==t.substring(l-1,l)?(i.length?i:"")+"@":i)+(~a.indexOf(" ")?'"'+a+'"':a)),enter:(t,e)=>{t.length&&(stash.page.load(toURLParams({search:t})),$(e.currentTarget).blur())}}),E("div").addClass("inline button").text("Test").on("click",t=>{const e=stash.search($(t.currentTarget).siblings(".tag-definition")[0].val()).length;stash.notify(`This query matches ${e} file${1==e?"":"s"}.`),t.preventDefault()}),E("div").addClass("inline button warning").text("X").on("click",t=>$(t.currentTarget).parent().remove()));t.find(".sp-admin-it-list").append(Object.keys(s).map(t=>i(t,s[t]))),t.find(".sp-admin-it-add-tag-button").on("click",e=>t.find(".sp-admin-it-list").append(i()));let n=-1/0;t.find(".sp-admin-it-save-button").on("click",async e=>{if(Date.now()-n>1e4){const e=stash.blockInput(null,!1),a=stash.notify("Working...","working"),s={};t.find(".sp-admin-it-list .row").each((t,e)=>s[$(e).children(".tag-name")[0].val()]=$(e).children(".tag-definition")[0].val());try{await stash.api.post("/stash/implicit-tags",JSON.stringify(s)),n=Date.now(),stash.removeInputBlocker(e),stash.dismissNotification(a),stash.notify("Changes saved. Refresh the page in a minute to get the update on your end.")}catch(t){stash.removeInputBlocker(e),stash.dismissNotification(a),stash.notify("Failed to save changes.",null,"error"),console.error(t)}}else stash.notify("Please wait a few seconds before saving again.",null,"error")}),a()}).fail(t=>s(t))}),shortcuts:()=>new Promise((a,s)=>{$.getJSON(stash.url.data+"shortcuts.json").done(s=>{t.find(".sp-admin-sc-list").append(Object.keys(s).map(t=>((t="",a="")=>E("div").addClass("row").append(CCInput(E("div").addClass("shortcut-name"),{readonly:!0,default:t}),CCInput(E("div").addClass("shortcut-definition filler"),{placeholder:"Definition",default:a,lists:[{name:"Tags",list:()=>stash.tags.names.all},{name:"Contributors",list:stash.contributors}],value:t=>{const a=t.match(e);return a?a[2]:""},replace:(t,a,s)=>t.replace(e,(e,i,n,l)=>("@"!==i&&"Contributors"===s&&"@"!==t.substring(l-1,l)?(i.length?i:"")+"@":i)+(~a.indexOf(" ")?'"'+a+'"':a)),enter:(t,e)=>{t.length&&(stash.page.load(toURLParams({search:t})),$(e.currentTarget).blur())}}),E("div").addClass("inline button").text("Test").on("click",t=>{const e=stash.search($(t.currentTarget).siblings(".shortcut-definition")[0].val()).length;stash.notify(`This query matches ${e} file${1==e?"":"s"}.`),t.preventDefault()})))(t,s[t])));let i=-1/0;t.find(".sp-admin-sc-save-button").on("click",async e=>{if(Date.now()-i>1e4){const e=stash.blockInput(null,!1),a=stash.notify("Working...","working"),s={};t.find(".sp-admin-sc-list .row").each((t,e)=>s[$(e).children(".shortcut-name")[0].val()]=$(e).children(".shortcut-definition")[0].val());try{await stash.api.post("/stash/shortcuts",JSON.stringify(s)),i=Date.now(),stash.removeInputBlocker(e),stash.dismissNotification(a),stash.notify("Changes saved. Refresh the page in a minute to get the update on your end.")}catch(t){stash.removeInputBlocker(e),stash.dismissNotification(a),stash.notify("Failed to save changes.",null,"error"),console.error(t)}}else stash.notify("Please wait a few seconds before saving again.",null,"error")}),a()}).fail(t=>s(t))}),review:()=>new Promise(async(e,a)=>{try{const a=await stash.api.get("/stash/all-pending-submissions");for(const e of a){const a=e.data,s=E("div").addClass("img").attr("data-src",new URL(`/storage/${e.user}/${"png"===a.type?a.hash:a.thumbnail}.png`,stash.url.api));stash.lazy.imageObserver.observe(s[0]);const i=E("div").addClass("overlay"),n=E("div").addClass("sp-admin-review-file").append(E("div").addClass("sp-admin-review-file-preview "+a.type+("zip"===a.type?" tt":"")).append(s,i).attr("title","zip"===a.type?"Click to view thumbnail mcmeta":"").on("click",t=>{if("zip"===a.type){stash.page.modal().find(".content").css("width","800px").append(E("h2").text("Thumbnail MCMETA"),E("textarea").addClass("sp-submit-thumbnail-mcmeta-field").attr("spellcheck",!1).val(a.mcmeta?JSON.stringify(a.mcmeta,null,2):""))}}),E("div").addClass("sp-admin-review-file-info").append(E("div").addClass("row").append(E("h3").text(`${a.type.toUpperCase()} File`),E("div").addClass("filler"),E("div").addClass("inline button warning sp-admin-review-cancel-file-button").text("Toggle").on("click",()=>{n.toggleClass("sp-admin-review-denied")})),E("div").addClass("filler"),E("div").addClass("row").append(CCInput(E("div").addClass("sp-admin-review-file-parents"),{default:(a.parents||[]).join(","),placeholder:"No sources"}),"png"===a.type&&a.mcmeta?E("div").addClass("inline button sp-admin-review-mcmeta-button").text("View MCMETA").on("click",t=>{stash.page.modal().find(".content").css("width","800px").append(E("h2").text("Texture MCMETA"),E("textarea").addClass("sp-admin-review-mcmeta-field").attr("spellcheck",!1).val(JSON.stringify(a.mcmeta,null,2)))}):"","zip"===a.type?CCInput(E("div").addClass("inline sp-admin-review-package-type"),{default:stash.typeNames[a.packageType]}):"","zip"===a.type&&"model"==a.packageType?CCInput(E("div").addClass("inline filler"),{default:a.sketchfab,placeholder:"No Sketchfab ID"}):"",a.sketchfab?E("div").addClass("inline button").text("View").on("click",t=>stash.sketchfabPreview(a.sketchfab)):""),E("div").addClass("row").append(E("div").addClass("sp-admin-review-file-contributor"),E("div").addClass("sp-admin-review-file-tags filler"))),E("div").addClass("sp-admin-review-file-meta row").append(E("span").addClass("filler").text(new Date(e.date)),E("span").text("ID: "+e.id))).appendTo(t.find(".sp-admin-review-submissions"));i.append(E("a").addClass("action-button download-image-button").attr("title","Download").attr("href",new URL(`/storage/${e.user}/${a.hash}.${a.type}`,stash.url.api)).on("click",t=>{saveAs(new URL(`/storage/${e.user}/${a.hash}.${a.type}`,stash.url.api).toString(),`${a.hash}.${a.type}`),t.preventDefault(),t.stopPropagation()}).on("contextmenu",t=>{t.stopPropagation()})),"png"===a.type&&i.append(E("div").addClass("action-button fullscreen-button").attr("title","Fullscreen").on("click",t=>{stash.fullscreenImage(new URL(`/storage/${e.user}/${a.hash}.png`,stash.url.api)),t.stopPropagation(),t.preventDefault()})),tippy(i.find(".action-button").toArray(),{arrow:!0,animation:"perspective",performance:!0});const l=/^[-_0-9a-zÀ-ÿ ]+$/i;CCInput(n.find(".sp-admin-review-file-contributor"),{default:a.contributor,placeholder:"Contributor Name",lists:[{name:"Contributors",list:stash.contributors}],hint:()=>[E("p").append(E("sup").addClass("faded").text("Only autocompletes names of contributors that already have files in the stash; if the name is not in the list, just ignore it and enter the name manually."))]}),n.find(".sp-admin-review-file-contributor input").on("change",t=>{$(t.currentTarget).val().trim().match(l)?n.find(".sp-admin-review-file-contributor").removeClass("error"):n.find(".sp-admin-review-file-contributor").addClass("error")}).trigger("change");const r=/(^|\s)([a-z0-9-]+)$/;CCInput(n.find(".sp-admin-review-file-tags"),{default:(a.tags||[]).join(" "),placeholder:"No tags",lists:[{name:"Tags",list:stash.tags.names.explicit}],value:t=>{const e=t.match(r);return e?e[2]:""},replace:(t,e,a)=>t.replace(r,(t,a)=>a+e),hint:()=>[E("p").append(E("sup").addClass("faded").text("Tags may only contain lowercase letters, numbers and hyphens.")),E("p").append(E("sup").addClass("faded").text("Tags must not start or end with a hyphen and must contain at least one letter.")),E("p").append(E("sup").addClass("faded").text("Multiple tags should be separated by a space.")),E("p").append(E("sup").addClass("faded").text("Only autocompletes tags that are already used by files in the stash; if the tag is not in the list, just ignore it and enter the tag manually."))]}),n.find(".sp-admin-review-file-tags input").on("change",t=>{$(t.currentTarget).val().split(/\s+/g).filter(t=>t.length).find(t=>!stash.tags.isValid(t))?n.find(".sp-admin-review-file-tags").addClass("error"):n.find(".sp-admin-review-file-tags").removeClass("error")}).trigger("change"),n[0].submissionData=e}tippy(t.find(".sp-admin-review-submissions>.sp-admin-review-file").find(".tt").toArray()),t.find(".sp-admin-review-done-button").on("click",async e=>{if(0==t.find(".sp-admin-review-file").length)return void stash.notify("No files to process.",null,"error");const a=stash.blockInput(null,!1),s=stash.notify("Processing reviewed files...","working"),i=[];t.find(".sp-admin-review-file").toArray().forEach(t=>{const e=t.submissionData;e.accepted=!$(t).is(".sp-admin-review-denied"),e.data.contributor=$(t).find(".sp-admin-review-file-contributor input").val(),e.data.tags=$(t).find(".sp-admin-review-file-tags input").val().split(/\s+/).filter(t=>t.length);const a=$(t).find(".sp-admin-review-file-parents input").val();a&&a.length?e.data.parents=a.split(",").map(t=>t.trim()).filter(t=>t.length):e.data.hasOwnProperty("parents")&&delete e.data.parents,i.push(e)});try{await stash.api.post("/stash/review",JSON.stringify(i)),t.find(".sp-admin-review-submissions").empty(),stash.removeInputBlocker(a),stash.dismissNotification(s),stash.notify("Reviewed files processed. Refresh the page in a minute to get the update on your end."),$("#admin-notification-count").text(""),$("#admin-panel-button").attr("title","<h4>Admin Control Panel</h4>")}catch(t){stash.removeInputBlocker(a),stash.dismissNotification(s),console.error("Failed to process review!",t),stash.notify("Failed to process review!",null,"error")}}),e()}catch(t){stash.notify("Failed to load submissions!",null,"error")}})};let s=!1;t.find(".sidebar-button").on("click",e=>{s||(e=>new Promise(a=>{s=!0,stash.workIndeterminate(),stash.page.closeModal(t.closest(".stash-page-wrapper").find(".modal")),t.find(".sp-admin-editor").empty().append(stash.loadingHint).load(`pages/admin/${e}.html`,a)}).then(()=>(a[e]?a[e]():Promise.resolve()).catch(t=>{stash.notify("Something that really shouldn't go wrong went wrong... Whoops.",null,"error"),console.error(t)})).then(()=>{stash.workComplete(),s=!1}))($(e.currentTarget).attr("data-tab"))})}).catch(t=>{stash.notify(t||"Access denied.",null,"error"),stash.page.load("root")});</script><img onload="stash.page.identifierLoaded(this);void(0);" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="/>