<link rel="stylesheet" href="/stash/pages/css/addon-editor.css"/><div class="center"><div class="sp-addon-editor-wrapper"><h1>Addon Editor</h1><div class="sp-addon-editor-addon-title"></div><br/><div class="row"><div class="sp-addon-editor-addon-icon filler"></div><div class="sp-addon-editor-addon-support filler"></div></div><h3>Addon Description</h3><textarea class="sp-addon-editor-addon-desc"></textarea><div class="row"><h3 class="filler">Addon Script</h3><p class="sp-addon-editor-script-guide-button inline button">Addon Script Guide</p></div><textarea class="sp-addon-editor-addon-script" spellcheck="false"></textarea><p class="sp-addon-editor-script-error error"></p><hr/><div class="row"><div class="sp-addon-editor-delete-button warning inline button">Delete Addon</div><div class="filler"></div><div class="sp-addon-editor-save-button notable inline button">Save Addon</div></div></div></div><script>stash.page.identifier().then(stash.page.requireLogin(["contributor","admin"])).then(e=>{const t=getURLParams(e.attr("data-params"));CCInput(e.find(".sp-addon-editor-addon-title"),{placeholder:"Addon Title",hint:()=>[E("h3").text("Addon Title"),E("p").text("A short description of the addon.")]}),CCInput(e.find(".sp-addon-editor-addon-icon"),{placeholder:"Addon Icon",hint:()=>[E("h3").text("Addon Icon"),E("p").text("An icon can be made up of up to four files/thumbnails on the stash."),E("br"),E("p").append(E("sup").addClass("faded").append("Example: ",E("code").text("17590"))),E("p").append(E("sup").addClass("faded").append("Multiple File IDs are separated by a comma.")),E("p").append(E("sup").addClass("faded").append("Example: ",E("code").text("18726,17591,17590,17592")))]}),CCInput(e.find(".sp-addon-editor-addon-support"),{placeholder:"Addon Support Condition",hint:()=>[E("h3").text("Addon Support Condition"),E("p").html("A condition that must be met for the addon to show up. Can be set to <code>true</code> if it should always show, or <code>false</code> to hide it temporarily."),E("p").html("The variables available are <code>format</code> and <code>flavor</code>. See the addon script guide for more information."),E("br"),E("p").append(E("sup").addClass("faded").append("Example: ",E("code").text("flavor==Dark format>=4")))]}),e.find(".sp-addon-editor-addon-script").on("input",t=>{stash.parseAddonScript(e.find(".sp-addon-editor-addon-script").val(),(...t)=>{e.find(".sp-addon-editor-script-error").text(t.slice(1).join(" "))})&&e.find(".sp-addon-editor-script-error").text("")});let a=null;"string"==typeof t["addon-editor"]?stash.firebase.db.collection("addons").doc().get().then(t=>{if(!t.exists)return void stash.page.load("addon-editor");const d=t.data();a=d.user,e.find(".sp-addon-editor-addon-title")[0].val(d.title),e.find(".sp-addon-editor-addon-icon")[0].val(d.icon.join(",")),e.find(".sp-addon-editor-addon-support")[0].val(d.supports),e.find(".sp-addon-editor-addon-desc").val(d.desc),e.find(".sp-addon-editor-addon-script").val(d.script)}):e.find(".sp-addon-editor-delete-button").remove(),e.find(".sp-addon-editor-delete-button").on("click",e=>{const a=stash.page.modal();a.find(".content").css("width","800px").append(E("h2").text("Delete Addon"),E("p").text("Are you sure you want to delete this addon? Deleted addons cannot be recovered."),E("hr"),E("div").addClass("row").append(E("div").addClass("inline button warning").text("Yes, delete addon").on("click",e=>{stash.page.closeModal(a),stash.firebase.db.collection("addons").doc(t["addon-editor"]).delete().then(()=>{stash.notify("Addon deleted."),stash.page.load("pack-builder")}).catch(e=>{console.error("Failed to delete addon:",e),stash.notify("Failed to delete addon. Try again later.",null,"error")})}),E("div").addClass("inline button").text("No, cancel").on("click",e=>{stash.page.closeModal(a)})))}),e.find(".sp-addon-editor-save-button").on("click",d=>{if(0==e.find(".sp-addon-editor-addon-title")[0].val().length)return void stash.notify("The addon must have a title set.",null,"error");if(0==e.find(".sp-addon-editor-addon-icon")[0].val().length)return void stash.notify("The addon must have an icon set.",null,"error");if(!e.find(".sp-addon-editor-addon-icon")[0].val().match(/^(?:\d+,){0,3}\d+$/))return void stash.notify("Invalid icon format. Addon icons must be up to four stash file IDs, separated by commas.",null,"error");if(0==e.find(".sp-addon-editor-addon-support")[0].val().length)return void stash.notify("The addon must have a support condition set.",null,"error");stash.parseAddonScript(e.find(".sp-addon-editor-addon-script").val())?stash.firebase.getUser().then(d=>{d?new Promise((e,t)=>{a?e():stash.firebase.getUser().then(t=>{a=t.uid,e()})}).then(()=>("boolean"==typeof t["addon-editor"]?stash.firebase.db.collection("addons").doc():stash.firebase.db.collection("addons").doc(t["addon-editor"])).set({title:e.find(".sp-addon-editor-addon-title")[0].val(),icon:e.find(".sp-addon-editor-addon-icon")[0].val().split(",").map(e=>parseInt(e)),supports:e.find(".sp-addon-editor-addon-support")[0].val(),desc:e.find(".sp-addon-editor-addon-desc").val(),script:stash.addonScriptToString(stash.parseAddonScript(e.find(".sp-addon-editor-addon-script").val())),user:a})).then(()=>{stash.notify("Addon saved."),stash.page.load("pack-builder")}).catch(e=>{console.error("Failed to save addon:",e),stash.notify("Failed to save addon. Try again later.",null,"error")}):stash.notify("You must be logged in to save addons.",null,"error")}):stash.notify("Addon Script Error detected. You must fix any syntax errors in the addon script before saving.",null,"error")}),e.find(".sp-addon-editor-script-guide-button").on("click",e=>{stash.page.modal().find(".content").css("width","1200px").append(E("h2").text("Addon Script Guide"),E("p").text("Addon scripts uses a simple scripting language that consists of only command-lines and conditional branches."),E("h3").text("Command-lines"),E("p").text('The first word on a line is the command and any following words are arguments that changes what the command does. The command and each argument is separated by one or more spaces. Arguments that contain spaces must be enclosed in quotation marks ("). Below is a list of available commands, what arguments they take, and what they do.'),E("table").append(E("thead").append(E("tr").append(E("th").text("Command"),E("th").text("Arguments"),E("th").text("Description"))),E("tbody").append(E("tr").append(E("td").append(E("code").text("add")),E("td").append(E("div").addClass("row").text("1. Input File ID"),E("div").addClass("row").text("2. File Path")),E("td").append(E("p").text("Adds the input file to the pack with the specified file path and name. For files with a custom .mcmeta file, the .mcmeta file will also be added. If the input file doesn't have a custom .mcmeta file and it replaces a file in the pack that has its own .mcmeta file, the .mcmeta file of the file that is replaced will be removed."))),E("tr").append(E("td").append(E("code").text("extract")),E("td").append(E("div").addClass("row").text("1. Input ZIP File ID"),E("div").addClass("row").text("2. Output Directory"),E("div").addClass("row").text("3. File Regex Filter"),E("div").addClass("row").text("4. Regex Filter Flags")),E("td").append(E("p").append("Extracts the input ZIP file into the pack under an optional subdirectory. The subdirectory must either be blank (",E("code").text('""'),") or end with a ",E("code").text("/"),". The files that are added from the ZIP can be filtered by an optional regex pattern. The flags for the regex pattern are also optional. An in-depth explanation for the regex pattern and flags can be found ",E("a").attr("target","_blank").attr("href","https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp#Parameters").text("here"),". If a file's path matches the regex, it will be added, otherwise it will be ignored when extracting."))),E("tr").append(E("td").append(E("code").text("remove")),E("td").append(E("div").addClass("row").text("1. File Path")),E("td").append(E("p").text("Removes the specified file or directory from the pack."))),E("tr").append(E("td").append(E("code").text("write")),E("td").append(E("div").addClass("row").text("1. File Path"),E("div").addClass("row").text("2. Input Text")),E("td").append(E("p").append("Writes the input text to the specified file. If no input text is given, it will write a blank file. New lines can be written as ",E("code").text("\\n"),"."))))),E("h3").append(E("span").addClass("mono").text("if")," Statements"),E("p").append(E("code").text("if")," works like a special command. Instead of doing anything to the pack on its own, it makes any command-lines that come after it only execute if a condition is met. This is a conditional branch. The condition(s) should be given as arguments to the ",E("code").text("if")," statement as if it were a normal command."),E("p").append("To exit a branch, such that the following commands will be executed regardless of the condition from the previous ",E("code").text("if")," statement again, use the ",E("code").text("endif")," directive. This is also like a special command, though this one does not take any arguments."),E("p").append("Between ",E("code").text("if")," and ",E("code").text("endif"),", you may also use the ",E("code").text("else")," directive, which makes the command-lines after it only execute if the condition in the ",E("code").text("if")," statement is ",E("b").text("not")," true."),E("h3").text("Conditions"),E("p").append("There are two types of conditions: constant and variable. ",E("code").text("true")," and ",E("code").text("false")," are the only values for constant conditions and what they mean should be obvious. Variable conditions are made up of three parts: a variable name, an operator, and a value. Example: ",E("code").text("format==3")),E("p").append("There are currently two variables that can be used in conditions: ",E("code").text("format"),", which is the resource pack format, and ",E("code").text("flavor"),", which is the Dokucraft flavor. The resource pack format can be any format used in the game, for example 3 for 1.11 and 1.12, and 4 for 1.13, and so on. The flavor can be one of: ",E("code").text("Light"),E("code").text("Dark"),E("code").text("High"),E("code").text("Dwarven")),E("p").append("There are six different operators: ",E("code").text("=="),E("code").text("!="),E("code").text("<"),E("code").text(">"),E("code").text("<="),E("code").text(">=")),E("p").append("There must not be any spaces between the variable name, operator, or the value."),E("h3").text("Logical Operators"),E("p").append("Separating multiple conditions with spaces makes all of them required, like a logical AND operator."),E("p").append("Multiple conditions separated with pipes (",E("code").text("|"),") only require one of them to be true, like a logical OR operator."),E("p").append("The order of operations is groups > OR > AND. That means groups are evaluated first, then conditions separated by pipes, then ones separated by spaces."),E("p").append("Groups of conditions can be made by putting parentheses around them."),E("h3").text("Example Script"),E("p").append("Note that indentation makes the script easier to read, but is not required."),E("textarea").attr("spellcheck","false").prop("readonly",!0).val('add 1500 assets/minecraft/textrues/block/example_block.png\nwrite README.txt "Hello! This is an example addon."\nif format>=4\n  write assets/minecraft/1.13_and_up.txt "This file will only appear if the resource pack format is 4 or greater, meaning it will only show up in 1.13 and later versions of the game."\nelse\n  write assets/minecraft/1.12_and_down.txt "This file will only appear if the previous condition (format>=4) is _not_ met, meaning it will only show up in 1.12 and earlier versions."\nendif\nif flavor==Light|flavor==Dark\n  write only_light_and_dark.txt "This file shows up if the Dokucraft flavor is set to Light or Dark, but not if set to High or Dwarven."\nendif'))})});</script><img onload="stash.page.identifierLoaded(this);void(0);" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="/>