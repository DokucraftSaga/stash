<script>(()=>{let t=()=>{$("#content .selected").length>0?($("#selection-options").css("display","flex"),$("#link-to-selected").val("https://dokucraft.co.uk/stash/"+toSearchURLParams({id:$("#content .selected").toArray().map(t=>parseInt(getID($(t).attr("data-file")))).sort().reduce((t,e)=>{if(0==t.length)return t.push([e]),t;let s=t[t.length-1];return s[s.length-1]==e-1?(s.push(e),t[t.length-1]=s.filter((t,e)=>0==e||e==s.length-1)):t.push([e]),t},[]).reduce((t,e,s)=>{let l=s>0?",":"";return 1==e.length?t+=l+e[0]:t+=`${l}${e[0]}-${e[1]}`,t},"")}))):$("#selection-options").css("display","none")},e=e=>{$("#content .selected").removeClass("selected"),t()};$("#deselect-selected-button").on("click",e);let s=t=>{$("#download-selected-button").text("Working...").off("click",s);let e=new JSZip,l=$("#content .selected").toArray().map(t=>$(t).attr("data-file")),o=0;for(let t=0;t<l.length;t++){let n=new XMLHttpRequest;n.responseType="blob",n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE&&200==n.status){e.file(l[t]+".png",n.response,{createFolders:!0}),o++;let r=Math.floor(100*o/l.length);$("#download-selected-button").css("background-image",`linear-gradient(to right, #58f ${r}%, #202020 ${r}%)`),o==l.length&&e.generateAsync({type:"blob"}).then(t=>{saveAs(t,"dokustash.zip"),$("#download-selected-button").text("Download").on("click",s).css("background-image","")})}},n.open("GET",cors+stashURL+l[t]+".png",!0),n.send()}};$("#download-selected-button").on("click",s);pageCleanup=(()=>{$("#results-count").text("").attr("data-val",0),$("#sorting-options").addClass("hidden"),$("#selection-options").css("display","none"),$("#deselect-selected-button").off("click",e),$("#download-selected-button").off("click",s)});let l=decodeQuery();setSearchFormVals(l.category,l.contributor,l.id,l.size,l.color),l.id=stringToIDList(l.id),l.size=stringToSize(l.size);let o=stash.files.all;null!=l.category&&l.category.length>0&&(o=stash.files.category[l.category]),null!=l.contributor&&l.contributor.length>0&&(o=o.filter(contributorFilter(l.contributor))),null!=l.id&&l.id.length>0&&(o=o.filter(idFilter(l.id))),null!=l.size&&(o=o.filter(sizeFilter(l.size))),(e=>{if($("#content").empty(),0==e.length)return $("#content").append($("<div>",{class:"hint",text:"No results"})),void $("#results-count").text("").attr("data-val",0);if(e.length>2500)return $("#content").append($("<div>",{class:"hint",text:"Too many results (2500+), try narrowing your search"})),void $("#results-count").text("").attr("data-val",0);$("#results-count").text(`Results: ${e.length}`).attr("data-val",e.length);for(let s=0;s<e.length;s++){let l=e[s],o=createFilePreview(l,$("<div>",{class:"result"}));o.on("click",()=>{goToPage(toURLParams({details:getID(l)}))}),o.on("contextmenu",e=>{o.is(".selected")?o.removeClass("selected"):o.addClass("selected"),t(),e.preventDefault(),e.stopPropagation()});let n=getID(l),r=stash.data[l].S;o.attr("title",`<h3>${getContributor(l)} #${n}</h3><br>`+`Size: ${r[0]}x${r[1]}<br>`+`Date: ${formatDate(stash.data[l].T||getApproxTime(n))}<br><br>`+`<i>${getCategory(l)}</i>`),tippy(o[0],{placement:"right",arrow:!0,animation:"perspective",performance:!0}),$("#content").append(o)}$("#sorting-options").removeClass("hidden"),updateResultGroups(),$(".spinner-container").css("display","none").slice(0,10).css("display","flex")})(o.sort(naturalSorter)),l.color&&filterResultsByColor()})();</script>