<script>(()=>{let t=()=>{$("#content .selected").length>0?($("#selection-options").css("display","flex"),$("#link-to-selected").val("https://dokucraft.co.uk/stash/"+toSearchURLParams({id:$("#content .selected").toArray().map(t=>parseInt(getID($(t).attr("data-file")))).sort().reduce((t,e)=>{if(0==t.length)return t.push([e]),t;let s=t[t.length-1];return s[s.length-1]==e-1?(s.push(e),t[t.length-1]=s.filter((t,e)=>0==e||e==s.length-1)):t.push([e]),t},[]).reduce((t,e,s)=>{let o=s>0?",":"";return 1==e.length?t+=o+e[0]:t+=`${o}${e[0]}-${e[1]}`,t},"")}))):$("#selection-options").css("display","none")},e=e=>{$("#content .selected").removeClass("selected"),t()};$("#deselect-selected-button").on("click",e);let s=t=>{$("#download-selected-button").text("Working...").off("click",s);let e=new JSZip,o=$("#content .selected").toArray().map(t=>$(t).attr("data-file")),l=0;for(let t=0;t<o.length;t++){let n=new XMLHttpRequest;n.responseType="blob",n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE&&200==n.status){e.file(o[t]+".png",n.response,{createFolders:!0}),l++;let r=Math.floor(100*l/o.length);$("#download-selected-button").css("background-image",`linear-gradient(to right, #58f ${r}%, #202020 ${r}%)`),l==o.length&&e.generateAsync({type:"blob"}).then(t=>{saveAs(t,"dokustash.zip"),$("#download-selected-button").text("Download").on("click",s).css("background-image","")})}},n.open("GET",cors+stashURL+o[t]+".png",!0),n.send()}};$("#download-selected-button").on("click",s);pageCleanup=(()=>{$("#results-count").text("").attr("data-val",0),$("#sorting-options").addClass("hidden"),$("#selection-options").css("display","none"),$("#deselect-selected-button").off("click",e),$("#download-selected-button").off("click",s)});let o=decodeQuery();setSearchFormVals(o.category,o.contributor,o.id,o.size,o.color),o.id=stringToIDList(o.id),o.size=stringToSize(o.size);let l=stash.files.all;null!=o.category&&o.category.length>0&&(l=stash.files.category[o.category]),null!=o.contributor&&o.contributor.length>0&&(l=l.filter(contributorFilter(o.contributor))),null!=o.id&&o.id.length>0&&(l=l.filter(idFilter(o.id))),null!=o.size&&(l=l.filter(sizeFilter(o.size))),(e=>{if($("#content").empty(),0==e.length)return $("#content").append($("<div>",{class:"hint",text:"No results"})),void $("#results-count").text("").attr("data-val",0);if(e.length>2500)return $("#content").append($("<div>",{class:"hint",text:"Too many results (2500+), try narrowing your search"})),void $("#results-count").text("").attr("data-val",0);$("#results-count").text(`Results: ${e.length}`).attr("data-val",e.length);for(let s=0;s<e.length;s++){let o=e[s],l=createFilePreview(o,$("<div>",{class:"result"}));l.on("click",()=>{goToPage(toURLParams({details:getID(o)}))}),l.on("contextmenu",e=>{l.is(".selected")?l.removeClass("selected"):l.addClass("selected"),t(),e.preventDefault(),e.stopPropagation()});let n=getID(o),r=stash.data[o].S;l.attr("title",`<h3>${getContributor(o)} #${n}</h3><br>`+`Size: ${r[0]}x${r[1]}<br>`+`Date: ${formatDate(stash.data[o].T||getApproxTime(n))}<br><br>`+`<i>${getCategory(o)}</i>`),tippy(l[0],{position:"right",arrow:!0,animation:"perspective"}),$("#content").append(l)}$("#sorting-options").removeClass("hidden"),updateResultGroups(),$(".spinner-container").css("display","none").slice(0,10).css("display","flex")})(l.sort(naturalSorter)),o.color&&filterResultsByColor()})();</script>