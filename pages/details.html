<h2>File details</h2><div class="sp-details-file-info"><div class="row filler"><div class="sp-details-file-info-left-pane"></div><div class="sp-details-file-info-right-pane"></div></div></div><div class="sp-details-button-row row"></div><div class="sp-details-parents"></div><hr/><div class="sp-details-package-info"></div><link rel="stylesheet" href="/stash/pages/css/details.css"/><script>stash.page.hasWork=!0,stash.page.identifier().then(a=>{const t=getURLParams(a.attr("data-params")).details.split(":"),e=t[0],s=t[1],n=stash.nameOf(e);if(!n)return a.children(":not(script):not(link)").remove(),a.append(E("p").text("File not found.")),void stash.workComplete();const d=stash.data[n].contributor,p=(stash.query.contributor(d),a.find(".sp-details-file-info-left-pane")),i=a.find(".sp-details-file-info-right-pane"),o=formatDate(new Date(stash.data[n].timestamp-604800)),l=formatDate(new Date(stash.data[n].timestamp+604800)),r=Math.floor((stash.data[n].timestamp-opTime)/86400);if(s)i.append(E("div").addClass("row").append(E("span").append(E("span").text("#").addClass("faded"),stash.modalAnchor({details:e},a.closest(".stash-page-wrapper")).text(e).attr("title","Parent ZIP file"),E("span").addClass("faded").append(":",(s.match(/(.*\/)/)||[0,""])[1]),s.match(/([\w\.]+)\.\w+$/)[1],E("span").addClass("faded").text(s.match(/(\.\w+)$/)[1]))),E("div").addClass("row").append(E("span").append(E("span").text("By ").addClass("faded"),stash.modalAnchor({profile:d},a.closest(".stash-page-wrapper")).text(d))),E("div").addClass("row").append(E("span").append($("#calendar-icon").html(),stash.modalAnchor({search:`>{${o}} <{${l}}`},a.closest(".stash-page-wrapper")).attr("title","Find files from around the same time").text(formatDate(stash.data[n].timestamp))),E("span").append(formatNum(r),E("span").text(" days after the project started").addClass("faded")))),stash.getZIPContent(n).then(e=>{const n=e.filter(a=>s==(a.path.length>0?a.path+"/":"")+a.name);if(0==n.length)return stash.workError(),void stash.notify("Failed to find file: "+s,null,"error");const d=n[0],o=getExt(d.name),l=E("div").addClass("sp-details-file-preview no-action").addClass("file ext "+o).attr("data-filetype",o).appendTo(p),r=E("div").addClass("overlay").appendTo(l);"png"==o?(l.append(E("div").addClass("img b-lazy").attr("data-src","data:image/png;base64,"+d.content)),stash.getImage("data:image/png;base64,"+d.content).then(n=>{n.width<128&&n.height<128&&l.addClass("pixelated"),i.append(E("div").addClass("row").append(E("span").append($("#aspect-ratio-icon").html(),n.width,"x",n.height)));const d=s+".mcmeta";(e.find(a=>d==(a.path.length>0?a.path+"/":"")+a.name)||n.height/n.width>=6&&n.height%n.width==0)&&a.find(".sp-details-button-row").append(stash.anchor({"animation-editor":"id:"+t.join(":")}).addClass("inline button").text("Open in Animation Editor"))}),r.append(E("a").addClass("action-button download-image-button").attr("download",d.name).attr("title","Download").attr("href","data:image/png;base64,"+d.content).on("click",a=>{a.stopPropagation()})),r.append(E("div").addClass("action-button fullscreen-button").attr("title","Fullscreen").on("click",a=>{stash.fullscreenImage("data:image/png;base64,"+d.content),a.stopPropagation()}))):(a.find(".png-only,.zip-only").hide(),a.find(".sp-details-package-info").append(E("h2").text("File content"),E("textarea").prop("readonly",!0).val(d.content)),r.append(E("a").addClass("action-button download-image-button").attr("download",d.name).attr("title","Download").attr("href","data:text/plain;base64,"+btoa(d.content)).on("click",a=>{a.stopPropagation()}))),tippy(r.find(".action-button").toArray()),tippy(a.find(".sp-details-file-info [title]").toArray(),{placement:"right"}),stash.workComplete()}).catch(a=>{stash.workError(),stash.notify("Failed to load ZIP file: "+a,null,"error")});else{if(i.append(E("div").addClass("row").append(E("span").append(E("span").text("#").addClass("faded"),e),E("span").append(E("span").text("By ").addClass("faded"),stash.modalAnchor({profile:d},a.closest(".stash-page-wrapper")).text(d))),E("div").addClass("row").append(E("span").append($("#calendar-icon").html(),stash.modalAnchor({search:`>{${o}} <{${l}}`},a.closest(".stash-page-wrapper")).attr("title","Find files from around the same time").text(formatDate(stash.data[n].timestamp))),E("span").append(formatNum(r),E("span").text(" days after the project started").addClass("faded")))),a.find(".sp-details-file-info").append(E("div").addClass("sp-details-file-tags").append(stash.tags.element(n))),createFilePreview(n,E("div").addClass("sp-details-file-preview no-action").appendTo(p)),stash.data[n].parents&&a.find(".sp-details-parents").append(E("h3").text("Derived from:"),E("div").addClass("sp-details-files-container").append(stash.data[n].parents.sort((a,t)=>naturalSorter(t,a)).map(t=>{if("string"==typeof t)return E("div").addClass("sp-details-text-source").append(E("p").text(t));const e=stash.nameOf(t);if(null==e)return"";const s=createFilePreview(e,E("a").attr("href",toURLParams({details:t})));s.on("click",e=>{stash.page.modal(toURLParams({details:t}),a.closest(".stash-page-wrapper")),e.preventDefault()});const n=stash.data[e].size,d=E("div").append(E("h3").text(`${stash.data[e].contributor} #${stash.data[e].id}`));return stash.data[e].packageType?d.append(E("div").addClass("row").html($("#package-icon").html()+` ${stash.typeNames[stash.data[e].packageType]}`)):(d.append(E("div").addClass("row").html($("#aspect-ratio-icon").html()+` ${n[0]}x${n[1]}`)),stash.data[e].mcmeta&&d.append(E("div").addClass("row").html($("#code-icon").html()+" Custom MCMETA file"))),d.append(E("p").append(E("div").addClass("row").html($("#calendar-icon").html()+" "+formatDate(stash.data[e].timestamp))),stash.tags.element(e).addClass("compact").css("margin-top","12px")),s.attr("title",d[0].innerHTML),tippy(s[0],{placement:"right"}),s}))),"zip"==stash.data[n].ext){i.append(E("div").addClass("row").append(E("span").append($("#file-icon").html(),"ZIP file"),E("span").append($("#package-icon").html(),stash.typeNames[stash.data[n].packageType])));const t=()=>{stash.getZIPContent(n).then(t=>{a.find(".zip-content-display").remove();const s=E("div").addClass("zip-content-display tile-view");t.sort((a,t)=>naturalSorter((a.path.length>0?a.path+"/":"")+a.name,(t.path.length>0?t.path+"/":"")+t.name)).forEach(t=>{const n=getExt(t.name),d=E("div").addClass("file ext "+n).attr("data-filetype",n).attr("title",`<h3>${t.name}</h3><p>Size: ${formatBytes(t.size)}</p>${t.path.length>0?`<br><p><sub class="faded">${t.path}</sub></p>`:""}`).on("click",()=>{stash.page.modal(toURLParams({details:e+":"+(t.path.length>0?t.path+"/":"")+t.name}),a.closest(".stash-page-wrapper"))}),p=E("div").addClass("overlay").appendTo(d);tippy(d[0],{placement:"right"}),"png"==n?(d.append(E("div").addClass("img b-lazy").attr("data-src","data:image/png;base64,"+t.content)),p.append(E("a").addClass("action-button download-image-button").attr("download",t.name).attr("title","Download").attr("href","data:image/png;base64,"+t.content).on("click",a=>{a.stopPropagation()})),p.append(E("div").addClass("action-button fullscreen-button").attr("title","Fullscreen").on("click",a=>{stash.fullscreenImage("data:image/png;base64,"+t.content),a.stopPropagation()})),stash.getImage("data:image/png;base64,"+t.content).then(a=>{a.width<128&&a.height<128&&d.addClass("pixelated")})):p.append(E("a").addClass("action-button download-image-button").attr("download",t.name).attr("title","Download").attr("href",URL.createObjectURL(new Blob([t.content],{type:"text/plain"}))).on("click",a=>{a.stopPropagation()})),tippy(p.find(".action-button").toArray()),s.append(d)}),a.find(".sp-details-package-info").append(s),stash.workComplete()}).catch(a=>{console.error(a),stash.workError()})};a.find(".sp-details-package-info").append(E("div").addClass("row").append(E("h2").text("File content"),E("div").addClass("zip-content-display-type").css({width:"260px","margin-left":"12px"}).on("change",s=>{const d=a.find(".zip-content-display-type")[0].val();stash.workIndeterminate(),"tree"==d?stash.getZIPContent(n).then(t=>{a.find(".zip-content-display").remove();const s=E("div").addClass("zip-content-display info-dir no-name"),n={};t.sort((a,t)=>naturalSorter((a.path.length>0?a.path+"/":"")+a.name,(t.path.length>0?t.path+"/":"")+t.name)).forEach(a=>{let t=n;a.path.split("/").forEach(a=>{t[a]=t[a]||{},t=t[a]}),t[a.name]=a});const d=(t,s)=>{Object.keys(s).forEach(n=>{"number"==typeof s[n].size?t.append(E("div").addClass("info-file").text(s[n].name).append(E("span").addClass("info-filesize").text(formatBytes(s[n].size))).on("click",()=>{stash.page.modal(toURLParams({details:e+":"+(s[n].path.length>0?s[n].path+"/":"")+s[n].name}),a.closest(".stash-page-wrapper"))})):d(n.length?E("div").addClass("info-dir").text(n).appendTo(t):t,s[n])})};d(s,n),a.find(".sp-details-package-info").append(s),stash.workComplete()}):"list"==d?stash.getZIPContent(n).then(t=>{a.find(".zip-content-display").remove();const s=E("div").addClass("zip-content-display info-dir no-name");t.sort((a,t)=>naturalSorter((a.path.length>0?a.path+"/":"")+a.name,(t.path.length>0?t.path+"/":"")+t.name)).forEach(t=>{s.append(E("div").addClass("info-file").text((t.path.length>0?t.path+"/":"")+t.name).append(E("span").addClass("info-filesize").text(formatBytes(t.size))).on("click",()=>{stash.page.modal(toURLParams({details:e+":"+(t.path.length>0?t.path+"/":"")+t.name}),a.closest(".stash-page-wrapper"))}))}),a.find(".sp-details-package-info").append(s),stash.workComplete()}):"tile"==d&&t()}))),CCInput(a.find(".zip-content-display-type"),{type:"select",lists:[{name:"Display Options",list:[{name:"Tile view",value:"tile",selected:!0},{name:"Tree view",value:"tree"},{name:"List view",value:"list"}]}]}),t()}else i.append(E("div").addClass("row").append(E("span").append($("#file-icon").html(),"PNG file"),E("span").append($("#aspect-ratio-icon").html(),stash.data[n].size.join("x")))),stash.query.match("animated",n)&&a.find(".sp-details-button-row").append(stash.anchor({"animation-editor":"id:"+stash.data[n].id}).addClass("inline button").text("Open in Animation Editor")),stash.data[n].mcmeta?$.ajax(stash.url.files+n+".mcmeta").done(t=>{a.find(".sp-details-package-info").append(E("h2").text("MCMETA"),E("textarea").attr("spellcheck",!1).prop("readonly",!0).val(JSON.stringify(JSON.parse(t),null,2))),stash.workComplete()}).fail(a=>{stash.workError(),stash.notify(`Failed to load MCMETA. (${a.status} ${a.statusText})`,null,"error")}):stash.workComplete();const t=stash.search(stash.query.contributor(d)).sort(idSort),s=formatNum(t.indexOf(n)+1,!0,!0),h=formatNum(stash.files.indexOf(n)+1,!0,!0);i.append(E("div").addClass("row").append(E("span").append(E("span").attr("title",`This is the ${h[0]}${h[1]} file added to DokuStash`).append(h[0],E("span").append(h[1]," file").addClass("faded"))),E("span").append(E("span").attr("title",`This is the ${s[0]}${s[1]} file by ${d}`).append(s[0],E("span").append(s[1]," by ",d).addClass("faded"))))),tippy(a.find(".sp-details-file-info [title]").toArray(),{placement:"right"})}});</script><img onload="stash.page.identifierLoaded(this);void(0);" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="/>