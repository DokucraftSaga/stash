<link rel="stylesheet" href="/stash/pages/css/submit.css"/><div class="center"><div class="sp-submit-wrapper"><h1>Submit Files</h1><div class="sp-submit-files"></div><hr/><div class="sp-submit-drop-zone"></div><div class="sp-submit-default-data row"><div class="sp-submit-default-contributor-name-field"></div><div class="sp-submit-default-tags-field filler"></div></div><div class="row"><a class="sp-submit-pending-counter warning" data-count="0" href="?my-submissions"></a><div class="filler"></div><div class="sp-submit-submit-button button inline notable">Submit</div></div><h1>Tagging Tips</h1><h3>Flavor Tags</h3><p>Tag files with one of the flavor tags to indicate that it's made for a specific Dokucraft flavor:</p><p><ul><li><span class="tag">dokucraft-light</span></li><li><span class="tag">dokucraft-dark</span></li><li><span class="tag">dokucraft-high</span></li><li><span class="tag">dokucraft-dwarven</span></li></ul></p><p>Files that work with multiple flavors shouldn't have a flavor tag. Files should only have one flavor tag.</p><h3>Implicit Tags</h3><p> Many tags imply that other tags also apply to a file. For example, if a file has the <span class="tag">sword</span> tag, it must also be a <span class="tag">weapon</span>. These implied tags should <b>not</b> be set in the file's tag list, the stash does that automatically. Here are a few examples of common tags and the tags they imply:</p><p><table><thead><tr><th>Tag</th><th>Implied Tags</th></tr></thead><tbody><tr><td><span class="tag">creeper</span></td><td><span class="tag">monster</span><span class="tag">mob</span><span class="tag">entity</span></td></tr><tr><td><span class="tag">cow</span></td><td><span class="tag">animal</span><span class="tag">mob</span><span class="tag">entity</span></td></tr><tr><td><span class="tag">sword</span></td><td><span class="tag">melee-weapon</span><span class="tag">weapon</span><span class="tag">item</span></td></tr><tr><td><span class="tag">pickaxe</span></td><td><span class="tag">tool</span><span class="tag">item</span></td></tr><tr><td><span class="tag">spruce</span></td><td><span class="tag">wood</span></td></tr></tbody></table></p></div></div><script>stash.page.identifier().then(stash.page.requireLogin()).then(t=>{let e={},a={},s=!1;const i={"image/png":"png","application/zip":"zip","application/x-zip-compressed":"zip"},n=/^[-_0-9a-zÀ-ÿ ]+$/i,l=t=>new Promise((e,a)=>{const s=new FileReader;s.onload=(t=>e(CryptoJS.SHA256(t.target.result).toString(CryptoJS.enc.Hex))),s.onerror=(t=>a(t)),s.readAsBinaryString(t)}),r=t=>new Promise((e,a)=>{const s=new FileReader;s.onload=(t=>e(t.target.result)),s.onerror=(t=>a(t)),s.readAsDataURL(t)});CCInput(t.find(".sp-submit-default-contributor-name-field"),{placeholder:"Default Contributor Name <sup><i>(Optional)</i></sup>",lists:[{name:"Contributors",list:stash.contributors}],hint:()=>[E("h4").text("Default Contributor Name"),E("p").text("Enter a name here to automatically set the contributor name for files you add."),E("br"),E("p").append(E("sup").addClass("faded").text("Does not affect files that have already been added.")),E("p").append(E("sup").addClass("faded").text("Only autocompletes names of contributors that already have files in the stash; if the name is not in the list, just ignore it and enter the name manually."))]});const d=/(^|\s)([a-z0-9-]+)$/;CCInput(t.find(".sp-submit-default-tags-field"),{placeholder:"Default Tags <sup><i>(Optional)</i></sup>",lists:[{name:"Tags",list:stash.tags.names.explicit}],value:t=>{const e=t.match(d);return e?e[2]:""},replace:(t,e,a)=>t.replace(d,(t,a)=>a+e),hint:()=>[E("h4").text("Default Tags"),E("p").text("Enter tags here to automatically set the tags for files you add."),E("br"),E("p").append(E("sup").addClass("faded").text("Tags may only contain lowercase letters, numbers and hyphens.")),E("p").append(E("sup").addClass("faded").text("Tags must not start or end with a hyphen and must contain at least one letter.")),E("p").append(E("sup").addClass("faded").text("Multiple tags should be separated by a space.")),E("p").append(E("sup").addClass("faded").text("Does not affect files that have already been added.")),E("p").append(E("sup").addClass("faded").text("Only autocompletes tags that are already used by files in the stash; if the tag is not in the list, just ignore it and enter the tag manually."))]}),t.find(".sp-submit-submit-button").on("click",()=>{if(s)return;const i=Object.values(a);0!==i.length?i.find(t=>!t.contributor||!t.contributor.match(n))?stash.notify("All files must have a valid contributor name.",null,"error"):i.find(t=>"zip"==t.type&&!t.thumbnail)?stash.notify("All zip files must have a thumbnail image.",null,"error"):i.find(t=>"zip"==t.type&&!t.packageType)?stash.notify("All zip files must have a package type set.",null,"error"):new Promise((t,e)=>{if(i.find(t=>0==t.tags.length)){const a=stash.page.modal();a.find(".content").css("width","800px").append(E("h2").text("Files without tags"),E("p").text("One or more of the files have no tags set. Are you sure you want to submit files without tags?"),E("hr"),E("div").addClass("row").append(E("div").addClass("inline button notable").text("Yes, submit").on("click",e=>{stash.page.closeModal(a),t()}),E("div").addClass("inline button").text("No, cancel").on("click",t=>{stash.page.closeModal(a),e()})))}else t()}).then(()=>{s=!0;const n=stash.blockInput(null,!1),l=stash.notify("Submitting files...","working");let d=new Set;Object.values(a).forEach(t=>{d.add(t.hash),t.thumbnail&&d.add(t.thumbnail)}),stash.firebase.getUser().then(t=>Promise.all([...d].map(s=>a.hasOwnProperty(s)?stash.firebase.storage.ref(`/users/${t.uid}/${s}.${a[s].type}`).put(e[s]):stash.firebase.storage.ref(`/users/${t.uid}/${s}.png`).put(e[s])))).then(()=>Promise.all(i.map(t=>r(e[t.thumbnail||t.hash]).then(e=>new Promise((a,s)=>{const i=new Image;i.onload=(e=>{t.width=i.width,t.height=i.height,t.animation=t.mcmeta&&t.mcmeta.animation||t.height/t.width>=6&&t.height%t.width==0,a()}),i.src=e}))))).then(()=>stash.firebase.post("/files/submit",i)).then(r=>{stash.notify(`File${i.length>1?"s":""} submitted. ${i.length>1?"They":"It"} will be reviewed before being added to the stash.`,[{text:"View submissions",func:()=>stash.page.load("?my-submissions")}]),t.find(".sp-submit-file").remove();const d=parseInt(t.find(".sp-submit-pending-counter").attr("data-count"));t.find(".sp-submit-pending-counter").attr("data-count",d+i.length),e={},a={},stash.removeInputBlocker(n),stash.dismissNotification(l),s=!1}).catch(t=>{"string"==typeof t?stash.notify("Failed to submit files: "+t,null,"error"):t.responseJSON?stash.notify(`Failed to submit files: ${t.responseJSON.message}`,null,"error"):stash.notify(`Failed to submit files: ${t.status} ${t.statusText}`,null,"error"),console.error("Failed to submit files",t),stash.removeInputBlocker(n),stash.dismissNotification(l),s=!1})}):stash.notify("No files to submit.",null,"error")}),stash.firebase.getUser().then(e=>{stash.firebase.db.collection("pending-submissions").where("user","==",e.uid).where("type","==","file").get().then(e=>{t.find(".sp-submit-pending-counter").attr("data-count",e.docs.length)})}),t.find(".sp-submit-pending-counter").on("click",t=>{stash.page.load("my-submissions"),t.preventDefault()}),CCInput(t.find(".sp-submit-drop-zone"),{type:"file",hint:"Drag and drop or click here to add files.",fileHandler:s=>l(s).then(d=>{if(a.hasOwnProperty(d))return void stash.notify("This file has already been added:\n"+s.name,null,"error");if(s.size>52428800)return void stash.notify(`File too big: ${s.name}\nFiles must be smaller than 50 MB.`,null,"error");const o=i[s.type];if(!o)return void stash.notify(`Invalid file type: ${s.name}\nOnly PNG and ZIP files are allowed.`,null,"error");e[d]=s,a[d]={type:o,hash:d};const p="png"===o?E("div").addClass("img"):"";"png"===o&&r(s).then(t=>{p.attr("data-src",t),stash.lazy.imageObserver.observe(p[0])});const h=E("div").addClass("sp-submit-file").appendTo(t.find(".sp-submit-files")).attr("data-file-hash",d).append(E("div").addClass("sp-submit-file-preview "+o+("zip"===o?" tt":"")).append(p).attr("title","zip"===o?"Click to edit thumbnail":""),E("div").addClass("sp-submit-file-info").append(E("div").addClass("row").append(E("h3").text(s.name).addClass("sp-submit-file-name"),E("div").addClass("filler"),E("div").addClass("inline button warning sp-submit-remove-file-button").text("Remove").on("click",()=>{delete a[h.attr("data-file-hash")],h.remove()})),E("div").addClass("filler"),E("div").addClass("row").append(E("div").addClass("sp-submit-file-parents"),"png"===o?E("div").addClass("inline button sp-submit-mcmeta-button").text("Edit MCMETA"):"","zip"===o?E("div").addClass("inline select sp-submit-package-type").attr("data-required",!0).on("change",t=>{const e=t.currentTarget.val();a[h.attr("data-file-hash")].packageType=e,"model"==e?h.addClass("sp-submit-model-file"):(delete a[h.attr("data-file-hash")].sketchfab,h.find(".sp-submit-sketchfab-link input").val(""),h.removeClass("sp-submit-model-file"))}):"","zip"===o?E("div").addClass("sp-submit-sketchfab-link filler"):""),E("div").addClass("row").append(E("div").addClass("sp-submit-file-contributor"),E("div").addClass("sp-submit-file-tags filler"))));if("zip"===o){CCInput(h.find(".sp-submit-package-type"),{placeholder:"Package type",type:"select",lists:[{name:"Package Types",list:[{name:"Model",value:"model"},{name:"Texture Set",value:"set"},{name:"CTM",value:"ctm"},{name:"CIT",value:"cit"}]}]}),CCInput(h.find(".sp-submit-sketchfab-link"),{placeholder:"Sketchfab Link <sup><i>(Optional)</i></sup>",hint:()=>[E("h4").text("Sketchfab Link"),E("p").text("The link to or ID of a Sketchfab preview of the model."),E("br"),E("p").append(E("sup").addClass("faded").append("Short skfb.ly links are not valid."))]}),h.find(".sp-submit-sketchfab-link input").on("change",t=>{const e=$(t.currentTarget).val();if(0==e.trim().length)return h.find(".sp-submit-sketchfab-link").removeClass("error"),void delete a[h.attr("data-file-hash")].sketchfab;const s=e.match(/([0-9a-f]+)$/);s&&s[1]&&32==s[1].length?(h.find(".sp-submit-sketchfab-link").removeClass("error"),a[h.attr("data-file-hash")].sketchfab=s[1]):h.find(".sp-submit-sketchfab-link").addClass("error")});const t=h.find(".sp-submit-file-preview");t.on("click",()=>{const s=stash.page.modal(),i=a[h.attr("data-file-hash")];let n=i.thumbnail,d=n?e[n]:null,o="";s.find(".content").css("width","800px").append(E("h2").text("Package Thumbnail Image"),E("div").addClass("row").append(CCInput(E("div").addClass("filler"),{type:"file",hint:"Drag and drop or click here to add a thumbnail image.",fileHandler:t=>l(t).then(e=>{t.size>52428800?stash.notify(`File too big: ${t.name}\nFiles must be smaller than 50 MB.`,null,"error"):r(t).then(a=>{n=e,d=t,o=a;const i=E("div").addClass("img").attr("data-src",o)[0];stash.lazy.imageObserver.observe(i),s.find(".sp-submit-thumbnail-file-preview").empty().append(i)})}),accept:["image/png"]})),E("div").addClass("sp-submit-thumbnail-file-preview"),E("h4").text("Thumbnail MCMETA"),E("p").text("For animated thumbnails, enter the MCMETA content below."),E("textarea").addClass("sp-submit-thumbnail-mcmeta-field").attr("spellcheck",!1).on("input",t=>{const e=s.find(".sp-submit-thumbnail-mcmeta-field").val();if(e&&0!=e.length)try{JSON.parse(e),s.find(".sp-submit-thumbnail-mcmeta-error").text("")}catch(t){s.find(".sp-submit-thumbnail-mcmeta-error").text(t.toString())}else s.find(".sp-submit-thumbnail-mcmeta-error").text("")}),E("p").addClass("sp-submit-thumbnail-mcmeta-error error"),E("hr"),E("div").addClass("sp-submit-thumnbail-done-button button inline").text("Done").on("click",i=>{if(n&&0!==n.length){const i=s.find(".sp-submit-thumbnail-mcmeta-field").val();if("string"==typeof i&&i.length>0)try{JSON.parse(i)}catch(t){return void stash.notify("Invalid MCMETA",null,"error")}t.children(".img").remove();const l=E("div").addClass("img").attr("data-src",o)[0];stash.lazy.imageObserver.observe(l),t.append(l),a[h.attr("data-file-hash")].thumbnail=n,e[n]=d,"string"==typeof i&&i.length>0?a[h.attr("data-file-hash")].mcmeta=JSON.parse(i):delete a[h.attr("data-file-hash")].mcmeta,stash.page.closeModal(s)}else t.children(".img").remove(),delete a[h.attr("data-file-hash")].thumbnail,stash.page.closeModal(s)})),d&&r(d).then(t=>{o=t;const e=E("div").addClass("img").attr("data-src",o)[0];stash.lazy.imageObserver.observe(e),s.find(".sp-submit-thumbnail-file-preview").empty().append(e)}),s.find(".sp-submit-thumbnail-mcmeta-field").val(i.mcmeta?JSON.stringify(i.mcmeta,null,2):"")})}"png"===o&&h.find(".sp-submit-mcmeta-button").on("click",()=>{const t=stash.page.modal();t.find(".content").css("width","800px").append(E("h2").text("Texture MCMETA"),E("p").text("For animated textures, enter the MCMETA content below."),E("textarea").addClass("sp-submit-mcmeta-field").attr("spellcheck",!1).on("input",e=>{const a=t.find(".sp-submit-mcmeta-field").val();if(a&&0!=a.length)try{JSON.parse(a),t.find(".sp-submit-mcmeta-error").text("")}catch(e){t.find(".sp-submit-mcmeta-error").text(e.toString())}else t.find(".sp-submit-mcmeta-error").text("")}),E("p").addClass("sp-submit-mcmeta-error error"),E("hr"),E("div").addClass("sp-submit-mcmeta-done-button button inline").text("Done").on("click",e=>{const s=t.find(".sp-submit-mcmeta-field").val();if("string"==typeof s&&s.length>0){try{JSON.parse(s)}catch(t){return void stash.notify("Invalid MCMETA",null,"error")}a[h.attr("data-file-hash")].mcmeta=JSON.parse(s)}else delete a[h.attr("data-file-hash")].mcmeta;stash.page.closeModal(t)}));const e=a[h.attr("data-file-hash")];t.find(".sp-submit-mcmeta-field").val(e.mcmeta?JSON.stringify(e.mcmeta,null,2):"")}),CCInput(h.find(".sp-submit-file-parents"),{placeholder:"Sources <sup><i>(Optional)</i></sup>",hint:()=>[E("h4").text("Sources"),E("p").text("List of IDs of files on the stash or names of things that this file is based on. Leave blank for original files."),E("br"),E("p").append(E("sup").addClass("faded").append("Separate multiple sources with commas.")),E("p").append(E("sup").addClass("faded").append("Example: ",E("code").text("8230,20990,Dokucraft Light,18820")))]}),h.find(".sp-submit-file-parents input").on("change",t=>{const e=$(t.currentTarget).val();a[h.attr("data-file-hash")].parents=e.split(",").map(t=>t.trim()).filter(t=>t.length).map(t=>t.match(/^\d+$/)?parseInt(t):t)}),CCInput(h.find(".sp-submit-file-contributor"),{placeholder:"Contributor Name",lists:[{name:"Contributors",list:stash.contributors}],hint:()=>[E("p").append(E("sup").addClass("faded").text("Only autocompletes names of contributors that already have files in the stash; if the name is not in the list, just ignore it and enter the name manually."))]}),h.find(".sp-submit-file-contributor input").on("change",t=>{const e=$(t.currentTarget).val().trim();e.match(n)?(h.find(".sp-submit-file-contributor").removeClass("error"),a[h.attr("data-file-hash")].contributor=e):h.find(".sp-submit-file-contributor").addClass("error")}).val(t.find(".sp-submit-default-contributor-name-field input").val()).trigger("change");const u=/(^|\s)([a-z0-9-]+)$/;CCInput(h.find(".sp-submit-file-tags"),{placeholder:"Tags",lists:[{name:"Tags",list:stash.tags.names.explicit}],value:t=>{const e=t.match(u);return e?e[2]:""},replace:(t,e,a)=>t.replace(u,(t,a)=>a+e),hint:()=>[E("p").append(E("sup").addClass("faded").text("Tags may only contain lowercase letters, numbers and hyphens.")),E("p").append(E("sup").addClass("faded").text("Tags must not start or end with a hyphen and must contain at least one letter.")),E("p").append(E("sup").addClass("faded").text("Multiple tags should be separated by a space.")),E("p").append(E("sup").addClass("faded").text("Only autocompletes tags that are already used by files in the stash; if the tag is not in the list, just ignore it and enter the tag manually."))]}),h.find(".sp-submit-file-tags input").on("change",t=>{const e=$(t.currentTarget).val().split(/\s+/g).filter(t=>t.length);e.find(t=>!stash.tags.isValid(t))?h.find(".sp-submit-file-tags").addClass("error"):(h.find(".sp-submit-file-tags").removeClass("error"),a[h.attr("data-file-hash")].tags=e)}).val(t.find(".sp-submit-default-tags-field input").val()).trigger("change"),tippy(h.find(".tt").toArray())}),multiple:!0,accept:["image/png","application/zip","application/x-zip-compressed"]})}).catch(()=>{stash.notify("You need to be logged in to submit files to the stash.",null,"error"),stash.page.load("root")});</script><img onload="stash.page.identifierLoaded(this);void(0);" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="/>