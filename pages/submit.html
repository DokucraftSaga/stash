<div class="fill full-height" id="submit-page"><h2>Submit Files</h2><a id="login-status">Logging in...</a><p class="short">From here you can submit files to the stash. The files will be reviewed manually before being added and will not show up in the stash before they are approved.</p><br/><h2>Add and sort files</h2><p class="short">To add files, first upload them to a file hosting service. Then get a link to the file you want to add, put it in the field below and click 'Add'.</p><p><i>Need somewhere to host your files? <a href='https://imgur.com/'>Imgur</a> can be used for images. For other files, <a href='https://drive.google.com/'>Google Drive</a> and <a href='https://www.dropbox.com'>Dropbox</a> will work if the files are not private.</i></p><div class="row"><div class="text-input tt" title="&lt;h3&gt;URL&lt;/h3&gt;&lt;i&gt;Supported URLs:&lt;ul&gt;&lt;li&gt;Direct link&lt;/li&gt;&lt;li&gt;Shareable link from Google Drive or Dropbox&lt;/li&gt;&lt;li&gt;Imgur album or image link&lt;/li&gt;&lt;/ul&gt;&lt;br&gt;Only PNG and ZIP files are supported&lt;/i&gt;"><input id="file-url-input" type="text" spellcheck="false" placeholder="URL"/><span></span></div><div class="button inline" id="add-file-button">Add</div></div><br/><br/><p class="short">To sort files into categories, select one or more files by clicking on them, then choose a category to sort them into and click 'Sort selected'. If you make a mistake you can sort a file again after putting it back into the unsorted list by clicking it again.</p><br/><div class="text-input tt" title="&lt;h3&gt;Category name&lt;/h3&gt;&lt;br&gt;&lt;i&gt;Must match name exactly&lt;/i&gt;"><input id="sorter-category-input" type="text" spellcheck="false" placeholder="Category"/><span></span></div><div class="button inline tt" id="select-category-button" title="Select category from list">...</div><div class="button inline when-any-selected disabled" id="sort-selected-button">Sort selected</div><div class="button inline" id="select-all-unsorted-button">Select all</div><div class="button inline when-any-selected disabled" id="deselect-all-unsorted-button">Deselect all</div><div class="button inline when-any-selected disabled" id="remove-selected-button">Remove selected</div><br/><h3>Unsorted files</h3><div id="unsorted-files"></div><div class="content" id="sorted-files"></div><h2>Submit for approval</h2><p class="short">Before you submit the files, you need to enter the name of the contributor who made them below. The files will be renamed to follow the format <code>&lt;Contributor Name&gt;_&lt;ID&gt;.png</code> before being added to the stash and this is where the name is used.</p><br/><div class="text-input tt" title="&lt;h3&gt;Contributor name&lt;/h3&gt;&lt;br&gt;&lt;i&gt;Only autocompletes names of contributors that already have textures in the stash; if your name is not in the list, just ignore it and type in the name manually.&lt;/i&gt;"><input id="sorter-name-input" type="text" spellcheck="false" placeholder="Name"/><span></span></div><div class="button inline disabled" id="submit-button">Submit</div></div><script>(()=>{let e=null,t=[],a=!1,n=/(?:\/|www.)imgur\.com\/([0-9A-Za-z]+)/,o=/(?:\/|www.)imgur\.com\/a\/([0-9A-Za-z]+)/,i=/drive\.google\.com\/file\/d\/([0-9A-Za-z]+)/,l=/drive\.google\.com\/open\?id=([0-9A-Za-z]+)/,s="https://drive.google.com/uc?export=download&id=",r=/www\.dropbox\.com\/s\//,d=e=>e.match(/imgur\.com\//),c=e=>e.match(n)?"https://i.imgur.com/"+n.exec(e)[1]+".png":e.match(l)?s+l.exec(e)[1]:e.match(i)?s+i.exec(e)[1]:e.match(r)?e.replace(r,"dl.dropboxusercontent.com/s/"):e,p=(e,t,a)=>{stash.workIndeterminate();let n=new XMLHttpRequest;n.addEventListener("progress",e=>{e.lengthComputable?stash.setWorkProgress(Math.floor(100*e.loaded/e.total)):stash.workIndeterminate()}),n.addEventListener("error",e=>{a.error("Unable to verify file."),stash.workError(a.reset)}),n.addEventListener("abort",e=>{a.error("Process aborted."),stash.workError(a.reset)}),n.addEventListener("load",e=>{let o=n.getResponseHeader("content-type");~t.indexOf(o)?(stash.workComplete(),a.verified(o)):(a.error("File type not recognized."),stash.workError(a.reset))}),n.open("HEAD",(d(e)?"":cors)+e,!0),n.send()},u=()=>{0==$("#unsorted-files .selected").length?$("#content .when-any-selected").addClass("disabled"):$("#content .when-any-selected").removeClass("disabled")},m=(e,a)=>{t.push({type:a,url:e});let n=$("<div>",{class:"local file"}).attr("title",`<h3>${a.toUpperCase()} File</h3><i>${e.replace(/^(.{64}).+/,"$1&hellip;")}</i>`).attr("data-file-index",t.length-1),o=e=>{if(n.is(".sorted")){let e=n.parent();return n.removeClass("sorted").detach().appendTo($("#unsorted-files")),0==e.find(".local.file").length&&e.remove(),void $("#submit-button").addClass("disabled")}n.is(".selected")?n.removeClass("selected"):n.addClass("selected"),u()};n.on("click",o),n.on("contextmenu",e=>{o(),e.preventDefault()});let i=$("<div>",{class:"overlay"}).appendTo(n),l=null;tippy(n[0],{arrow:!0,animation:"perspective",placement:"right",onShow(){const e=$(this.querySelector(".tippy-content"));null===l&&(l=e[0].innerHTML),e.empty().append(l),n.is("#unsorted-files .file,.zip.no-thumbnail,.zip:not(.tagged)")&&(e.append("<br><br>"),n.is("#unsorted-files .file")&&(console.log(n),e.append($("<p>",{class:"error",text:"All files must be sorted into categories."}))),n.is(".zip.no-thumbnail")&&e.append($("<p>",{class:"error",text:"ZIP files must have a thumbnail image."})),n.is(".zip:not(.tagged)")&&e.append($("<p>",{class:"error",text:"ZIP files must be tagged appropriately."})))}});if("png"==a){n.addClass("png").append($("<div>",{class:"img b-lazy"}).attr("data-src",e).append($("<div>",{class:"spinner-container"}).append($("<div>",{class:"spinner"})))),i.append($("<div>",{class:"action-button fullscreen-button",title:"Fullscreen"}).on("click",t=>{$("#fullscreen-cover").removeClass("hidden"),$("#fullscreen-cover .img").removeClass("b-loaded b-error").attr("style","").attr("data-src",e).append($("<div>",{class:"spinner-container"}).append($("<div>",{class:"spinner"}))),t.stopPropagation()}));let t=new Image;t.onload=(()=>{t.width<128&&t.height<128&&n.addClass("pixelated")}),t.src=(d(e)?"":cors)+e}else"zip"==a&&(n.addClass("zip no-thumbnail"),i.append($("<div>",{class:"action-button add-thumbnail-button",title:"Add thumbnail"}).on("click",e=>{$("#submit-page").hide(),removeAllTooltips();let a=e=>{let i=o.find("#tn-url-input").val();i&&0!=i.length?($("#done-button").text("Working...").off("click",a),i=c(i),p(i,["image/png"],{error:e=>{$("#done-button").text("Done").on("click",a),stash.notify(e,null,"error")},verified:()=>{n.children(".img").remove(),n.removeClass("no-thumbnail").append($("<div>",{class:"img b-lazy"}).attr("data-src",i).append($("<div>",{class:"spinner-container"}).append($("<div>",{class:"spinner"})))),t[n.attr("data-file-index")].thumbnail=i;let e=new Image;e.onload=(()=>{e.width<128&&e.height<128?n.addClass("pixelated"):n.removeClass("pixelated")}),e.src=(d(i)?"":cors)+i,o.remove(),$("#submit-page").show()}})):(n.addClass("no-thumbnail").children(".img").remove(),delete t[n.attr("data-file-index")].thumbnail,o.remove(),$("#submit-page").show())},o=$("<div>",{class:"fill"}).append($("<h2>").text("Add thumbnail to file")).append($("<p>").text("Paste or type in the URL of a thumbnail image below.")).append($("<div>",{class:"text-input"}).append($("<input>",{id:"tn-url-input",type:"text",spellcheck:!1,placeholder:"URL"})).append($("<span>"))).append($("<div>",{id:"done-button",class:"button inline",text:"Done"}).on("click",a)).append($("<div>",{class:"button inline",text:"Cancel"}).on("click",e=>{o.remove(),$("#submit-page").show()})).appendTo($("#content")),i=t[n.attr("data-file-index")].thumbnail;o.find("#tn-url-input").val(i||"").focus(),i&&o.find("#done-button").removeClass("disabled"),window.scrollTo(0,0),e.stopPropagation()})));i.append($("<div>",{class:"action-button mcmeta-button",title:"zip"==a?"Edit thumbnail mcmeta":"Edit mcmeta"}).on("click",e=>{$("#submit-page").hide(),removeAllTooltips();let a=$("<div>",{class:"fill"}).append($("<h2>").text("Add mcmeta file")).append($("<p>").text("Paste or type in the content of this texture's mcmeta file below.")).append($("<textarea>",{id:"mcmeta-input",spellcheck:!1}).on("input",e=>{let t=a.find("#mcmeta-input").val();if(t&&0!=t.length)try{JSON.parse(t),a.find("#done-button").removeClass("disabled").attr("title","Set the mcmeta of the texture to the above text")}catch(e){a.find("#done-button").addClass("disabled").attr("title",e.toString())}else a.find("#done-button").removeClass("disabled").attr("title","Remove mcmeta from texture")})).append($("<div>",{id:"done-button",class:"button disabled inline",text:"Done",title:"Enter mcmeta content above"}).on("click",e=>{if($(e.currentTarget).is(".disabled"))return;let o=a.find("#mcmeta-input").val();o&&0!=o.length?(t[n.attr("data-file-index")].mcmeta=JSON.parse(o),n.addClass("mcmeta")):(n.removeClass("mcmeta"),delete t[n.attr("data-file-index")].mcmeta),a.remove(),$("#submit-page").show()})).append($("<div>",{class:"button inline",text:"Cancel"}).on("click",e=>{a.remove(),$("#submit-page").show()})).appendTo($("#content")),o=t[n.attr("data-file-index")].mcmeta;a.find("#mcmeta-input").val(o?JSON.stringify(o,null,2):"").focus(),o&&a.find("#done-button").removeClass("disabled").attr("title","Add this mcmeta to the texture"),tippy(a.find("#done-button")[0],{placement:"right",arrow:!0,animation:"perspective",dynamicTitle:!0}),window.scrollTo(0,0),e.stopPropagation()})),"zip"==a&&i.append($("<div>",{class:"action-button set-tag-button",title:"Set tag"}).on("click",e=>{$("#submit-page").hide(),removeAllTooltips();let a=$("<div>",{class:"fill full-height"}).append($("<h2>").text("Tag file")).append($("<p>",{class:"short"}).text("Since the stash can't automatically check what zip files contain, you must tag it with the appropriate type. Select one from the list below.")).append($("<div>",{class:"row"}).append($("<div>",{class:"select inline"}).append($("<select>",{id:"tag-input"}).append($("<option>",{value:"model",selected:"selected",text:"Model"})).append($("<option>",{value:"set",text:"Texture set"})).append($("<option>",{value:"ctm",text:"CTM"})).append($("<option>",{value:"cit",text:"CIT"})))).append($("<div>",{id:"done-button",class:"button inline",text:"Done"}).on("click",e=>{let o=a.find("#tag-input").val();o&&0!=o.length&&"string"==typeof stash.typeNames[o]&&(t[n.attr("data-file-index")].tag=o,n.removeClass("model ctm cit collection").addClass("tagged "+o),n.find(".set-tag-button").attr("title","Edit tag"),a.remove(),$("#submit-page").show())})).append($("<div>",{class:"button inline",text:"Cancel"}).on("click",e=>{a.remove(),$("#submit-page").show()}))).appendTo($("#content")),o=t[n.attr("data-file-index")].tag;o&&a.find("#tag-input").val(o),$("select").selectric(),window.scrollTo(0,0),e.stopPropagation()})),tippy(i.find(".action-button").toArray(),{arrow:!0,animation:"perspective",performance:!0,dynamicTitle:!0}),$("#unsorted-files").append(n)},g=n=>{if(null==e)return;$("#login-status").addClass("logged-in").text("Logged in as "+n).on("click",()=>{localStorage.removeItem("gh-login-token"),goToPage("login")});let i=()=>{let e=$("#file-url-input").val();0!=e.length&&($("#file-url-input").val(""),$("#add-file-button").text("Working..").off("click",i),e.match(o)?(stash.workIndeterminate(),$.ajax({async:!0,crossDomain:!0,url:`https://api.imgur.com/3/album/${o.exec(e)[1]}/images`,method:"GET",headers:{Authorization:"Client-ID 5e061929dcae5e7"}}).done(e=>{1==e.success?(stash.workComplete(),e.data.forEach(e=>{"image/png"==e.type&&m(e.link,"png")})):(stash.workError(),stash.notify("Failed to get Imgur album info.",null,"error")),$("#add-file-button").text("Add").on("click",i)})):(e=c(e),p(e,["image/png","application/zip"],{error:e=>{$("#add-file-button").text("Add").on("click",i),stash.notify(e,null,"error")},verified:t=>{$("#add-file-button").text("Add").on("click",i),m(e,t.split("/")[1])}})))};$("#add-file-button").on("click",i),$("#select-category-button").on("click",()=>{$("#submit-page").hide(),removeAllTooltips();let e=$("<div>",{class:"fill"}).append($("<h2>").text("Choose a category")).appendTo($("#content")),t=$("<div>",{class:"content"}).appendTo(e);for(let a=0;a<stash.categories.length;a++){let n=stash.categories[a],o=$("<a>",{class:"category button"});o.on("click",t=>{e.remove(),$("#sorter-category-input").val(n),$("#submit-page").show()}),o.append($("<div>",{class:"img b-lazy"}).attr("data-src",`/stash/resources/category-icons/${n}.png`).append($("<div>",{class:"spinner-container"}).append($("<div>",{class:"spinner"})))),o.append($("<p>",{text:n})),t.append(o)}window.scrollTo(0,0)}),$("#sort-selected-button").on("click",()=>{let e=$("#sorter-category-input").val();if(!~stash.categories.indexOf(e))return;let t=$("#unsorted-files .selected");if(0==t.length)return;let a=$(`#sorted-files .group[data-category-name="${e}"]`);0==a.length&&((a=$("<div>",{class:"group"}).append($("<h3>",{text:e}))).attr("data-category-name",e),$("#sorted-files").append(a));for(var n=0;n<t.length;n++)$(t[n]).removeClass("selected").addClass("sorted").detach().appendTo(a);$("#content .when-any-selected").addClass("disabled"),$("#unsorted-files").is(":empty")&&!$("#sorted-files").is(":empty")&&$("#submit-button").removeClass("disabled"),u()}),$("#select-all-unsorted-button").on("click",()=>{$("#unsorted-files .file").addClass("selected"),u()}),$("#deselect-all-unsorted-button").on("click",()=>{$("#unsorted-files .selected").removeClass("selected"),u()}),$("#remove-selected-button").on("click",()=>{$("#unsorted-files .selected").remove();let e=[];files=$(".local.file").each((a,n)=>{e.push(t[$(n).attr("data-file-index")]),$(n).attr("data-file-index",e.length-1)}),t=e,0==$("#unsorted-files .file").length&&$("#sorted-files .file").length>0?$("#submit-button").removeClass("disabled"):$("#submit-button").addClass("disabled"),u()}),$("#submit-button").on("click",()=>{if(a)return;if(!$("#unsorted-files").is(":empty"))return void stash.notify("All files must be sorted before submitting.",null,"error");if($("#sorted-files").is(":empty"))return void stash.notify("No files to submit.",null,"error");if(0==$("#sorter-name-input").val().length)return void stash.notify("Contributor name required.",null,"error");if(!$("#sorter-name-input").val().trim().match(/^[-_0-9a-zÀ-ÿ ]+$/i)){let e=/[^-_0-9a-zÀ-ÿ ]/i.exec($("#sorter-name-input").val().trim());return void stash.notify(`Invalid character in contributor name: ${e[0]}`,null,"error")}if($(".zip.no-thumbnail").length>0)return void stash.notify("All zip files must have a thumbnail image.",null,"error");if(~t.findIndex(e=>"zip"==e.type&&!e.tag))return void stash.notify("All zip files must be tagged.",null,"error");a=!0,stash.workIndeterminate();let n=$("#sorted-files .local.file"),o=[];for(var i=0;i<n.length;i++){let e=t[$(n[i]).attr("data-file-index")],a={type:e.type,url:e.url,category:$(n[i]).parent().attr("data-category-name")};e.mcmeta&&(a.mcmeta=e.mcmeta),e.tag&&(a.tag=e.tag),e.thumbnail&&(a.thumbnail=e.thumbnail),o.push(a)}e.getIssues("DokucraftSaga","stash").createIssue({title:"!addfiles",body:"@DokucraftSaga\n"+JSON.stringify({contributor:$("#sorter-name-input").val().trim(),files:o})}).then(e=>{e.status<300?($("#sorted-files .group").remove(),stash.notify("Textures submitted."),stash.workComplete()):(stash.notify(`Failed to submit textures. (${e.status} ${e.statusText})`,null,"error"),stash.workError()),a=!1})}),new Awesomplete($("#sorter-category-input")[0],{list:stash.categories,autoFirst:!0,minChars:1,sort:bestMatchSort($("#sorter-category-input"))}),new Awesomplete($("#sorter-name-input")[0],{list:stash.contributors,autoFirst:!0,sort:bestMatchSort($("#sorter-name-input"))}),tippy("#content .fill .tt",{placement:"right",arrow:!0,hideOnClick:!1,animation:"perspective",flipBehavior:["right","bottom","top"]})},h=getURLParams();if(null!=h){if(h.hasOwnProperty("token"))return void(e=new GitHub({token:h.token})).getUser().getProfile((e,t)=>{e?(localStorage.removeItem("gh-login-token"),goToPage("login")):(localStorage.setItem("gh-login-token",h.token),g(t.name||t.login))});if(h.hasOwnProperty("code"))return void $.getJSON("https://dokustash-gatekeeper.herokuapp.com/authenticate/"+h.code,t=>{(e=new GitHub({token:t.token})).getUser().getProfile((e,a)=>{e?(localStorage.removeItem("gh-login-token"),goToPage("login")):(localStorage.setItem("gh-login-token",t.token),g(a.name||a.login))})})}null==localStorage.getItem("gh-login-token")?goToPage("login"):(e=new GitHub({token:localStorage.getItem("gh-login-token")})).getUser().getProfile((e,t)=>{e?(localStorage.removeItem("gh-login-token"),goToPage("login")):g(t.name||t.login)})})();</script>