<div class="fill full-height" id="submit-page"><h2>Submit Files</h2><a id="login-status">Logging in...</a><p class="short">From here you can submit files to the stash. The files will be reviewed manually before being added and will not show up in the stash before they are approved.</p><br/><h2>Add and sort files</h2><p class="short">To add files, first upload them to a file hosting service. Then get a link to the file you want to add, put it in the field below and click 'Add'.</p><p><i>Need somewhere to host your files? <a href='https://imgur.com/'>Imgur</a> can be used for images. For other files, <a href='https://drive.google.com/'>Google Drive</a> and <a href='https://www.dropbox.com'>Dropbox</a> will work if the files are not private.</i></p><div class="row"><div class="text-input tt" title="&lt;h3&gt;URL&lt;/h3&gt;&lt;i&gt;Supported URLs:&lt;ul&gt;&lt;li&gt;Direct link&lt;/li&gt;&lt;li&gt;Shareable link from Google Drive or Dropbox&lt;/li&gt;&lt;li&gt;Imgur album or image link&lt;/li&gt;&lt;/ul&gt;&lt;br&gt;Only PNG and ZIP files are supported&lt;/i&gt;"><input id="file-url-input" type="text" spellcheck="false" placeholder="URL"/><span></span></div><div class="button inline" id="add-file-button">Add</div></div><br/><br/><p class="short">To sort files into categories, select one or more files by clicking on them, then choose a category to sort them into and click 'Sort selected'. If you make a mistake you can sort a file again after putting it back into the unsorted list by clicking it again.</p><br/><div class="text-input tt" title="&lt;h3&gt;Category name&lt;/h3&gt;&lt;br&gt;&lt;i&gt;Must match name exactly&lt;/i&gt;"><input id="sorter-category-input" type="text" spellcheck="false" placeholder="Category"/><span></span></div><div class="button inline tt" id="select-category-button" title="Select category from list">...</div><div class="button inline when-any-selected disabled" id="sort-selected-button">Sort selected</div><div class="button inline" id="select-all-unsorted-button">Select all</div><div class="button inline when-any-selected disabled" id="deselect-all-unsorted-button">Deselect all</div><div class="button inline when-any-selected disabled" id="remove-selected-button">Remove selected</div><br/><h3>Unsorted files</h3><div id="unsorted-files"></div><div class="content" id="sorted-files"></div><h2>Submit for approval</h2><p class="short">Before you submit the files, you need to enter the name of the contributor who made them below. The files will be renamed to follow the format <code>&lt;Contributor Name&gt;_&lt;ID&gt;.png</code> before being added to the stash and this is where the name is used.</p><br/><div class="text-input tt" title="&lt;h3&gt;Contributor name&lt;/h3&gt;&lt;br&gt;&lt;i&gt;Only autocompletes names of contributors that already have textures in the stash; if your name is not in the list, just ignore it and type in the name manually.&lt;/i&gt;"><input id="sorter-name-input" type="text" spellcheck="false" placeholder="Name"/><span></span></div><div class="button inline disabled" id="submit-button">Submit</div></div><script>(()=>{let e=null,t=[],a=!1,o=/(?:\/|www.)imgur\.com\/([0-9A-Za-z]+)/,n=/(?:\/|www.)imgur\.com\/a\/([0-9A-Za-z]+)/,i=/drive\.google\.com\/file\/d\/([0-9A-Za-z]+)/,l=/drive\.google\.com\/open\?id=([0-9A-Za-z]+)/,s="https://drive.google.com/uc?export=download&id=",r=/www\.dropbox\.com\/s\//,d=e=>e.match(/imgur\.com\//),p=e=>e.match(o)?"https://i.imgur.com/"+o.exec(e)[1]+".png":e.match(l)?s+l.exec(e)[1]:e.match(i)?s+i.exec(e)[1]:e.match(r)?e.replace(r,"dl.dropboxusercontent.com/s/"):e,c=(e,t,a)=>{stash.workIndeterminate();let o=new XMLHttpRequest;o.addEventListener("progress",e=>{e.lengthComputable?stash.setWorkProgress(Math.floor(100*e.loaded/e.total)):stash.workIndeterminate()}),o.addEventListener("error",e=>{a.error("Unable to verify file."),stash.workError(a.reset)}),o.addEventListener("abort",e=>{a.error("Process aborted."),stash.workError(a.reset)}),o.addEventListener("load",e=>{let n=o.getResponseHeader("content-type");~t.indexOf(n)?(stash.workComplete(),a.verified(n)):(a.error("File type not recognized."),stash.workError(a.reset))}),o.open("HEAD",(d(e)?"":cors)+e,!0),o.send()},u=()=>{0==$("#unsorted-files .selected").length?$("#content .when-any-selected").addClass("disabled"):$("#content .when-any-selected").removeClass("disabled")},m=(e,a)=>{t.push({type:a,url:e});let o=E("div").addClass("local file").attr("title",`<h3>${a.toUpperCase()} File</h3><i>${e.replace(/^(.{64}).+/,"$1&hellip;")}</i>`).attr("data-file-index",t.length-1),n=e=>{if(o.is(".sorted")){let e=o.parent();return o.removeClass("sorted").detach().appendTo($("#unsorted-files")),0==e.find(".local.file").length&&e.remove(),void $("#submit-button").addClass("disabled")}o.is(".selected")?o.removeClass("selected"):o.addClass("selected"),u()};o.on("click",n),o.on("contextmenu",e=>{n(),e.preventDefault()});let i=E("div").addClass("overlay").appendTo(o),l=null;tippy(o[0],{arrow:!0,animation:"perspective",placement:"right",onShow(){const e=$(this.querySelector(".tippy-content"));null===l&&(l=e[0].innerHTML),e.empty().append(l),o.is("#unsorted-files .file,.zip.no-thumbnail,.zip:not(.tagged)")&&(e.append("<br><br>"),o.is("#unsorted-files .file")&&(console.log(o),e.append(E("p").addClass("error").text("All files must be sorted into categories."))),o.is(".zip.no-thumbnail")&&e.append(E("p").addClass("error").text("ZIP files must have a thumbnail image.")),o.is(".zip:not(.tagged)")&&e.append(E("p").addClass("error").text("ZIP files must be tagged appropriately.")))}});if("png"==a){o.addClass("png").append(E("div").addClass("img b-lazy").attr("data-src",e)),i.append(E("div").addClass("action-button fullscreen-button").attr("title","Fullscreen").on("click",t=>{$("#fullscreen-cover").removeClass("hidden"),$("#fullscreen-cover .img").removeClass("b-loaded b-error").attr("style","").attr("data-src",e),t.stopPropagation()}));let t=new Image;t.onload=(()=>{t.width<128&&t.height<128&&o.addClass("pixelated")}),t.src=(d(e)?"":cors)+e}else"zip"==a&&(o.addClass("zip no-thumbnail"),i.append(E("div").addClass("action-button add-thumbnail-button").attr("title","Add thumbnail").on("click",e=>{$("#submit-page").hide(),removeAllTooltips();let a=e=>{let i=n.find("#tn-url-input").val();i&&0!=i.length?($("#done-button").text("Working...").off("click",a),i=p(i),c(i,["image/png"],{error:e=>{$("#done-button").text("Done").on("click",a),stash.notify(e,null,"error")},verified:()=>{o.children(".img").remove(),o.removeClass("no-thumbnail").append(E("div").addClass("img b-lazy").attr("data-src",i)),t[o.attr("data-file-index")].thumbnail=i;let e=new Image;e.onload=(()=>{e.width<128&&e.height<128?o.addClass("pixelated"):o.removeClass("pixelated")}),e.src=(d(i)?"":cors)+i,n.remove(),$("#submit-page").show()}})):(o.addClass("no-thumbnail").children(".img").remove(),delete t[o.attr("data-file-index")].thumbnail,n.remove(),$("#submit-page").show())},n=E("div").addClass("fill").append(E("h2").text("Add thumbnail to file")).append(E("p").text("Paste or type in the URL of a thumbnail image below.")).append(E("div").addClass("text-input").append(E("input").attr("id","tn-url-input").attr("type","text").attr("spellcheck",!1).attr("placeholder","URL")).append(E("span"))).append(E("div").attr("id","done-button").addClass("button inline").text("Done").on("click",a)).append(E("div").addClass("button inline").text("Cancel").on("click",e=>{n.remove(),$("#submit-page").show()})).appendTo($("#content")),i=t[o.attr("data-file-index")].thumbnail;n.find("#tn-url-input").val(i||"").focus(),i&&n.find("#done-button").removeClass("disabled"),window.scrollTo(0,0),e.stopPropagation()})));i.append(E("div").addClass("action-button mcmeta-button").attr("title","zip"==a?"Edit thumbnail mcmeta":"Edit mcmeta").on("click",e=>{$("#submit-page").hide(),removeAllTooltips();let a=E("div").addClass("fill").append(E("h2").text("Add mcmeta file")).append(E("p").text("Paste or type in the content of this texture's mcmeta file below.")).append(E("textarea").attr("id","mcmeta-input").attr("spellcheck",!1).on("input",e=>{let t=a.find("#mcmeta-input").val();if(t&&0!=t.length)try{JSON.parse(t),a.find("#done-button").removeClass("disabled").attr("title","Set the mcmeta of the texture to the above text")}catch(e){a.find("#done-button").addClass("disabled").attr("title",e.toString())}else a.find("#done-button").removeClass("disabled").attr("title","Remove mcmeta from texture")})).append(E("div").attr("id","done-button").addClass("button disabled inline").text("Done").attr("title","Enter mcmeta content above").on("click",e=>{if($(e.currentTarget).is(".disabled"))return;let n=a.find("#mcmeta-input").val();n&&0!=n.length?(t[o.attr("data-file-index")].mcmeta=JSON.parse(n),o.addClass("mcmeta")):(o.removeClass("mcmeta"),delete t[o.attr("data-file-index")].mcmeta),a.remove(),$("#submit-page").show()})).append(E("div").addClass("button inline").text("Cancel").on("click",e=>{a.remove(),$("#submit-page").show()})).appendTo($("#content")),n=t[o.attr("data-file-index")].mcmeta;a.find("#mcmeta-input").val(n?JSON.stringify(n,null,2):"").focus(),n&&a.find("#done-button").removeClass("disabled").attr("title","Add this mcmeta to the texture"),tippy(a.find("#done-button")[0],{placement:"right",arrow:!0,animation:"perspective",dynamicTitle:!0}),window.scrollTo(0,0),e.stopPropagation()})),"zip"==a&&i.append(E("div").addClass("action-button set-tag-button").attr("title","Set tag").on("click",e=>{$("#submit-page").hide(),removeAllTooltips();let a=E("div").addClass("fill full-height").append(E("h2").text("Tag file")).append(E("p").addClass("short").text("Since the stash can't automatically check what zip files contain, you must tag it with the appropriate type. Select one from the list below.")).append(E("div").addClass("row").append(E("div").addClass("select inline").append(E("select").attr("id","tag-input").append(E("option").attr("value","model").text("Model").prop("selected",!0)).append(E("option").attr("value","set").text("Texture set")).append(E("option").attr("value","ctm").text("CTM")).append(E("option").attr("value","cit").text("CIT")))).append(E("div").attr("id","done-button").addClass("button inline").text("Done").on("click",e=>{let n=a.find("#tag-input").val();n&&0!=n.length&&"string"==typeof stash.typeNames[n]&&(t[o.attr("data-file-index")].tag=n,o.removeClass("model ctm cit collection").addClass("tagged "+n),o.find(".set-tag-button").attr("title","Edit tag"),a.remove(),$("#submit-page").show())})).append(E("div").addClass("button inline").text("Cancel").on("click",e=>{a.remove(),$("#submit-page").show()}))).appendTo($("#content")),n=t[o.attr("data-file-index")].tag;n&&a.find("#tag-input").val(n),$("select").selectric(),window.scrollTo(0,0),e.stopPropagation()})),tippy(i.find(".action-button").toArray(),{arrow:!0,animation:"perspective",performance:!0,dynamicTitle:!0}),$("#unsorted-files").append(o)},g=o=>{if(null==e)return;$("#login-status").addClass("logged-in").text("Logged in as "+o).on("click",()=>{localStorage.removeItem("gh-login-token"),goToPage("login")});let i=()=>{let e=$("#file-url-input").val();0!=e.length&&($("#file-url-input").val(""),$("#add-file-button").text("Working..").off("click",i),e.match(n)?(stash.workIndeterminate(),$.ajax({async:!0,crossDomain:!0,url:`https://api.imgur.com/3/album/${n.exec(e)[1]}/images`,method:"GET",headers:{Authorization:"Client-ID 5e061929dcae5e7"}}).done(e=>{1==e.success?(stash.workComplete(),e.data.forEach(e=>{"image/png"==e.type&&m(e.link,"png")})):(stash.workError(),stash.notify("Failed to get Imgur album info.",null,"error")),$("#add-file-button").text("Add").on("click",i)})):(e=p(e),c(e,["image/png","application/zip"],{error:e=>{$("#add-file-button").text("Add").on("click",i),stash.notify(e,null,"error")},verified:t=>{$("#add-file-button").text("Add").on("click",i),m(e,t.split("/")[1])}})))};$("#add-file-button").on("click",i),$("#select-category-button").on("click",()=>{$("#submit-page").hide(),removeAllTooltips();let e=E("div").addClass("fill").append(E("h2").text("Choose a category")).appendTo($("#content")),t=E("div").addClass("content").appendTo(e);for(let a=0;a<stash.categories.length;a++){let o=stash.categories[a],n=E("a").addClass("category button");n.on("click",t=>{e.remove(),$("#sorter-category-input").val(o),$("#submit-page").show()}),n.append(E("div").addClass("img b-lazy").attr("data-src",`/stash/resources/category-icons/${o}.png`)),n.append(E("p").text(o)),t.append(n)}window.scrollTo(0,0)}),$("#sort-selected-button").on("click",()=>{let e=$("#sorter-category-input").val();if(!~stash.categories.indexOf(e))return;let t=$("#unsorted-files .selected");if(0==t.length)return;let a=$(`#sorted-files .group[data-category-name="${e}"]`);0==a.length&&((a=E("div").addClass("group").append(E("h3").text(e))).attr("data-category-name",e),$("#sorted-files").append(a));for(var o=0;o<t.length;o++)$(t[o]).removeClass("selected").addClass("sorted").detach().appendTo(a);$("#content .when-any-selected").addClass("disabled"),$("#unsorted-files").is(":empty")&&!$("#sorted-files").is(":empty")&&$("#submit-button").removeClass("disabled"),u()}),$("#select-all-unsorted-button").on("click",()=>{$("#unsorted-files .file").addClass("selected"),u()}),$("#deselect-all-unsorted-button").on("click",()=>{$("#unsorted-files .selected").removeClass("selected"),u()}),$("#remove-selected-button").on("click",()=>{$("#unsorted-files .selected").remove();let e=[];files=$(".local.file").each((a,o)=>{e.push(t[$(o).attr("data-file-index")]),$(o).attr("data-file-index",e.length-1)}),t=e,0==$("#unsorted-files .file").length&&$("#sorted-files .file").length>0?$("#submit-button").removeClass("disabled"):$("#submit-button").addClass("disabled"),u()}),$("#submit-button").on("click",()=>{if(a)return;if(!$("#unsorted-files").is(":empty"))return void stash.notify("All files must be sorted before submitting.",null,"error");if($("#sorted-files").is(":empty"))return void stash.notify("No files to submit.",null,"error");if(0==$("#sorter-name-input").val().length)return void stash.notify("Contributor name required.",null,"error");if(!$("#sorter-name-input").val().trim().match(/^[-_0-9a-zÀ-ÿ ]+$/i)){let e=/[^-_0-9a-zÀ-ÿ ]/i.exec($("#sorter-name-input").val().trim());return void stash.notify(`Invalid character in contributor name: ${e[0]}`,null,"error")}if($(".zip.no-thumbnail").length>0)return void stash.notify("All zip files must have a thumbnail image.",null,"error");if(~t.findIndex(e=>"zip"==e.type&&!e.tag))return void stash.notify("All zip files must be tagged.",null,"error");a=!0,stash.workIndeterminate();let o=$("#sorted-files .local.file"),n=[];for(var i=0;i<o.length;i++){let e=t[$(o[i]).attr("data-file-index")],a={type:e.type,url:e.url,category:$(o[i]).parent().attr("data-category-name")};e.mcmeta&&(a.mcmeta=e.mcmeta),e.tag&&(a.tag=e.tag),e.thumbnail&&(a.thumbnail=e.thumbnail),n.push(a)}e.getIssues("DokucraftSaga","stash").createIssue({title:"!addfiles",body:"@DokucraftSaga\n"+JSON.stringify({contributor:$("#sorter-name-input").val().trim(),files:n})}).then(e=>{e.status<300?($("#sorted-files .group").remove(),stash.notify("Textures submitted."),stash.workComplete()):(stash.notify(`Failed to submit textures. (${e.status} ${e.statusText})`,null,"error"),stash.workError()),a=!1})}),new Awesomplete($("#sorter-category-input")[0],{list:stash.categories,autoFirst:!0,minChars:1,sort:bestMatchSort($("#sorter-category-input"))}),new Awesomplete($("#sorter-name-input")[0],{list:stash.contributors,autoFirst:!0,sort:bestMatchSort($("#sorter-name-input"))}),tippy("#content .fill .tt",{placement:"right",arrow:!0,hideOnClick:!1,animation:"perspective",flipBehavior:["right","bottom","top"]})},h=getURLParams();if(null!=h){if(h.hasOwnProperty("token"))return void(e=new GitHub({token:h.token})).getUser().getProfile((e,t)=>{e?(localStorage.removeItem("gh-login-token"),goToPage("login")):(localStorage.setItem("gh-login-token",h.token),g(t.name||t.login))});if(h.hasOwnProperty("code"))return void $.getJSON("https://dokustash-gatekeeper.herokuapp.com/authenticate/"+h.code,t=>{(e=new GitHub({token:t.token})).getUser().getProfile((e,a)=>{e?(localStorage.removeItem("gh-login-token"),goToPage("login")):(localStorage.setItem("gh-login-token",t.token),g(a.name||a.login))})})}null==localStorage.getItem("gh-login-token")?goToPage("login"):(e=new GitHub({token:localStorage.getItem("gh-login-token")})).getUser().getProfile((e,t)=>{e?(localStorage.removeItem("gh-login-token"),goToPage("login")):g(t.name||t.login)})})();</script>