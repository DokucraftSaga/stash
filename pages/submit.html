<h2>Submit Files</h2><a id="login-status">Logging in...</a><p class="short">From here you can submit files to the stash. The files will be reviewed manually before being added and will not show up in the stash before they are approved.</p><br/><h2>Add and sort files</h2><p class="short">To add files, first upload them to a file hosting service. Then, get a link to the file you want to add, put it in the field below and click 'Add'.</p><p><i>Need somewhere to host your files? <a href='https://imgur.com/'>Imgur</a> can be used for images. For other files, <a href='https://drive.google.com/'>Google Drive</a> and <a href='https://www.dropbox.com'>Dropbox</a> will work if the files are not private.</i></p><div class="row"><div class="text-input tt" title="&lt;h3&gt;URL&lt;/h3&gt;&lt;i&gt;Supported URLs:&lt;ul&gt;&lt;li&gt;Direct link&lt;/li&gt;&lt;li&gt;Shareable link from Google Drive or Dropbox&lt;/li&gt;&lt;li&gt;Imgur album or image link&lt;/li&gt;&lt;/ul&gt;&lt;br&gt;Only PNG and ZIP files are supported&lt;/i&gt;"><input id="file-url-input" type="text" spellcheck="false" placeholder="URL"/><span></span></div><div class="button inline" id="add-file-button">Add</div></div><br/><br/><p class="short">To sort files into categories, select one or more files by clicking on them, then choose a category to sort them into and click 'Sort selected'. If you make a mistake, you can sort a file again after putting it back into the unsorted list by clicking it once more.</p><br/><div class="text-input tt" title="&lt;h3&gt;Category name&lt;/h3&gt;&lt;br&gt;&lt;i&gt;Must match name exactly&lt;/i&gt;"><input id="sorter-category-input" type="text" spellcheck="false" placeholder="Category"/><span></span></div><div class="button inline tt" id="select-category-button" title="Select category from list">...</div><div class="button inline when-any-selected disabled" id="sort-selected-button">Sort selected</div><div class="button inline" id="select-all-unsorted-button">Select all</div><div class="button inline when-any-selected disabled" id="deselect-all-unsorted-button">Deselect all</div><div class="button inline when-any-selected disabled" id="remove-selected-button">Remove selected</div><br/><h3>Unsorted files</h3><div id="unsorted-files"></div><div id="sorted-files"></div><h2>Submit for approval</h2><p class="short">Before you submit the files, you need to enter the name of the contributor who made them below. The files will automatically be renamed to follow the format <code>&lt;Contributor Name&gt;_&lt;ID&gt;.png</code> before being added to the stash and this is where the name is used.</p><br/><div class="text-input tt" title="&lt;h3&gt;Contributor name&lt;/h3&gt;&lt;br&gt;&lt;i&gt;Only autocompletes names of contributors that already have textures in the stash; if your name is not in the list, just ignore it and type in the name manually.&lt;/i&gt;"><input id="sorter-name-input" type="text" spellcheck="false" placeholder="Name"/><span></span></div><div class="button inline disabled" id="submit-button">Submit</div><link rel="stylesheet" href="/stash/pages/css/submit.css"/><script>(()=>{let t=null,e=[],a=!1,o=/(?:\/|www.)imgur\.com\/([0-9A-Za-z]+)/,n=/(?:\/|www.)imgur\.com\/a\/([0-9A-Za-z]+)/,s=/drive\.google\.com\/file\/d\/([0-9A-Za-z_-]+)/,l=/drive\.google\.com\/open\?id=([0-9A-Za-z_-]+)/,i="https://drive.google.com/uc?export=download&id=",r=/www\.dropbox\.com\/s\//,d=t=>t.match(/imgur\.com\//),c=t=>t.match(o)?"https://i.imgur.com/"+o.exec(t)[1]+".png":t.match(l)?i+l.exec(t)[1]:t.match(s)?i+s.exec(t)[1]:t.match(r)?t.replace(r,"dl.dropboxusercontent.com/s/"):t,p=(t,e,a)=>{stash.workIndeterminate();let o=new XMLHttpRequest;o.addEventListener("progress",t=>{t.lengthComputable?stash.setWorkProgress(Math.floor(100*t.loaded/t.total)):stash.workIndeterminate()}),o.addEventListener("error",t=>{a.error("Unable to verify file."),stash.workError(a.reset)}),o.addEventListener("abort",t=>{a.error("Process aborted."),stash.workError(a.reset)}),o.addEventListener("load",t=>{let n=o.getResponseHeader("content-type");~e.indexOf(n)?(stash.workComplete(),a.verified(n)):(a.error("File type not recognized: "+n),stash.workError(a.reset))}),o.open("HEAD",(d(t)?"":cors)+t,!0),o.send()},m=()=>{0==$("#unsorted-files .selected").length?$("#content .when-any-selected").addClass("disabled"):$("#content .when-any-selected").removeClass("disabled")},u=(t,a)=>{e.push({type:a,url:t});let o=E("div").addClass("local file").attr("title",`<h3>${a.toUpperCase()} File</h3><i>${t.replace(/^(.{64}).+/,"$1&hellip;")}</i>`).attr("data-file-index",e.length-1),n=t=>{if(o.is(".sorted")){let t=o.parent();return o.removeClass("sorted").detach().appendTo($("#unsorted-files")),0==t.find(".local.file").length&&t.remove(),void $("#submit-button").addClass("disabled")}o.is(".selected")?o.removeClass("selected"):o.addClass("selected"),m()};o.on("click",n),o.on("contextmenu",t=>{n(),t.preventDefault()});let s=E("div").addClass("overlay").appendTo(o),l=null;tippy(o[0],{arrow:!0,animation:"perspective",placement:"right",hideOnClick:!1,onShow(){const t=$(this.querySelector(".tippy-content"));null===l&&(l=t[0].innerHTML),t.empty().append(l),o.is("#unsorted-files .file,.zip.no-thumbnail,.zip:not(.tagged)")&&(t.append("<br><br>"),o.is("#unsorted-files .file")&&t.append(E("p").addClass("error").text("All files must be sorted into categories.")),o.is(".zip.no-thumbnail")&&t.append(E("p").addClass("error").text("ZIP files must have a thumbnail image.")),o.is(".zip:not(.tagged)")&&t.append(E("p").addClass("error").text("ZIP files must be tagged appropriately.")))}});"png"==a?(o.addClass("png").append(E("div").addClass("img b-lazy").attr("data-src",t)),s.append(E("div").addClass("action-button fullscreen-button").attr("title","Fullscreen").on("click",e=>{stash.fullscreenImage(t),e.stopPropagation()})),stash.getImage((d(t)?"":cors)+t).then(t=>{t.width<128&&t.height<128&&o.addClass("pixelated")})):"zip"==a&&(o.addClass("zip no-thumbnail").attr("data-filetype","Unknown ZIP"),s.append(E("div").addClass("action-button add-thumbnail-button").attr("title","Add thumbnail").on("click",t=>{const a=stash.page.modal();a.find(".content").append(E("h2").text("Add thumbnail to file"),E("p").text("Paste or type in the URL of a thumbnail image below."),E("div").addClass("text-input").append(E("input").attr("id","tn-url-input").attr("type","text").attr("spellcheck",!1).attr("placeholder","URL"),E("span")),E("br"),E("br"),E("div").attr("id","done-button").addClass("button inline").text("Done").on("click",t=>{let n=$("#tn-url-input").val();if(n&&0!=n.length){const t=stash.blockInput("flex no-scroll",!1).append(stash.diamond.create(300,"indeterminate"));t.find(".content").append("Working..."),n=c(n),p(n,["image/png"],{error:e=>{stash.removeInputBlocker(t),stash.notify(e,null,"error")},verified:()=>{o.children(".img").remove(),o.removeClass("no-thumbnail").append(E("div").addClass("img b-lazy").attr("data-src",n)),e[o.attr("data-file-index")].thumbnail=n,stash.getImage((d(n)?"":cors)+n).then(t=>{t.width<128&&t.height<128?o.addClass("pixelated"):o.removeClass("pixelated")}),stash.removeInputBlocker(t),stash.page.closeModal(a)}})}else o.addClass("no-thumbnail").children(".img").remove(),delete e[o.attr("data-file-index")].thumbnail,stash.page.closeModal(a)}),E("div").addClass("button inline").text("Cancel").on("click",t=>stash.page.closeModal(a)));const n=e[o.attr("data-file-index")].thumbnail;$("#tn-url-input").val(n||"").focus(),n&&$("#done-button").removeClass("disabled"),t.stopPropagation()}))),s.append(E("div").addClass("action-button mcmeta-button").attr("title","zip"==a?"Edit thumbnail mcmeta":"Edit mcmeta").on("click",t=>{const a=stash.page.modal();a.find(".content").append(E("h2").text("Add mcmeta file"),E("p").text("Paste or type in the content of this texture's mcmeta file below."),E("textarea").attr("id","mcmeta-input").attr("spellcheck",!1).on("input",t=>{let e=$("#mcmeta-input").val();if(e&&0!=e.length)try{JSON.parse(e),$("#done-button").removeClass("disabled").attr("title","Set the mcmeta of the texture to the above text")}catch(t){$("#done-button").addClass("disabled").attr("title",t.toString())}else $("#done-button").removeClass("disabled").attr("title","Remove mcmeta from texture")}),E("div").attr("id","done-button").addClass("button disabled inline").text("Done").attr("title","Enter mcmeta content above").on("click",t=>{if($(t.currentTarget).is(".disabled"))return;let n=$("#mcmeta-input").val();n&&0!=n.length?(e[o.attr("data-file-index")].mcmeta=JSON.parse(n),o.addClass("mcmeta")):(o.removeClass("mcmeta"),delete e[o.attr("data-file-index")].mcmeta),stash.page.closeModal(a)}),E("div").addClass("button inline").text("Cancel").on("click",t=>stash.page.closeModal(a)));let n=e[o.attr("data-file-index")].mcmeta;$("#mcmeta-input").val(n?JSON.stringify(n,null,2):"").focus(),n&&$("#done-button").removeClass("disabled").attr("title","Add this mcmeta to the texture"),tippy($("#done-button")[0],{placement:"right",arrow:!0,animation:"perspective",dynamicTitle:!0}),t.stopPropagation()})),"zip"==a&&s.append(E("div").addClass("action-button set-tag-button").attr("title","Set tag").on("click",t=>{const a=stash.page.modal();a.find(".content").append(E("h2").text("Tag file"),E("p").addClass("short").text("Since the stash can't automatically check what zip files contain, you must tag it with the appropriate type. Select one from the list below."),E("div").addClass("row").append(E("div").addClass("select inline").append(E("select").attr("id","tag-input").append(E("option").attr("value","model").text("Model").prop("selected",!0),E("option").attr("value","set").text("Texture set"),E("option").attr("value","ctm").text("CTM"),E("option").attr("value","cit").text("CIT"))),E("div").attr("id","done-button").addClass("button inline").text("Done").on("click",t=>{let n=$("#tag-input").val();n&&0!=n.length&&"string"==typeof stash.typeNames[n]&&(e[o.attr("data-file-index")].tag=n,o.removeClass("model ctm cit collection").addClass("tagged "+n).attr("data-filetype",stash.typeNames[n]),o.find(".set-tag-button").attr("title","Edit tag"),stash.page.closeModal(a))}),E("div").addClass("button inline").text("Cancel").on("click",t=>stash.page.closeModal(a))));let n=e[o.attr("data-file-index")].tag;n&&$("#tag-input").val(n),$("select").selectric(),t.stopPropagation()})),tippy(s.find(".action-button").toArray(),{arrow:!0,animation:"perspective",performance:!0,dynamicTitle:!0}),$("#unsorted-files").append(o)},g=o=>{null!=t&&($("#login-status").addClass("logged-in").text("Logged in as "+o).on("click",()=>{localStorage.removeItem("gh-login-token"),goToPage("login")}),$("#add-file-button").on("click",()=>{let t=$("#file-url-input").val();if(0==t.length)return;$("#file-url-input").val("");const e=stash.blockInput("flex no-scroll",!1).append(stash.diamond.create(300,"indeterminate"));e.find(".content").append("Working..."),t.match(n)?(stash.workIndeterminate(),$.ajax({async:!0,crossDomain:!0,url:`https://api.imgur.com/3/album/${n.exec(t)[1]}/images`,method:"GET",headers:{Authorization:"Client-ID 5e061929dcae5e7"}}).done(t=>{1==t.success?(stash.workComplete(),t.data.forEach(t=>{"image/png"==t.type&&u(t.link,"png")})):(stash.workError(),stash.notify("Failed to get Imgur album info.",null,"error")),stash.removeInputBlocker(e)})):(t=c(t),p(t,["image/png","application/zip","application/x-zip-compressed"],{error:t=>{stash.removeInputBlocker(e),stash.notify(t,null,"error")},verified:a=>{stash.removeInputBlocker(e),u(t,a.match(/png/)?"png":"zip")}}))}),$("#select-category-button").on("click",()=>{const t=stash.page.modal();t.find(".content").append(E("h2").text("Choose a category"));let e=E("div").addClass("flex-wrapper").appendTo(t.find(".content"));for(let a=0;a<stash.categories.length;a++){let o=stash.categories[a];E("a").addClass("category").on("click",e=>{stash.page.closeModal(t),$("#sorter-category-input").val(o)}).append(E("div").addClass("img b-lazy").attr("data-src",`/stash/resources/category-icons/${o}.png`),o).appendTo(e)}}),$("#sort-selected-button").on("click",()=>{let t=$("#sorter-category-input").val();if(!~stash.categories.indexOf(t))return;let e=$("#unsorted-files .selected");if(0==e.length)return;let a=$(`#sorted-files .group[data-category-name="${t}"]`);0==a.length&&((a=E("div").addClass("group").append(E("h3").text(t))).attr("data-category-name",t),$("#sorted-files").append(a));for(var o=0;o<e.length;o++)$(e[o]).removeClass("selected").addClass("sorted").detach().appendTo(a);$("#content .when-any-selected").addClass("disabled"),$("#unsorted-files").is(":empty")&&!$("#sorted-files").is(":empty")&&$("#submit-button").removeClass("disabled"),m()}),$("#select-all-unsorted-button").on("click",()=>{$("#unsorted-files .file").addClass("selected"),m()}),$("#deselect-all-unsorted-button").on("click",()=>{$("#unsorted-files .selected").removeClass("selected"),m()}),$("#remove-selected-button").on("click",()=>{$("#unsorted-files .selected").remove();let t=[];files=$(".local.file").each((a,o)=>{t.push(e[$(o).attr("data-file-index")]),$(o).attr("data-file-index",t.length-1)}),e=t,0==$("#unsorted-files .file").length&&$("#sorted-files .file").length>0?$("#submit-button").removeClass("disabled"):$("#submit-button").addClass("disabled"),m()}),$("#submit-button").on("click",()=>{if(a)return;if(!$("#unsorted-files").is(":empty"))return void stash.notify("All files must be sorted before submitting.",null,"error");if($("#sorted-files").is(":empty"))return void stash.notify("No files to submit.",null,"error");if(0==$("#sorter-name-input").val().length)return void stash.notify("Contributor name required.",null,"error");if(!$("#sorter-name-input").val().trim().match(/^[-_0-9a-zÀ-ÿ ]+$/i)){let t=/[^-_0-9a-zÀ-ÿ ]/i.exec($("#sorter-name-input").val().trim());return void stash.notify(`Invalid character in contributor name: ${t[0]}`,null,"error")}if($(".zip.no-thumbnail").length>0)return void stash.notify("All zip files must have a thumbnail image.",null,"error");if(~e.findIndex(t=>"zip"==t.type&&!t.tag))return void stash.notify("All zip files must be tagged.",null,"error");a=!0,stash.workIndeterminate();let o=$("#sorted-files .local.file"),n=[];for(var s=0;s<o.length;s++){let t=e[$(o[s]).attr("data-file-index")],a={type:t.type,url:t.url,category:$(o[s]).parent().attr("data-category-name")};t.mcmeta&&(a.mcmeta=t.mcmeta),t.tag&&(a.tag=t.tag),t.thumbnail&&(a.thumbnail=t.thumbnail),n.push(a)}t.getIssues("DokucraftSaga","stash").createIssue({title:"!addfiles",body:"@DokucraftSaga\n"+JSON.stringify({contributor:$("#sorter-name-input").val().trim(),files:n})}).then(t=>{t.status<300?($("#sorted-files .group").remove(),stash.notify(`File${n.length>1?"s":""} submitted.`),stash.workComplete()):(stash.notify(`Failed to submit file${n.length>1?"s":""}. (${t.status} ${t.statusText})`,null,"error"),stash.workError()),a=!1})}),new Awesomplete($("#sorter-category-input")[0],{list:stash.categories,autoFirst:!0,minChars:1,sort:bestMatchSort($("#sorter-category-input"))}),new Awesomplete($("#sorter-name-input")[0],{list:stash.contributors,autoFirst:!0,sort:bestMatchSort($("#sorter-name-input"))}),tippy("#content .tt",{placement:"right",arrow:!0,hideOnClick:!1,animation:"perspective",flipBehavior:["right","bottom","top"]}))},h=getURLParams();if(null!=h){if(h.hasOwnProperty("token"))return void(t=new GitHub({token:h.token})).getUser().getProfile((t,e)=>{t?(localStorage.removeItem("gh-login-token"),goToPage("login")):(localStorage.setItem("gh-login-token",h.token),g(e.name||e.login))});if(h.hasOwnProperty("code"))return void $.getJSON("https://dokustash-gatekeeper.herokuapp.com/authenticate/"+h.code,e=>{(t=new GitHub({token:e.token})).getUser().getProfile((t,a)=>{t?(localStorage.removeItem("gh-login-token"),goToPage("login")):(localStorage.setItem("gh-login-token",e.token),g(a.name||a.login))})})}null==localStorage.getItem("gh-login-token")?goToPage("login"):(t=new GitHub({token:localStorage.getItem("gh-login-token")})).getUser().getProfile((t,e)=>{t?(localStorage.removeItem("gh-login-token"),goToPage("login")):g(e.name||e.login)})})();</script>