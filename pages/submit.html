<h2>Submit Files</h2><a class="login-status">Logging in...</a><p class="short">From here you can submit files to the stash. The files will be reviewed manually before being added and will not show up in the stash before they are approved.</p><br/><h2>Add and sort files</h2><p class="short">To add files, first upload them to a file hosting service. Then, get a link to the file you want to add, put it in the field below and click 'Add'.</p><p><i>Need somewhere to host your files? <a href='https://imgur.com/'>Imgur</a> can be used for images. For other files, <a href='https://drive.google.com/'>Google Drive</a> and <a href='https://www.dropbox.com'>Dropbox</a> will work if the files are not private.</i></p><div class="row"><div class="text-input tt" title="&lt;h3&gt;URL&lt;/h3&gt;&lt;i&gt;Supported URLs:&lt;ul&gt;&lt;li&gt;Direct link&lt;/li&gt;&lt;li&gt;Shareable link from Google Drive or Dropbox&lt;/li&gt;&lt;li&gt;Imgur album or image link&lt;/li&gt;&lt;/ul&gt;&lt;br&gt;Only PNG and ZIP files are supported&lt;/i&gt;"><input class="file-url-input" type="text" spellcheck="false" placeholder="URL"/><span></span></div><div class="add-file-button button inline">Add</div></div><br/><br/><p class="short">To sort files into categories, select one or more files by clicking on them, then choose a category to sort them into and click 'Sort selected'. If you make a mistake, you can sort a file again after putting it back into the unsorted list by clicking it once more.</p><br/><div class="text-input tt" title="&lt;h3&gt;Category name&lt;/h3&gt;&lt;br&gt;&lt;i&gt;Must match name exactly&lt;/i&gt;"><input class="sorter-category-input" type="text" spellcheck="false" placeholder="Category"/><span></span></div><div class="select-category-button button inline tt" title="Select category from list">...</div><div class="sort-selected-button button inline when-any-selected disabled">Sort selected</div><div class="select-all-unsorted-button button inline">Select all</div><div class="deselect-all-unsorted-button button inline when-any-selected disabled">Deselect all</div><div class="remove-selected-button button inline when-any-selected disabled">Remove selected</div><br/><h3>Unsorted files</h3><div class="unsorted-files"></div><div class="sorted-files"></div><h2>Submit for approval</h2><p class="short">Before you submit the files, you need to enter the name of the contributor who made them below. The files will automatically be renamed to follow the format <code>&lt;Contributor Name&gt;_&lt;ID&gt;.png</code> before being added to the stash and this is where the name is used.</p><br/><div class="text-input tt" title="&lt;h3&gt;Contributor name&lt;/h3&gt;&lt;br&gt;&lt;i&gt;Only autocompletes names of contributors that already have textures in the stash; if your name is not in the list, just ignore it and type in the name manually.&lt;/i&gt;"><input class="sorter-name-input" type="text" spellcheck="false" placeholder="Name"/><span></span></div><div class="submit-button button inline disabled">Submit</div><link rel="stylesheet" href="/stash/pages/css/submit.css"/><script>stash.page.identifier().then(t=>{let e=null,a=[],n=!1,i=/(?:\/|www.)imgur\.com\/([0-9A-Za-z]+)/,s=/(?:\/|www.)imgur\.com\/a\/([0-9A-Za-z]+)/,o=/drive\.google\.com\/file\/d\/([0-9A-Za-z_-]+)/,l=/drive\.google\.com\/open\?id=([0-9A-Za-z_-]+)/,d="https://drive.google.com/uc?export=download&id=",r=/www\.dropbox\.com\/s\//,c=t=>t.match(/imgur\.com\//),p=t=>t.match(i)?"https://i.imgur.com/"+i.exec(t)[1]+".png":t.match(l)?d+l.exec(t)[1]:t.match(o)?d+o.exec(t)[1]:t.match(r)?t.replace(r,"dl.dropboxusercontent.com/s/"):t,m=(t,e,a)=>{stash.workIndeterminate();let n=new XMLHttpRequest;n.addEventListener("progress",t=>{t.lengthComputable?stash.setWorkProgress(Math.floor(100*t.loaded/t.total)):stash.workIndeterminate()}),n.addEventListener("error",t=>{a.error("Unable to verify file."),stash.workError(a.reset)}),n.addEventListener("abort",t=>{a.error("Process aborted."),stash.workError(a.reset)}),n.addEventListener("load",t=>{let i=n.getResponseHeader("content-type");~e.indexOf(i)?(stash.workComplete(),a.verified(i)):(a.error("File type not recognized: "+i),stash.workError(a.reset))}),n.open("HEAD",(c(t)?"":cors)+t,!0),n.send()},u=()=>{0==t.find(".unsorted-files .selected").length?t.find(".when-any-selected").addClass("disabled"):t.find(".when-any-selected").removeClass("disabled")},f=(e,n)=>{a.push({type:n,url:e});let i=E("div").addClass("local file").attr("title",`<h3>${n.toUpperCase()} File</h3><i>${e.replace(/^(.{64}).+/,"$1&hellip;")}</i>`).attr("data-file-index",a.length-1),s=e=>{if(i.is(".sorted")){let e=i.parent();return i.removeClass("sorted").detach().appendTo(t.find(".unsorted-files")),0==e.find(".local.file").length&&e.remove(),void t.find(".submit-button").addClass("disabled")}i.is(".selected")?i.removeClass("selected"):i.addClass("selected"),u()};i.on("click",s),i.on("contextmenu",t=>{s(),t.preventDefault()});let o=E("div").addClass("overlay").appendTo(i),l=null;tippy(i[0],{arrow:!0,animation:"perspective",placement:"right",hideOnClick:!1,onShow(){const t=$(this.querySelector(".tippy-content"));null===l&&(l=t[0].innerHTML),t.empty().append(l),i.is("#unsorted-files .file,.zip.no-thumbnail,.zip:not(.tagged)")&&(t.append("<br><br>"),i.is("#unsorted-files .file")&&t.append(E("p").addClass("error").text("All files must be sorted into categories.")),i.is(".zip.no-thumbnail")&&t.append(E("p").addClass("error").text("ZIP files must have a thumbnail image.")),i.is(".zip:not(.tagged)")&&t.append(E("p").addClass("error").text("ZIP files must be tagged appropriately.")))}});"png"==n?(i.addClass("png").append(E("div").addClass("img b-lazy").attr("data-src",e)),o.append(E("div").addClass("action-button fullscreen-button").attr("title","Fullscreen").on("click",t=>{stash.fullscreenImage(e),t.stopPropagation()})),stash.getImage((c(e)?"":cors)+e).then(t=>{t.width<128&&t.height<128&&i.addClass("pixelated")})):"zip"==n&&(i.addClass("zip no-thumbnail").attr("data-filetype","Unknown ZIP"),o.append(E("div").addClass("action-button add-thumbnail-button").attr("title","Add thumbnail").on("click",t=>{const e=stash.page.modal();e.find(".content").append(E("h2").text("Add thumbnail to file"),E("p").text("Paste or type in the URL of a thumbnail image below."),E("div").addClass("text-input").append(E("input").addClass("tn-url-input").attr("type","text").attr("spellcheck",!1).attr("placeholder","URL"),E("span")),E("br"),E("br"),E("div").addClass("done-button").addClass("button inline").text("Done").on("click",t=>{let n=e.find(".tn-url-input").val();if(n&&0!=n.length){const t=stash.blockInput("flex no-scroll",!1).append(stash.diamond.create(300,"indeterminate"));t.find(".content").append("Working..."),n=p(n),m(n,["image/png"],{error:e=>{stash.removeInputBlocker(t),stash.notify(e,null,"error")},verified:()=>{i.children(".img").remove(),i.removeClass("no-thumbnail").append(E("div").addClass("img b-lazy").attr("data-src",n)),a[i.attr("data-file-index")].thumbnail=n,stash.getImage((c(n)?"":cors)+n).then(t=>{t.width<128&&t.height<128?i.addClass("pixelated"):i.removeClass("pixelated")}),stash.removeInputBlocker(t),stash.page.closeModal(e)}})}else i.addClass("no-thumbnail").children(".img").remove(),delete a[i.attr("data-file-index")].thumbnail,stash.page.closeModal(e)}),E("div").addClass("button inline").text("Cancel").on("click",t=>stash.page.closeModal(e)));const n=a[i.attr("data-file-index")].thumbnail;e.find(".tn-url-input").val(n||"").focus(),n&&e.find(".done-button").removeClass("disabled"),t.stopPropagation()}))),o.append(E("div").addClass("action-button mcmeta-button").attr("title","zip"==n?"Edit thumbnail mcmeta":"Edit mcmeta").on("click",e=>{const n=stash.page.modal();n.find(".content").append(E("h2").text("Add mcmeta file"),E("p").text("Paste or type in the content of this texture's mcmeta file below."),E("textarea").addClass("mcmeta-input").attr("spellcheck",!1).on("input",t=>{let e=n.find(".mcmeta-input").val();if(e&&0!=e.length)try{JSON.parse(e),n.find(".done-button").removeClass("disabled").attr("title","Set the mcmeta of the texture to the above text")}catch(t){n.find(".done-button").addClass("disabled").attr("title",t.toString())}else n.find(".done-button").removeClass("disabled").attr("title","Remove mcmeta from texture")}),E("div").addClass("done-button").addClass("button disabled inline").text("Done").attr("title","Enter mcmeta content above").on("click",t=>{if($(t.currentTarget).is(".disabled"))return;let e=n.find(".mcmeta-input").val();e&&0!=e.length?(a[i.attr("data-file-index")].mcmeta=JSON.parse(e),i.addClass("mcmeta")):(i.removeClass("mcmeta"),delete a[i.attr("data-file-index")].mcmeta),stash.page.closeModal(n)}),E("div").addClass("button inline").text("Cancel").on("click",t=>stash.page.closeModal(n)));let s=a[i.attr("data-file-index")].mcmeta;n.find(".mcmeta-input").val(s?JSON.stringify(s,null,2):"").focus(),s&&n.find(".done-button").removeClass("disabled").attr("title","Add this mcmeta to the texture"),tippy(t.find(".done-button")[0],{placement:"right",arrow:!0,animation:"perspective",dynamicTitle:!0}),e.stopPropagation()})),"zip"==n&&o.append(E("div").addClass("action-button set-tag-button").attr("title","Set tag").on("click",e=>{const n=stash.page.modal();n.find(".content").append(E("h2").text("Tag file"),E("p").addClass("short").text("Since the stash can't automatically check what zip files contain, you must tag it with the appropriate type. Select one from the list below."),E("div").addClass("row").append(E("div").addClass("select inline").append(E("select").addClass("tag-input").append(E("option").attr("value","model").text("Model").prop("selected",!0),E("option").attr("value","set").text("Texture set"),E("option").attr("value","ctm").text("CTM"),E("option").attr("value","cit").text("CIT"))),E("div").addClass("done-button").addClass("button inline").text("Done").on("click",t=>{let e=n.find(".tag-input").val();e&&0!=e.length&&"string"==typeof stash.typeNames[e]&&(a[i.attr("data-file-index")].tag=e,i.removeClass("model ctm cit collection").addClass("tagged "+e).attr("data-filetype",stash.typeNames[e]),i.find(".set-tag-button").attr("title","Edit tag"),stash.page.closeModal(n))}),E("div").addClass("button inline").text("Cancel").on("click",t=>stash.page.closeModal(n))));let s=a[i.attr("data-file-index")].tag;s&&n.find(".tag-input").val(s),t.find("select").selectric(),e.stopPropagation()})),tippy(o.find(".action-button").toArray(),{arrow:!0,animation:"perspective",performance:!0,dynamicTitle:!0}),t.find(".unsorted-files").append(i)},h=i=>{null!=e&&(t.find(".login-status").addClass("logged-in").text("Logged in as "+i).on("click",()=>{localStorage.removeItem("gh-login-token"),stash.page.load("login")}),t.find(".add-file-button").on("click",()=>{let e=t.find(".file-url-input").val();if(0==e.length)return;t.find(".file-url-input").val("");const a=stash.blockInput("flex no-scroll",!1).append(stash.diamond.create(300,"indeterminate"));a.find(".content").append("Working..."),e.match(s)?(stash.workIndeterminate(),$.ajax({async:!0,crossDomain:!0,url:`https://api.imgur.com/3/album/${s.exec(e)[1]}/images`,method:"GET",headers:{Authorization:"Client-ID 5e061929dcae5e7"}}).done(t=>{1==t.success?(stash.workComplete(),t.data.forEach(t=>{"image/png"==t.type&&f(t.link,"png")})):(stash.workError(),stash.notify("Failed to get Imgur album info.",null,"error")),stash.removeInputBlocker(a)})):(e=p(e),m(e,["image/png","application/zip","application/x-zip-compressed"],{error:t=>{stash.removeInputBlocker(a),stash.notify(t,null,"error")},verified:t=>{stash.removeInputBlocker(a),f(e,t.match(/png/)?"png":"zip")}}))}),t.find(".select-category-button").on("click",()=>{const e=stash.page.modal();e.find(".content").append(E("h2").text("Choose a category"));let a=E("div").addClass("flex-wrapper").appendTo(e.find(".content"));for(let n=0;n<stash.categories.length;n++){let i=stash.categories[n];E("a").addClass("category").on("click",a=>{stash.page.closeModal(e),t.find(".sorter-category-input").val(i)}).append(E("div").addClass("img b-lazy").attr("data-src",`/stash/resources/category-icons/${i}.png`),i).appendTo(a)}}),t.find(".sort-selected-button").on("click",()=>{let e=t.find(".sorter-category-input").val();if(!~stash.categories.indexOf(e))return;let a=t.find(".unsorted-files .selected");if(0==a.length)return;let n=t.find(`.sorted-files .group[data-category-name="${e}"]`);0==n.length&&((n=E("div").addClass("group").append(E("h3").text(e))).attr("data-category-name",e),t.find(".sorted-files").append(n));for(var i=0;i<a.length;i++)$(a[i]).removeClass("selected").addClass("sorted").detach().appendTo(n);t.find(".when-any-selected").addClass("disabled"),t.find(".unsorted-files").is(":empty")&&!t.find(".sorted-files").is(":empty")&&t.find(".submit-button").removeClass("disabled"),u()}),t.find(".select-all-unsorted-button").on("click",()=>{t.find(".unsorted-files .file").addClass("selected"),u()}),t.find(".deselect-all-unsorted-button").on("click",()=>{t.find(".unsorted-files .selected").removeClass("selected"),u()}),t.find(".remove-selected-button").on("click",()=>{t.find(".unsorted-files .selected").remove();let e=[];files=t.find(".local.file").each((t,n)=>{e.push(a[$(n).attr("data-file-index")]),$(n).attr("data-file-index",e.length-1)}),a=e,0==t.find(".unsorted-files .file").length&&t.find(".sorted-files .file").length>0?t.find(".submit-button").removeClass("disabled"):t.find(".submit-button").addClass("disabled"),u()}),t.find(".submit-button").on("click",()=>{if(n)return;if(!t.find(".unsorted-files").is(":empty"))return void stash.notify("All files must be sorted before submitting.",null,"error");if(t.find(".sorted-files").is(":empty"))return void stash.notify("No files to submit.",null,"error");if(0==t.find(".sorter-name-input").val().length)return void stash.notify("Contributor name required.",null,"error");if(!t.find(".sorter-name-input").val().trim().match(/^[-_0-9a-zÀ-ÿ ]+$/i)){let e=/[^-_0-9a-zÀ-ÿ ]/i.exec(t.find(".sorter-name-input").val().trim());return void stash.notify(`Invalid character in contributor name: ${e[0]}`,null,"error")}if(t.find(".zip.no-thumbnail").length>0)return void stash.notify("All zip files must have a thumbnail image.",null,"error");if(~a.findIndex(t=>"zip"==t.type&&!t.tag))return void stash.notify("All zip files must be tagged.",null,"error");n=!0,stash.workIndeterminate();let i=t.find(".sorted-files .local.file"),s=[];for(var o=0;o<i.length;o++){let t=a[$(i[o]).attr("data-file-index")],e={type:t.type,url:t.url,category:$(i[o]).parent().attr("data-category-name")};t.mcmeta&&(e.mcmeta=t.mcmeta),t.tag&&(e.tag=t.tag),t.thumbnail&&(e.thumbnail=t.thumbnail),s.push(e)}e.getIssues("DokucraftSaga","stash").createIssue({title:"!addfiles",body:"@DokucraftSaga\n"+JSON.stringify({contributor:t.find(".sorter-name-input").val().trim(),files:s})}).then(e=>{e.status<300?(t.find(".sorted-files .group").remove(),stash.notify(`File${s.length>1?"s":""} submitted.`),stash.workComplete()):(stash.notify(`Failed to submit file${s.length>1?"s":""}. (${e.status} ${e.statusText})`,null,"error"),stash.workError()),n=!1})}),new Awesomplete(t.find(".sorter-category-input")[0],{list:stash.categories,autoFirst:!0,minChars:1,sort:bestMatchSort(t.find(".sorter-category-input"))}),new Awesomplete(t.find(".sorter-name-input")[0],{list:stash.contributors,autoFirst:!0,sort:bestMatchSort(t.find(".sorter-name-input"))}),tippy("#content .tt",{placement:"right",arrow:!0,hideOnClick:!1,animation:"perspective",flipBehavior:["right","bottom","top"]}))},g=getURLParams();if(null!=g){if(g.hasOwnProperty("token"))return void(e=new GitHub({token:g.token})).getUser().getProfile((t,e)=>{t?(localStorage.removeItem("gh-login-token"),stash.page.load("login")):(localStorage.setItem("gh-login-token",g.token),h(e.name||e.login))});if(g.hasOwnProperty("code"))return void $.getJSON("https://dokustash-gatekeeper.herokuapp.com/authenticate/"+g.code,t=>{(e=new GitHub({token:t.token})).getUser().getProfile((e,a)=>{e?(localStorage.removeItem("gh-login-token"),stash.page.load("login")):(localStorage.setItem("gh-login-token",t.token),h(a.name||a.login))})})}null==localStorage.getItem("gh-login-token")?stash.page.load("login"):(e=new GitHub({token:localStorage.getItem("gh-login-token")})).getUser().getProfile((t,e)=>{t?(localStorage.removeItem("gh-login-token"),stash.page.load("login")):h(e.name||e.login)})});</script><img onload="stash.page.identifierLoaded(this);void(0);" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="/>