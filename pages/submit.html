<div class="center"><div class="sp-submit-wrapper"><div class="row"><h2>Submit Files</h2><div class="filler"></div><a class="sp-submit-pending-counter warning" data-count="0" href="?my-submissions"></a></div><div class="row"><div class="sp-submit-default-contributor-name-field"></div><div class="sp-submit-default-tags-field filler"></div></div><div class="row"><div class="sp-submit-url-field filler"></div><div class="sp-submit-add-file-button button inline">Add</div></div><div class="sp-submit-files"></div><div class="row"><div class="filler"></div><div class="sp-submit-submit-button button inline notable">Submit</div></div></div></div><link rel="stylesheet" href="/stash/pages/css/submit.css"/><script>stash.page.identifier().then(stash.page.requireLogin()).then(t=>{let e=[],s=!1;const a=/(?:\/|www.)imgur\.com\/([0-9A-Za-z]+)/,i=/(?:\/|www.)imgur\.com\/a\/([0-9A-Za-z]+)/,n=/drive\.google\.com\/file\/d\/([0-9A-Za-z_-]+)/,l=/drive\.google\.com\/open\?id=([0-9A-Za-z_-]+)/,r="https://drive.google.com/uc?export=download&id=",d=/www\.dropbox\.com\/s\//,o=/^[-_0-9a-zÀ-ÿ ]+$/i,p=t=>t.match(a)?"https://i.imgur.com/"+a.exec(t)[1]+".png":t.match(l)?r+l.exec(t)[1]:t.match(n)?r+n.exec(t)[1]:t.match(d)?t.replace(d,"dl.dropboxusercontent.com/s/"):t,u=(t,e,s)=>{stash.workIndeterminate();const a=new XMLHttpRequest;a.addEventListener("progress",t=>{t.lengthComputable?stash.setWorkProgress(Math.floor(100*t.loaded/t.total)):stash.workIndeterminate()}),a.addEventListener("error",t=>{s.error("Unable to verify file."),stash.workError(s.reset)}),a.addEventListener("abort",t=>{s.error("Process aborted."),stash.workError(s.reset)}),a.addEventListener("load",t=>{const i=a.getResponseHeader("content-type");~e.indexOf(i)?(stash.workComplete(),s.verified(i)):(s.error("File type not recognized: "+i),stash.workError(s.reset))}),a.open("HEAD",((t=>t.match(/imgur\.com\//))(t)?"":stash.url.cors)+t,!0),a.send()},m=(s,a)=>{if(e.find(t=>t.url==s))return void stash.notify("This file has already been added.",null,"error");e.push({type:a,url:s});const i="png"===a?E("div").addClass("img").attr("data-src",s)[0]:"";"png"===a&&stash.lazy.imageObserver.observe(i);const n=E("div").addClass("sp-submit-file").appendTo(t.find(".sp-submit-files")).attr("data-file-index",e.length-1).append(E("div").addClass("sp-submit-file-preview "+a+("zip"===a?" tt":"")).append(i).attr("title","zip"===a?"Click to edit thumbnail":""),E("div").addClass("sp-submit-file-info").append(E("div").addClass("row").append(E("h3").text(`${a.toUpperCase()} File`),E("span").addClass("sp-submit-link-icon").load("/stash/resources/link.svg"),E("sub").addClass("faded sp-submit-file-url").text(s),E("div").addClass("filler"),E("div").addClass("inline button warning sp-submit-remove-file-button").text("Remove").on("click",()=>{n.remove();const s=[];t.find(".sp-submit-file").each((t,a)=>{const i=$(a);s.push(e[i.attr("data-file-index")]),i.attr("data-file-index",s.length-1)}),e=s})),E("div").addClass("filler"),E("div").addClass("row").append(E("div").addClass("sp-submit-file-parents"),"png"===a?E("div").addClass("inline button sp-submit-mcmeta-button").text("Edit MCMETA"):"","zip"===a?E("div").addClass("inline select sp-submit-package-type").attr("data-required",!0).on("change",t=>{const s=t.currentTarget.val();e[n.attr("data-file-index")].packageType=s,"model"==s?n.addClass("sp-submit-model-file"):(delete e[n.attr("data-file-index")].sketchfab,n.find(".sp-submit-sketchfab-link input").val(""),n.removeClass("sp-submit-model-file"))}):"","zip"===a?E("div").addClass("sp-submit-sketchfab-link filler"):""),E("div").addClass("row").append(E("div").addClass("sp-submit-file-contributor"),E("div").addClass("sp-submit-file-tags filler"))));if("zip"===a){CCInput(n.find(".sp-submit-package-type"),{placeholder:"Package type",type:"select",lists:[{name:"Package Types",list:[{name:"Model",value:"model"},{name:"Texture Set",value:"set"},{name:"CTM",value:"ctm"},{name:"CIT",value:"cit"}]}]}),CCInput(n.find(".sp-submit-sketchfab-link"),{placeholder:"Sketchfab Link <sup><i>(Optional)</i></sup>",hint:()=>[E("h4").text("Sketchfab Link"),E("p").text("The link to or ID of a Sketchfab preview of the model."),E("br"),E("p").append(E("sup").addClass("faded").append("Short skfb.ly links are not valid."))]}),n.find(".sp-submit-sketchfab-link input").on("change",t=>{const s=$(t.currentTarget).val();if(0==s.trim().length)return n.find(".sp-submit-sketchfab-link").removeClass("error"),void delete e[n.attr("data-file-index")].sketchfab;const a=s.match(/([0-9a-f]+)$/);a&&a[1]&&32==a[1].length?(n.find(".sp-submit-sketchfab-link").removeClass("error"),e[n.attr("data-file-index")].sketchfab=a[1]):n.find(".sp-submit-sketchfab-link").addClass("error")});const t=n.find(".sp-submit-file-preview");t.on("click",()=>{const s=stash.page.modal(),a=a=>{const i=s.find(".sp-submit-thumbnail-url-field input").val();if(i&&0!=i.length){const a=s.find(".sp-submit-thumbnail-mcmeta-field").val();if("string"==typeof a&&a.length>0)try{JSON.parse(a)}catch(t){return void stash.notify("Invalid MCMETA",null,"error")}const l=stash.blockInput(null,!1),r=stash.notify("Verifying thumbnail image...","working"),d=p(i);u(d,["image/png"],{error:t=>{stash.removeInputBlocker(l),stash.dismissNotification(r),stash.notify(t,null,"error")},verified:()=>{t.children(".img").remove();const i=E("div").addClass("img").attr("data-src",d)[0];stash.lazy.imageObserver.observe(i),t.append(i),e[n.attr("data-file-index")].thumbnail=d,"string"==typeof a&&a.length>0?e[n.attr("data-file-index")].mcmeta=JSON.parse(a):delete e[n.attr("data-file-index")].mcmeta,stash.removeInputBlocker(l),stash.dismissNotification(r),stash.page.closeModal(s)}})}else t.children(".img").remove(),delete e[n.attr("data-file-index")].thumbnail,stash.page.closeModal(s)};s.find(".content").css("width","800px").append(E("h2").text("Package Thumbnail Image"),E("p").text("Enter the URL of a thumbnail image below."),E("div").addClass("row").append(E("div").addClass("sp-submit-thumbnail-url-field filler")),E("h4").text("Thumbnail MCMETA"),E("p").text("For animated thumbnails, enter the MCMETA content below."),E("textarea").addClass("sp-submit-thumbnail-mcmeta-field").attr("spellcheck",!1).on("input",t=>{const e=s.find(".sp-submit-thumbnail-mcmeta-field").val();if(e&&0!=e.length)try{JSON.parse(e),s.find(".sp-submit-thumbnail-mcmeta-error").text("")}catch(t){s.find(".sp-submit-thumbnail-mcmeta-error").text(t.toString())}else s.find(".sp-submit-thumbnail-mcmeta-error").text("")}),E("p").addClass("sp-submit-thumbnail-mcmeta-error error"),E("hr"),E("div").addClass("sp-submit-thumnbail-done-button button inline").text("Done").on("click",a)),CCInput(s.find(".sp-submit-thumbnail-url-field"),{placeholder:"URL",enter:a,hint:()=>[E("h4").text("Supported URLs"),E("p").addClass("point").text("Direct link"),E("p").addClass("point").text("Shareable link from Google Drive or Dropbox"),E("p").addClass("point").text("Imgur image link"),E("br"),E("p").append(E("sup").addClass("faded").text("Only PNG files are supported."))]});const i=e[n.attr("data-file-index")];s.find(".sp-submit-thumbnail-url-field input").val(i.thumbnail?i.thumbnail:""),s.find(".sp-submit-thumbnail-mcmeta-field").val(i.mcmeta?JSON.stringify(i.mcmeta,null,2):"")})}"png"===a&&n.find(".sp-submit-mcmeta-button").on("click",()=>{const t=stash.page.modal();t.find(".content").css("width","800px").append(E("h2").text("Texture MCMETA"),E("p").text("For animated textures, enter the MCMETA content below."),E("textarea").addClass("sp-submit-mcmeta-field").attr("spellcheck",!1).on("input",e=>{const s=t.find(".sp-submit-mcmeta-field").val();if(s&&0!=s.length)try{JSON.parse(s),t.find(".sp-submit-mcmeta-error").text("")}catch(e){t.find(".sp-submit-mcmeta-error").text(e.toString())}else t.find(".sp-submit-mcmeta-error").text("")}),E("p").addClass("sp-submit-mcmeta-error error"),E("hr"),E("div").addClass("sp-submit-mcmeta-done-button button inline").text("Done").on("click",s=>{const a=t.find(".sp-submit-mcmeta-field").val();if("string"==typeof a&&a.length>0){try{JSON.parse(a)}catch(t){return void stash.notify("Invalid MCMETA",null,"error")}e[n.attr("data-file-index")].mcmeta=JSON.parse(a)}else delete e[n.attr("data-file-index")].mcmeta;stash.page.closeModal(t)}));const s=e[n.attr("data-file-index")];t.find(".sp-submit-mcmeta-field").val(s.mcmeta?JSON.stringify(s.mcmeta,null,2):"")}),CCInput(n.find(".sp-submit-file-parents"),{placeholder:"Sources <sup><i>(Optional)</i></sup>",hint:()=>[E("h4").text("Sources"),E("p").text("List of IDs of files on the stash or names of things that this file is based on. Leave blank for original files."),E("br"),E("p").append(E("sup").addClass("faded").append("Separate multiple sources with commas.")),E("p").append(E("sup").addClass("faded").append("Example: ",E("code").text("8230,20990,Dokucraft Light,18820")))]}),n.find(".sp-submit-file-parents input").on("change",t=>{const s=$(t.currentTarget).val();e[n.attr("data-file-index")].parents=s.split(",").map(t=>t.trim()).filter(t=>t.length).map(t=>t.match(/^\d+$/)?parseInt(t):t)}),CCInput(n.find(".sp-submit-file-contributor"),{placeholder:"Contributor Name",lists:[{name:"Contributors",list:stash.contributors}],hint:()=>[E("p").append(E("sup").addClass("faded").text("Only autocompletes names of contributors that already have files in the stash; if the name is not in the list, just ignore it and enter the name manually."))]}),n.find(".sp-submit-file-contributor input").on("change",t=>{const s=$(t.currentTarget).val().trim();s.match(o)?(n.find(".sp-submit-file-contributor").removeClass("error"),e[n.attr("data-file-index")].contributor=s):n.find(".sp-submit-file-contributor").addClass("error")}).val(t.find(".sp-submit-default-contributor-name-field input").val()).trigger("change");const l=/(^|\s)([a-z0-9-]+)$/;CCInput(n.find(".sp-submit-file-tags"),{placeholder:"Tags",lists:[{name:"Tags",list:stash.tags.names.explicit}],value:t=>{const e=t.match(l);return e?e[2]:""},replace:(t,e,s)=>t.replace(l,(t,s)=>s+e),hint:()=>[E("p").append(E("sup").addClass("faded").text("Tags may only contain lowercase letters, numbers and hyphens.")),E("p").append(E("sup").addClass("faded").text("Tags must not start or end with a hyphen and must contain at least one letter.")),E("p").append(E("sup").addClass("faded").text("Multiple tags should be separated by a space.")),E("p").append(E("sup").addClass("faded").text("Only autocompletes tags that are already used by files in the stash; if the tag is not in the list, just ignore it and enter the tag manually."))]}),n.find(".sp-submit-file-tags input").on("change",t=>{const s=$(t.currentTarget).val().split(/\s+/g).filter(t=>t.length);s.find(t=>!stash.tags.isValid(t))?n.find(".sp-submit-file-tags").addClass("error"):(n.find(".sp-submit-file-tags").removeClass("error"),e[n.attr("data-file-index")].tags=s)}).val(t.find(".sp-submit-default-tags-field input").val()).trigger("change"),tippy(n.find(".tt").toArray())},c=()=>{t.find(".sp-submit-url-field input").blur();const e=t.find(".sp-submit-url-field input").val();if(0==e.length)return;t.find(".sp-submit-url-field input").val("");const s=stash.blockInput(null,!1);if(e.match(i)){const t=stash.notify("Loading Imgur album info...","working");$.ajax({method:"GET",async:!0,crossDomain:!0,url:`https://api.imgur.com/3/album/${i.exec(e)[1]}/images`,headers:{Authorization:"Client-ID 5e061929dcae5e7"}}).done(e=>{1==e.success?e.data.forEach(t=>{"image/png"==t.type&&m(t.link,"png")}):stash.notify("Failed to get Imgur album info.",null,"error"),stash.dismissNotification(t),stash.removeInputBlocker(s)})}else{const t=p(e),a=stash.notify("Verifying file...","working");u(t,["image/png","application/zip","application/x-zip-compressed"],{error:t=>{stash.dismissNotification(a),stash.removeInputBlocker(s),stash.notify(t,null,"error")},verified:e=>{stash.dismissNotification(a),stash.removeInputBlocker(s),m(t,e.match(/png/)?"png":"zip")}})}};CCInput(t.find(".sp-submit-default-contributor-name-field"),{placeholder:"Contributor Name <sup><i>(Optional)</i></sup>",lists:[{name:"Contributors",list:stash.contributors}],hint:()=>[E("h4").text("Default contributor name"),E("p").text("Enter a name here to automatically set the contributor name for files you add."),E("br"),E("p").append(E("sup").addClass("faded").text("Does not affect files that have already been added.")),E("p").append(E("sup").addClass("faded").text("Only autocompletes names of contributors that already have files in the stash; if the name is not in the list, just ignore it and enter the name manually."))]});const f=/(^|\s)([a-z0-9-]+)$/;CCInput(t.find(".sp-submit-default-tags-field"),{placeholder:"Tags <sup><i>(Optional)</i></sup>",lists:[{name:"Tags",list:stash.tags.names.explicit}],value:t=>{const e=t.match(f);return e?e[2]:""},replace:(t,e,s)=>t.replace(f,(t,s)=>s+e),hint:()=>[E("h4").text("Default tags"),E("p").text("Enter tags here to automatically set the tags for files you add."),E("br"),E("p").append(E("sup").addClass("faded").text("Tags may only contain lowercase letters, numbers and hyphens.")),E("p").append(E("sup").addClass("faded").text("Tags must not start or end with a hyphen and must contain at least one letter.")),E("p").append(E("sup").addClass("faded").text("Multiple tags should be separated by a space.")),E("p").append(E("sup").addClass("faded").text("Does not affect files that have already been added.")),E("p").append(E("sup").addClass("faded").text("Only autocompletes tags that are already used by files in the stash; if the tag is not in the list, just ignore it and enter the tag manually."))]}),CCInput(t.find(".sp-submit-url-field"),{placeholder:"URL",enter:c,hint:()=>[E("h4").text("Supported URLs"),E("p").addClass("point").text("Direct link"),E("p").addClass("point").text("Shareable link from Google Drive or Dropbox"),E("p").addClass("point").text("Imgur album or image link"),E("br"),E("p").append(E("sup").addClass("faded").text("Only PNG and ZIP files are supported.")),E("p").append(E("sup").addClass("faded").text("Album links will add all supported images in the album."))]}),t.find(".sp-submit-add-file-button").on("click",c),t.find(".sp-submit-submit-button").on("click",()=>{s||(0!==e.length?e.find(t=>!t.contributor||!t.contributor.match(o))?stash.notify("All files must have a valid contributor name.",null,"error"):e.find(t=>"zip"==t.type&&!t.thumbnail)?stash.notify("All zip files must have a thumbnail image.",null,"error"):e.find(t=>"zip"==t.type&&!t.packageType)?stash.notify("All zip files must have a package type set.",null,"error"):new Promise((t,s)=>{if(e.find(t=>0==t.tags.length)){const e=stash.page.modal();e.find(".content").css("width","800px").append(E("h2").text("Files without tags"),E("p").text("One or more of the files have no tags set. Are you sure you want to submit files without tags?"),E("hr"),E("div").addClass("row").append(E("div").addClass("inline button notable").text("Yes, submit").on("click",s=>{stash.page.closeModal(e),t()}),E("div").addClass("inline button").text("No, cancel").on("click",t=>{stash.page.closeModal(e),s()})))}else t()}).then(()=>{s=!0;const a=stash.blockInput(null,!1),i=stash.notify("Submitting files...","working");stash.firebase.post("/files/submit",e).then(n=>{stash.notify(`File${e.length>1?"s":""} submitted.`),t.find(".sp-submit-file").remove();const l=parseInt(t.find(".sp-submit-pending-counter").attr("data-count"));t.find(".sp-submit-pending-counter").attr("data-count",l+e.length),e=[],stash.removeInputBlocker(a),stash.dismissNotification(i),s=!1}).catch(t=>{"string"==typeof t?stash.notify("Failed to submit files: "+t,null,"error"):t.responseJSON?stash.notify(`Failed to submit files: ${t.responseJSON.message}`,null,"error"):stash.notify(`Failed to submit files: ${t.status} ${t.statusText}`,null,"error"),console.error("Failed to submit files",t),stash.removeInputBlocker(a),stash.dismissNotification(i),s=!1})}):stash.notify("No files to submit.",null,"error"))}),stash.getFirebaseUser().then(e=>{stash.firebase.db.collection("pending-submissions").where("user","==",e.uid).where("type","==","file").get().then(e=>{t.find(".sp-submit-pending-counter").attr("data-count",e.docs.length)})}),t.find(".sp-submit-pending-counter").on("click",t=>{stash.page.load("my-submissions"),t.preventDefault()})}).catch(()=>{stash.notify("You need to be logged in to submit files to the stash.",null,"error"),stash.page.load("root")});</script><img onload="stash.page.identifierLoaded(this);void(0);" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="/>