<div class="center"><div class="sp-submit-wrapper"><div class="row"><h2>Submit Files</h2><div class="filler"></div><a class="sp-submit-pending-counter warning" data-count="0" href="?my-submissions"></a></div><div class="row"><div class="sp-submit-default-contributor-name-field"></div><div class="sp-submit-default-tags-field filler"></div></div><div class="row"><div class="sp-submit-url-field filler"></div><div class="sp-submit-add-file-button button inline">Add</div></div><div class="sp-submit-files"></div><div class="row"><div class="filler"></div><div class="sp-submit-submit-button button inline notable">Submit</div></div></div></div><link rel="stylesheet" href="/stash/pages/css/submit.css"/><script>stash.page.identifier().then(stash.page.requireLogin()).then(t=>{let e=[],a=!1;const s=/(?:\/|www.)imgur\.com\/([0-9A-Za-z]+)/,i=/(?:\/|www.)imgur\.com\/a\/([0-9A-Za-z]+)/,n=/drive\.google\.com\/file\/d\/([0-9A-Za-z_-]+)/,l=/drive\.google\.com\/open\?id=([0-9A-Za-z_-]+)/,d="https://drive.google.com/uc?export=download&id=",r=/www\.dropbox\.com\/s\//,o=/^[-_0-9a-zÀ-ÿ ]+$/i,p=t=>t.match(s)?"https://i.imgur.com/"+s.exec(t)[1]+".png":t.match(l)?d+l.exec(t)[1]:t.match(n)?d+n.exec(t)[1]:t.match(r)?t.replace(r,"dl.dropboxusercontent.com/s/"):t,u=(t,e,a)=>{stash.workIndeterminate();const s=new XMLHttpRequest;s.addEventListener("progress",t=>{t.lengthComputable?stash.setWorkProgress(Math.floor(100*t.loaded/t.total)):stash.workIndeterminate()}),s.addEventListener("error",t=>{a.error("Unable to verify file."),stash.workError(a.reset)}),s.addEventListener("abort",t=>{a.error("Process aborted."),stash.workError(a.reset)}),s.addEventListener("load",t=>{const i=s.getResponseHeader("content-type");~e.indexOf(i)?(stash.workComplete(),a.verified(i)):(a.error("File type not recognized: "+i),stash.workError(a.reset))}),s.open("HEAD",((t=>t.match(/imgur\.com\//))(t)?"":stash.url.cors)+t,!0),s.send()},m=(a,s)=>{if(e.find(t=>t.url==a))return void stash.notify("This file has already been added.",null,"error");e.push({type:s,url:a});const i=E("div").addClass("sp-submit-file").appendTo(t.find(".sp-submit-files")).attr("data-file-index",e.length-1).append(E("div").addClass("sp-submit-file-preview "+s+("zip"===s?" tt":"")).append("png"===s?E("div").addClass("img b-lazy").attr("data-src",a):"").attr("title","zip"===s?"Click to edit thumbnail":""),E("div").addClass("sp-submit-file-info").append(E("div").addClass("row").append(E("h3").text(`${s.toUpperCase()} File`),E("span").addClass("sp-submit-link-icon").load("/stash/resources/link.svg"),E("sub").addClass("faded sp-submit-file-url").text(a),E("div").addClass("filler"),E("div").addClass("inline button warning sp-submit-remove-file-button").text("Remove").on("click",()=>{i.remove();const a=[];t.find(".sp-submit-file").each((t,s)=>{const i=$(s);a.push(e[i.attr("data-file-index")]),i.attr("data-file-index",a.length-1)}),e=a})),E("div").addClass("filler"),E("div").addClass("row").append(E("div").addClass("sp-submit-file-parents"),"png"===s?E("div").addClass("inline button sp-submit-mcmeta-button").text("Edit MCMETA"):"","zip"===s?E("div").addClass("inline select sp-submit-package-type").attr("data-required",!0).on("change",t=>{const a=t.currentTarget.val();e[i.attr("data-file-index")].packageType=a,"model"==a?i.addClass("sp-submit-model-file"):(delete e[i.attr("data-file-index")].sketchfab,i.find(".sp-submit-sketchfab-link input").val(""),i.removeClass("sp-submit-model-file"))}):"","zip"===s?E("div").addClass("sp-submit-sketchfab-link filler"):""),E("div").addClass("row").append(E("div").addClass("sp-submit-file-contributor"),E("div").addClass("sp-submit-file-tags filler"))));if("zip"===s){CCInput(i.find(".sp-submit-package-type"),{placeholder:"Package type",type:"select",lists:[{name:"Package Types",list:[{name:"Model",value:"model"},{name:"Texture Set",value:"set"},{name:"CTM",value:"ctm"},{name:"CIT",value:"cit"}]}]}),CCInput(i.find(".sp-submit-sketchfab-link"),{placeholder:"Sketchfab Link <sup><i>(Optional)</i></sup>",hint:()=>[E("h4").text("Sketchfab Link"),E("p").text("The link to or ID of a Sketchfab preview of the model."),E("br"),E("p").append(E("sup").addClass("faded").append("Short skfb.ly links are not valid."))]}),i.find(".sp-submit-sketchfab-link input").on("change",t=>{const a=$(t.currentTarget).val();if(0==a.trim().length)return i.find(".sp-submit-sketchfab-link").removeClass("error"),void delete e[i.attr("data-file-index")].sketchfab;const s=a.match(/([0-9a-f]+)$/);s&&s[1]&&32==s[1].length?(i.find(".sp-submit-sketchfab-link").removeClass("error"),e[i.attr("data-file-index")].sketchfab=s[1]):i.find(".sp-submit-sketchfab-link").addClass("error")});const t=i.find(".sp-submit-file-preview");t.on("click",()=>{const a=stash.page.modal(),s=s=>{const n=a.find(".sp-submit-thumbnail-url-field input").val();if(n&&0!=n.length){const s=a.find(".sp-submit-thumbnail-mcmeta-field").val();if("string"==typeof s&&s.length>0)try{JSON.parse(s)}catch(t){return void stash.notify("Invalid MCMETA",null,"error")}const l=stash.blockInput(null,!1),d=stash.notify("Verifying thumbnail image...","working"),r=p(n);u(r,["image/png"],{error:t=>{stash.removeInputBlocker(l),stash.dismissNotification(d),stash.notify(t,null,"error")},verified:()=>{t.children(".img").remove(),t.append(E("div").addClass("img b-lazy").attr("data-src",r)),e[i.attr("data-file-index")].thumbnail=r,"string"==typeof s&&s.length>0?e[i.attr("data-file-index")].mcmeta=JSON.parse(s):delete e[i.attr("data-file-index")].mcmeta,stash.removeInputBlocker(l),stash.dismissNotification(d),stash.page.closeModal(a)}})}else t.children(".img").remove(),delete e[i.attr("data-file-index")].thumbnail,stash.page.closeModal(a)};a.find(".content").css("width","800px").append(E("h2").text("Package Thumbnail Image"),E("p").text("Enter the URL of a thumbnail image below."),E("div").addClass("row").append(E("div").addClass("sp-submit-thumbnail-url-field filler")),E("h4").text("Thumbnail MCMETA"),E("p").text("For animated thumbnails, enter the MCMETA content below."),E("textarea").addClass("sp-submit-thumbnail-mcmeta-field").attr("spellcheck",!1).on("input",t=>{const e=a.find(".sp-submit-thumbnail-mcmeta-field").val();if(e&&0!=e.length)try{JSON.parse(e),a.find(".sp-submit-thumbnail-mcmeta-error").text("")}catch(t){a.find(".sp-submit-thumbnail-mcmeta-error").text(t.toString())}else a.find(".sp-submit-thumbnail-mcmeta-error").text("")}),E("p").addClass("sp-submit-thumbnail-mcmeta-error error"),E("hr"),E("div").addClass("sp-submit-thumnbail-done-button button inline").text("Done").on("click",s)),CCInput(a.find(".sp-submit-thumbnail-url-field"),{placeholder:"URL",enter:s,hint:()=>[E("h4").text("Supported URLs"),E("p").addClass("point").text("Direct link"),E("p").addClass("point").text("Shareable link from Google Drive or Dropbox"),E("p").addClass("point").text("Imgur image link"),E("br"),E("p").append(E("sup").addClass("faded").text("Only PNG files are supported."))]});const n=e[i.attr("data-file-index")];a.find(".sp-submit-thumbnail-url-field input").val(n.thumbnail?n.thumbnail:""),a.find(".sp-submit-thumbnail-mcmeta-field").val(n.mcmeta?JSON.stringify(n.mcmeta,null,2):"")})}"png"===s&&i.find(".sp-submit-mcmeta-button").on("click",()=>{const t=stash.page.modal();t.find(".content").css("width","800px").append(E("h2").text("Texture MCMETA"),E("p").text("For animated textures, enter the MCMETA content below."),E("textarea").addClass("sp-submit-mcmeta-field").attr("spellcheck",!1).on("input",e=>{const a=t.find(".sp-submit-mcmeta-field").val();if(a&&0!=a.length)try{JSON.parse(a),t.find(".sp-submit-mcmeta-error").text("")}catch(e){t.find(".sp-submit-mcmeta-error").text(e.toString())}else t.find(".sp-submit-mcmeta-error").text("")}),E("p").addClass("sp-submit-mcmeta-error error"),E("hr"),E("div").addClass("sp-submit-mcmeta-done-button button inline").text("Done").on("click",a=>{const s=t.find(".sp-submit-mcmeta-field").val();if("string"==typeof s&&s.length>0){try{JSON.parse(s)}catch(t){return void stash.notify("Invalid MCMETA",null,"error")}e[i.attr("data-file-index")].mcmeta=JSON.parse(s)}else delete e[i.attr("data-file-index")].mcmeta;stash.page.closeModal(t)}));const a=e[i.attr("data-file-index")];t.find(".sp-submit-mcmeta-field").val(a.mcmeta?JSON.stringify(a.mcmeta,null,2):"")}),CCInput(i.find(".sp-submit-file-parents"),{placeholder:"Sources <sup><i>(Optional)</i></sup>",hint:()=>[E("h4").text("Sources"),E("p").text("List of IDs of files on the stash or names of things that this file is based on. Leave blank for original files."),E("br"),E("p").append(E("sup").addClass("faded").append("Separate multiple sources with commas.")),E("p").append(E("sup").addClass("faded").append("Example: ",E("code").text("8230,20990,Dokucraft Light,18820")))]}),i.find(".sp-submit-file-parents input").on("change",t=>{const a=$(t.currentTarget).val();e[i.attr("data-file-index")].parents=a.split(",").map(t=>t.trim()).filter(t=>t.length).map(t=>t.match(/^\d+$/)?parseInt(t):t)}),CCInput(i.find(".sp-submit-file-contributor"),{placeholder:"Contributor Name",lists:[{name:"Contributors",list:stash.contributors}],hint:()=>[E("p").append(E("sup").addClass("faded").text("Only autocompletes names of contributors that already have files in the stash; if the name is not in the list, just ignore it and enter the name manually."))]}),i.find(".sp-submit-file-contributor input").on("change",t=>{const a=$(t.currentTarget).val().trim();a.match(o)?(i.find(".sp-submit-file-contributor").removeClass("error"),e[i.attr("data-file-index")].contributor=a):i.find(".sp-submit-file-contributor").addClass("error")}).val(t.find(".sp-submit-default-contributor-name-field input").val()).trigger("change");const n=/(^|\s)([a-z0-9-]+)$/;CCInput(i.find(".sp-submit-file-tags"),{placeholder:"Tags",lists:[{name:"Tags",list:stash.tags.names.explicit}],value:t=>{const e=t.match(n);return e?e[2]:""},replace:(t,e,a)=>t.replace(n,(t,a)=>a+e),hint:()=>[E("p").append(E("sup").addClass("faded").text("Tags may only contain lowercase letters, numbers and hyphens.")),E("p").append(E("sup").addClass("faded").text("Tags must not start or end with a hyphen and must contain at least one letter.")),E("p").append(E("sup").addClass("faded").text("Multiple tags should be separated by a space.")),E("p").append(E("sup").addClass("faded").text("Only autocompletes tags that are already used by files in the stash; if the tag is not in the list, just ignore it and enter the tag manually."))]}),i.find(".sp-submit-file-tags input").on("change",t=>{const a=$(t.currentTarget).val().split(/\s+/g).filter(t=>t.length);a.find(t=>!stash.tags.isValid(t))?i.find(".sp-submit-file-tags").addClass("error"):(i.find(".sp-submit-file-tags").removeClass("error"),e[i.attr("data-file-index")].tags=a)}).val(t.find(".sp-submit-default-tags-field input").val()).trigger("change"),tippy(i.find(".tt").toArray())},c=()=>{t.find(".sp-submit-url-field input").blur();const e=t.find(".sp-submit-url-field input").val();if(0==e.length)return;t.find(".sp-submit-url-field input").val("");const a=stash.blockInput(null,!1);if(e.match(i)){const t=stash.notify("Loading Imgur album info...","working");$.ajax({method:"GET",async:!0,crossDomain:!0,url:`https://api.imgur.com/3/album/${i.exec(e)[1]}/images`,headers:{Authorization:"Client-ID 5e061929dcae5e7"}}).done(e=>{1==e.success?e.data.forEach(t=>{"image/png"==t.type&&m(t.link,"png")}):stash.notify("Failed to get Imgur album info.",null,"error"),stash.dismissNotification(t),stash.removeInputBlocker(a)})}else{const t=p(e),s=stash.notify("Verifying file...","working");u(t,["image/png","application/zip","application/x-zip-compressed"],{error:t=>{stash.dismissNotification(s),stash.removeInputBlocker(a),stash.notify(t,null,"error")},verified:e=>{stash.dismissNotification(s),stash.removeInputBlocker(a),m(t,e.match(/png/)?"png":"zip")}})}};CCInput(t.find(".sp-submit-default-contributor-name-field"),{placeholder:"Contributor Name <sup><i>(Optional)</i></sup>",lists:[{name:"Contributors",list:stash.contributors}],hint:()=>[E("h4").text("Default contributor name"),E("p").text("Enter a name here to automatically set the contributor name for files you add."),E("br"),E("p").append(E("sup").addClass("faded").text("Does not affect files that have already been added.")),E("p").append(E("sup").addClass("faded").text("Only autocompletes names of contributors that already have files in the stash; if the name is not in the list, just ignore it and enter the name manually."))]});const f=/(^|\s)([a-z0-9-]+)$/;CCInput(t.find(".sp-submit-default-tags-field"),{placeholder:"Tags <sup><i>(Optional)</i></sup>",lists:[{name:"Tags",list:stash.tags.names.explicit}],value:t=>{const e=t.match(f);return e?e[2]:""},replace:(t,e,a)=>t.replace(f,(t,a)=>a+e),hint:()=>[E("h4").text("Default tags"),E("p").text("Enter tags here to automatically set the tags for files you add."),E("br"),E("p").append(E("sup").addClass("faded").text("Tags may only contain lowercase letters, numbers and hyphens.")),E("p").append(E("sup").addClass("faded").text("Tags must not start or end with a hyphen and must contain at least one letter.")),E("p").append(E("sup").addClass("faded").text("Multiple tags should be separated by a space.")),E("p").append(E("sup").addClass("faded").text("Does not affect files that have already been added.")),E("p").append(E("sup").addClass("faded").text("Only autocompletes tags that are already used by files in the stash; if the tag is not in the list, just ignore it and enter the tag manually."))]}),CCInput(t.find(".sp-submit-url-field"),{placeholder:"URL",enter:c,hint:()=>[E("h4").text("Supported URLs"),E("p").addClass("point").text("Direct link"),E("p").addClass("point").text("Shareable link from Google Drive or Dropbox"),E("p").addClass("point").text("Imgur album or image link"),E("br"),E("p").append(E("sup").addClass("faded").text("Only PNG and ZIP files are supported.")),E("p").append(E("sup").addClass("faded").text("Album links will add all supported images in the album."))]}),t.find(".sp-submit-add-file-button").on("click",c),t.find(".sp-submit-submit-button").on("click",()=>{a||(0!==e.length?e.find(t=>!t.contributor||!t.contributor.match(o))?stash.notify("All files must have a valid contributor name.",null,"error"):e.find(t=>"zip"==t.type&&!t.thumbnail)?stash.notify("All zip files must have a thumbnail image.",null,"error"):e.find(t=>"zip"==t.type&&!t.packageType)?stash.notify("All zip files must have a package type set.",null,"error"):new Promise((t,a)=>{if(e.find(t=>0==t.tags.length)){const e=stash.page.modal();e.find(".content").css("width","800px").append(E("h2").text("Files without tags"),E("p").text("One or more of the files have no tags set. Are you sure you want to submit files without tags?"),E("hr"),E("div").addClass("row").append(E("div").addClass("inline button notable").text("Yes, submit").on("click",a=>{stash.page.closeModal(e),t()}),E("div").addClass("inline button").text("No, cancel").on("click",t=>{stash.page.closeModal(e),a()})))}else t()}).then(()=>{a=!0;const s=stash.blockInput(null,!1),i=stash.notify("Submitting files...","working");stash.firebase.post("/files/submit",e).then(n=>{stash.notify(`File${e.length>1?"s":""} submitted.`),t.find(".sp-submit-file").remove();const l=parseInt(t.find(".sp-submit-pending-counter").attr("data-count"));t.find(".sp-submit-pending-counter").attr("data-count",l+e.length),e=[],stash.removeInputBlocker(s),stash.dismissNotification(i),a=!1}).catch(t=>{"string"==typeof t?stash.notify("Failed to submit files: "+t,null,"error"):t.responseJSON?stash.notify(`Failed to submit files: ${t.responseJSON.message}`,null,"error"):stash.notify(`Failed to submit files: ${t.status} ${t.statusText}`,null,"error"),console.error("Failed to submit files",t),stash.removeInputBlocker(s),stash.dismissNotification(i),a=!1})}):stash.notify("No files to submit.",null,"error"))}),stash.getFirebaseUser().then(e=>{stash.firebase.db.collection("submissions-pending").where("user","==",e.uid).get().then(e=>{const a=e.docs.map(t=>t.data()).reduce((t,e)=>t+e.files.length,0);t.find(".sp-submit-pending-counter").attr("data-count",a)})}),t.find(".sp-submit-pending-counter").on("click",t=>{stash.page.load("my-submissions"),t.preventDefault()})}).catch(()=>{stash.notify("You need to be logged in to submit files to the stash.",null,"error"),stash.page.load("root")});</script><img onload="stash.page.identifierLoaded(this);void(0);" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="/>