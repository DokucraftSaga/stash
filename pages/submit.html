<div class="fill full-height" id="submit-page"><h2>Submit Textures</h2><a id="login-status">Logging in...</a><p class="short">This page is for contributors. From here you can submit textures to the stash. The textures will be reviewed manually before being added and will not show up in the stash before they are approved.</p><br/><h2>Add and sort files</h2><p><i>Each file must be less than 2 MBs.</i></p><div class="button inline" onclick="$(&quot;#file-input&quot;)[0].click()">Browse local files</div><span> or simply drag or paste images here.</span><br/><br/><p class="short">To sort files into categories, select one or more files by clicking on them, then choose a category to sort them into and click 'Sort selected'. If you make a mistake you can sort a file again after putting it back into the unsorted list by clicking on it.</p><i>All files must be sorted before you can submit them.</i><br/><br/><div class="text-input tt" title="&lt;h3&gt;Category name&lt;/h3&gt;&lt;br&gt;&lt;i&gt;Must match name exactly&lt;/i&gt;"><input id="sorter-category-input" type="text" spellcheck="false" placeholder="Category"/><span></span></div><div class="button inline tt" id="select-category-button" title="Select category from list">...</div><div class="button inline" id="sort-selected-button">Sort selected</div><div class="button inline" onclick="$(&quot;#unsorted-files .selected&quot;).removeClass(&quot;selected&quot;)">Deselect all</div><div class="button inline" onclick="$(&quot;#unsorted-files .selected&quot;).remove()">Remove selected</div><br/><h3>Unsorted files</h3><div id="unsorted-files"></div><div class="content" id="sorted-files"></div><h2>Submit for approval</h2><p class="short">Before you submit the textures, you need to enter the name of the contributor who made them below. The files will be renamed to follow the format <code>&lt;Contributor Name&gt;_&lt;ID&gt;.png</code> before being added to the stash and this is where the name is used.</p><br/><div class="text-input tt" title="&lt;h3&gt;Contributor name&lt;/h3&gt;&lt;br&gt;&lt;i&gt;Only autocompletes names of contributors that already have textures in the stash; if your name is not in the list, just ignore it.&lt;/i&gt;"><input id="sorter-name-input" type="text" spellcheck="false" placeholder="Name"/><span></span></div><div class="button inline" id="submit-button">Submit</div><span id="submit-status"></span><input id="file-input" type="file" accept=".png" style="visibility:hidden;" multiple="multiple"/></div><script>(()=>{let e=null,t=[],a=(e,a,o)=>{t.push(o.replace(/^data:image\/png;base64,/,""));let s=$("<div>",{class:"local file",title:a?`<h3>${e}</h3><i>${a}</i>`:`<h3>${e}</h3>`}).append($("<div>",{class:"img"}).css("background-image",`url(${o})`)).attr("data-file-content",t.length-1).on("click",e=>{if(s.is(".sorted")){let e=s.parent();return s.removeClass("sorted").detach().appendTo($("#unsorted-files")),void(0==e.find(".local.file").length&&e.remove())}s.is(".selected")?s.removeClass("selected"):s.addClass("selected")});tippy(s[0],{arrow:!0,animation:"perspective",position:"right"});let l=new Image;l.onload=(()=>{l.width<128&&l.height<128&&s.addClass("pixelated")}),l.src=o,s.append($("<div>",{class:"fullscreen-button",title:"Fullscreen"}).on("click",e=>{$("#fullscreen-cover").removeClass("hidden").css("background-image",`url(${o}), url(resources/transparent.png)`),e.stopPropagation()})),tippy(s[0].children[1],{arrow:!0,animation:"perspective"}),$("#unsorted-files").append(s)},o=o=>{if(null==e)return;$("#login-status").addClass("logged-in").text("Logged in as "+o).on("click",()=>{localStorage.removeItem("gh-login-token"),goToPage("login")}),$("#file-input").on("change",()=>{let e=$("#file-input")[0];for(let t=0;t<e.files.length;t++){let o=e.files[t];if(o.size/1048576>2)continue;let s=new FileReader;s.onload=(()=>{a(o.name.replace(/\.png$/,""),"Local file",s.result)}),s.readAsDataURL(o)}$("#file-input").val(null)});let s=e=>{let t=(e.clipboardData||e.originalEvent.clipboardData).items;for(i in t)if(t.hasOwnProperty(i)){let e=t[i];if("image/png"===e.type){let t=e.getAsFile();if(t.size/1048576>2)continue;let o=new FileReader;o.onload=(e=>{a("Image from clipboard",null,o.result)}),o.readAsDataURL(t)}}};$(document).on("paste",s),$("#submit-page").on("drop",e=>{e.stopPropagation(),e.preventDefault();let t=e.originalEvent.dataTransfer.files;if(t)for(i in t)if(t.hasOwnProperty(i)){let e=t[i];if("image/png"===e.type&&e.size/1048576<=2){let t=new FileReader;t.onload=(o=>{a(e.name.replace(/\.png$/,""),"Local file",t.result)}),t.readAsDataURL(e)}}}),$("#submit-page").on("dragover",e=>{e.stopPropagation(),e.preventDefault()}),$("#select-category-button").on("click",()=>{$("#submit-page").hide(),removeAllTooltips();let e=$("<div>",{class:"fill"}).append($("<h2>").text("Choose a category")).appendTo($("#content")),t=$("<div>",{class:"content"}).appendTo(e);for(let a=0;a<stash.categories.length;a++){let o=stash.categories[a],s=$("<a>",{class:"category button"});s.on("click",t=>{e.remove(),$("#sorter-category-input").val(o),$("#submit-page").show()}),s.append($("<div>",{class:"img b-lazy"}).attr("data-src",`/stash/resources/category-icons/${o}.png`).append($("<div>",{class:"spinner-container"}).append($("<div>",{class:"spinner"})))),s.append($("<p>",{text:o})),t.append(s)}bLazy.revalidate(),window.scrollTo(0,0)}),$("#sort-selected-button").on("click",()=>{let e=$("#sorter-category-input").val();if(!~stash.categories.indexOf(e))return;let t=$("#unsorted-files .selected");if(0==t.length)return;let a=$(`#sorted-files .group[data-category-name="${e}"]`);0==a.length&&((a=$("<div>",{class:"group"}).append($("<h3>",{text:e}))).attr("data-category-name",e),$("#sorted-files").append(a));for(var o=0;o<t.length;o++)$(t[o]).removeClass("selected").addClass("sorted").detach().appendTo(a)}),$("#submit-button").on("click",()=>{if($("#submit-status").text("").removeClass("bad").removeClass("good"),!$("#unsorted-files").is(":empty"))return void $("#submit-status").text("All files must be sorted before submitting.").addClass("bad").removeClass("good");if($("#sorted-files").is(":empty"))return void $("#submit-status").text("No files to submit.").addClass("bad").removeClass("good");if(0==$("#sorter-name-input").val().length)return void $("#submit-status").text("Contributor name required.").addClass("bad").removeClass("good");if(!$("#sorter-name-input").val().match(/^[-_0-9a-zÀ-ÿ ]+$/i)){let e=/[^-_0-9a-zÀ-ÿ ]/i.exec($("#sorter-name-input").val());return void $("#submit-status").text(`Invalid character in contributor name: ${e[0]}`).addClass("bad").removeClass("good")}let a=$("#sorted-files .local.file"),o=[];for(var s=0;s<a.length;s++){let e=t[$(a[s]).attr("data-file-content")];if(e.length/1048576>2/.75)return void $("#submit-status").text("One or more files exceed 2MB, submission cancelled.").addClass("bad").removeClass("good");o.push({content:e,category:$(a[s]).parent().attr("data-category-name")})}e.getIssues("DokucraftSaga","stash").createIssue({title:"!addfiles",body:"@DokucraftSaga\n"+JSON.stringify({contributor:$("#sorter-name-input").val(),files:o})}).then(e=>{e.status<300?($("#sorted-files .group").remove(),$("#submit-status").text("Textures submitted.").addClass("good").removeClass("bad")):$("#submit-status").text(`Failed to submit textures. (${e.status} ${e.statusText})`).addClass("bad").removeClass("good")})}),new Awesomplete($("#sorter-category-input")[0],{list:stash.categories,autoFirst:!0,minChars:1,sort:bestMatchSort($("#sorter-category-input"))}),new Awesomplete($("#sorter-name-input")[0],{list:stash.contributors,autoFirst:!0,sort:bestMatchSort($("#sorter-name-input"))}),tippy("#content .fill .tt",{position:"right",arrow:!0,hideOnClick:!1,animation:"perspective"}),pageCleanup=(()=>{$(document).off("paste",s)})},s=getURLParams();if(null!=s){if(s.hasOwnProperty("token"))return void(e=new GitHub({token:s.token})).getUser().getProfile((e,t)=>{e?(localStorage.removeItem("gh-login-token"),goToPage("login")):(localStorage.setItem("gh-login-token",s.token),o(t.name||t.login))});if(s.hasOwnProperty("code"))return void $.getJSON("https://dokustash-gatekeeper.herokuapp.com/authenticate/"+s.code,t=>{(e=new GitHub({token:t.token})).getUser().getProfile((e,a)=>{e?(localStorage.removeItem("gh-login-token"),goToPage("login")):(localStorage.setItem("gh-login-token",t.token),o(a.name||a.login))})})}null==localStorage.getItem("gh-login-token")?goToPage("login"):(e=new GitHub({token:localStorage.getItem("gh-login-token")})).getUser().getProfile((e,t)=>{e?(localStorage.removeItem("gh-login-token"),goToPage("login")):o(t.name||t.login)})})();</script>